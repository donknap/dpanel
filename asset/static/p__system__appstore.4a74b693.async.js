"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3917],{29337:function(J,I,e){e.r(I),e.d(I,{default:function(){return se}});var W=e(15009),l=e.n(W),K=e(99289),v=e.n(K),E=e(5574),M=e.n(E),S=e(3616),B=e(24963),w=e(15078),y=e(36146),U=e(184),P=e(5966),O=e(97462),N=e(86615),Z=e(62370),b=e(82346),D=e(83622),o=e(42075),f=e(25593),T=e(66309),r=e(40056),Q=e(79697),x=e(67294),n=e(85893),X=(0,x.forwardRef)(function($,z){var L=(0,x.useState)(!1),G=M()(L,2),R=G[0],s=G[1],a=(0,x.useRef)(),u=(0,x.useContext)(B.Z),d=u.message,p=(0,b.useSearchParams)(),h=M()(p,2),c=h[0],V=h[1],i=new y.Uo("components.appstore");return(0,x.useImperativeHandle)(z,function(){return{edit:function(m){var t;(t=a.current)===null||t===void 0||t.setFieldsValue({title:m.title,name:m.name,type:m.setting.type,url:m.setting.url,id:m.id}),s(!0)}}}),(0,x.useEffect)(function(){c.get("op")=="create"&&s(!0)},[]),(0,n.jsxs)(U.a,{name:"appstoreCreate",title:i.format("createDrawerTitle"),open:R,onOpenChange:function(m){var t;!m&&((t=a.current)===null||t===void 0||t.resetFields()),s(m)},drawerProps:{forceRender:!0,width:S.R_},formRef:a,trigger:(0,n.jsx)(D.ZP,{type:"primary",children:i.format("createDrawerTitle")}),onFinish:function(){var C=v()(l()().mark(function m(t){var A,j,F;return l()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return t.type=="1panel-local"&&(t.url="/dpanel/store/".concat(t.name)),g.next=3,(0,w.ks)({name:t.name,url:t.url,type:t.type});case 3:if(A=g.sent,!(A&&A.data)){g.next=13;break}return g.next=7,(0,w.$c)({id:t.id,name:t.name,title:t.title,type:t.type,url:t.url,apps:A.data.list});case 7:if(j=g.sent,!(j&&j.data)){g.next=13;break}return d.success(y.FD.format("finish")),$.onFinish&&$.onFinish(),(F=a.current)===null||F===void 0||F.resetFields(),g.abrupt("return",!0);case 13:case"end":return g.stop()}},m)}));return function(m){return C.apply(this,arguments)}}(),children:[(0,n.jsx)(P.Z,{name:"id",hidden:!0}),(0,n.jsx)(P.Z,{label:i.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],placeholder:i.format("formTitleEmpty")}),(0,n.jsx)(O.Z,{name:["id"],children:function(m){var t=m.id;return(0,n.jsx)(P.Z,{label:i.format("formName"),name:"name",required:!0,disabled:!!t,rules:[{required:!0}],placeholder:i.format("formNameEmpty")})}}),(0,n.jsx)(N.Z.Group,{name:"type",label:i.format("formType"),options:i.option("formTypeOption",["casaos","1panel","1panel-local","baota"]),fieldProps:{onChange:function(m){var t;(t=a.current)===null||t===void 0||t.resetFields(["url"])}}}),(0,n.jsx)(O.Z,{name:["type","name"],children:function(m){var t=m.type,A=m.name,j=[],F=[];if(t=="1panel"&&(F=["https://gitee.com/qyg2297248353/appstore-dpanel","https://github.com/1Panel-dev/appstore","https://github.com/okxlin/appstore"],j=[(0,n.jsx)(P.Z,{label:i.format("formGitUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:i.format("formGitUrlEmpty")},"gitUrl")]),t=="baota"&&(F=[],j=[(0,n.jsx)(P.Z,{hidden:!0,label:i.format("formGitUrl"),name:"url",required:!0,rules:[{required:!0}],initialValue:"https://download.bt.cn/src/dk_app/apps",placeholder:i.format("formGitUrlEmpty")},"gitUrl")]),t=="portainer"&&(j=[(0,n.jsx)(P.Z,{label:i.format("formJsonUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:"https://github.com/Lissy93/portainer-templates/blob/main/templates.json"},"jsonUrl")]),t=="casaos"&&(F=["https://play.cuse.eu.org/Cp0204-AppStore-Play.zip"],j=[(0,n.jsx)(P.Z,{label:i.format("formZipUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:i.format("formZipUrlEmpty")},"zipUrl")]),t&&t!="1panel-local")return[j,!(0,Q.Z)(F)&&(0,n.jsx)(Z.Z,{label:(0,n.jsxs)(o.Z,{children:[i.format("formRecommend"),(0,n.jsx)("a",{href:"https://dpanel.cc/manual/system-store",target:"_blank",children:y.FD.format("help")})]}),children:(0,n.jsx)(o.Z,{wrap:!0,children:F.map(function(k,g){return(0,n.jsx)(f.Z.Link,{onClick:function(){var H;(H=a.current)===null||H===void 0||H.setFieldValue("url",k)},children:(0,n.jsx)(T.Z,{color:"cyan",children:k})},g)})})},"recommend")];if(t=="1panel-local")return[j,(0,n.jsx)(Z.Z,{children:(0,n.jsx)(r.Z,{message:i.format("formLocalDesc",{name:A})})},"local-description")]}})]})}),Y=X,q=e(55681),_=e(83403),ee=e(5251),re=e(99611),te=e(86548),ne=e(98165),ae=e(74453);function se(){var $=(0,x.useRef)(),z=(0,b.useAccess)(),L=(0,x.useRef)(),G=(0,b.useNavigate)();return(0,n.jsx)(ae._z,{header:{extra:[z.canSeeFounder&&(0,n.jsx)(Y,{ref:L,onFinish:function(){var s,a;!((s=$.current)===null||s===void 0)&&s.reloadAndRest&&((a=$.current)===null||a===void 0||a.reloadAndRest())}},"create")]},children:(0,n.jsx)(q.Co,{rowKey:"id",columns:[{title:y.FD.format("listName"),dataIndex:"name",width:200},{title:y.FD.format("listTitle"),dataIndex:"title"},{title:y.FD.format("listTargetRoot"),width:500,search:!1,render:function(s,a,u,d,p){return(0,n.jsx)("a",{href:a.setting.url,target:"_blank",children:(0,n.jsx)(T.Z,{children:a.setting.url})})}},{title:y.FD.format("listUpdatedAt"),width:180,search:!1,render:function(s,a,u,d,p){if(a.setting.updatedAt)return(0,ee.ZM)(a.setting.updatedAt*1e3)}}],request:function(){var R=v()(l()().mark(function s(a,u,d){var p;return l()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,(0,w.eO)({name:a.name,title:a.title});case 2:return p=c.sent,c.abrupt("return",{data:p.data.list,success:!0,total:p.data.list.length});case 4:case"end":return c.stop()}},s)}));return function(s,a,u){return R.apply(this,arguments)}}(),actionRef:$,actions:[{key:"view",label:y.FD.format("listManageView"),icon:(0,n.jsx)(re.Z,{}),showInContext:"manage",showInOperator:!0,action:function(s){return v()(l()().mark(function a(){var u,d;return l()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:u=s.selectedRow,d=s.finish,d(!0),G("/compose/appstore",{state:{name:u.name}});case 3:case"end":return h.stop()}},a)}))()}},{key:"edit",label:y.FD.format("listManageEdit"),showInContext:"manage",showInOperator:!0,icon:(0,n.jsx)(te.Z,{}),action:function(s){return v()(l()().mark(function a(){var u,d,p;return l()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:d=s.finish,p=s.selectedRow,d(!0),(u=L.current)===null||u===void 0||u.edit(p);case 3:case"end":return c.stop()}},a)}))()}},{key:"sync",label:y.FD.format("listManageSync"),icon:(0,n.jsx)(ne.Z,{}),showInContext:"manage",showInOperator:!0,action:function(s){return v()(l()().mark(function a(){var u,d,p,h,c;return l()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return p=s.finish,h=s.selectedRow,c=s.loading,i.abrupt("return",(0,w.ks)({id:h.id,name:h.name,url:(u=h.setting.url)!==null&&u!==void 0?u:"",type:(d=h.setting.type)!==null&&d!==void 0?d:""}).finally(function(){p(!0)}));case 2:case"end":return i.stop()}},a)}))()}},{key:"dataPermission",label:_.W6.APPSTORE},{key:"delete",action:function(s){return v()(l()().mark(function a(){var u,d,p;return l()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return u=s.loading,d=s.finish,p=s.selectedRows,u(),c.abrupt("return",(0,w.Me)({id:p.map(function(V){return V.id})}).finally(function(){d(!0)}));case 3:case"end":return c.stop()}},a)}))()}}]},"appstore-list")})}},15078:function(J,I,e){e.d(I,{$c:function(){return M},Me:function(){return N},eO:function(){return P},ks:function(){return B},yL:function(){return b}});var W=e(15009),l=e.n(W),K=e(99289),v=e.n(K),E=e(82346);function M(o){return S.apply(this,arguments)}function S(){return S=v()(l()().mark(function o(f){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,E.request)("/dpanel/api/common/store/create",{method:"POST",data:f}));case 1:case"end":return r.stop()}},o)})),S.apply(this,arguments)}function B(o){return w.apply(this,arguments)}function w(){return w=v()(l()().mark(function o(f){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,E.request)("/dpanel/api/common/store/sync",{method:"POST",data:f}));case 1:case"end":return r.stop()}},o)})),w.apply(this,arguments)}function y(o){return U.apply(this,arguments)}function U(){return U=_asyncToGenerator(_regeneratorRuntime().mark(function o(f){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",request("/dpanel/api/common/store/get-detail",{method:"POST",data:f}));case 1:case"end":return r.stop()}},o)})),U.apply(this,arguments)}function P(o){return O.apply(this,arguments)}function O(){return O=v()(l()().mark(function o(f){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,E.request)("/dpanel/api/common/store/get-list",{method:"POST",data:f}));case 1:case"end":return r.stop()}},o)})),O.apply(this,arguments)}function N(o){return Z.apply(this,arguments)}function Z(){return Z=v()(l()().mark(function o(f){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,E.request)("/dpanel/api/common/store/delete",{method:"POST",data:f});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},o)})),Z.apply(this,arguments)}function b(o){return D.apply(this,arguments)}function D(){return D=v()(l()().mark(function o(f){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,E.request)(f==null?void 0:f.path,{method:"GET"}));case 1:case"end":return r.stop()}},o)})),D.apply(this,arguments)}}}]);
