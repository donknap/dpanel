"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3917],{44349:function(ae,V,e){var w=e(97857),v=e.n(w),H=e(15009),A=e.n(H),S=e(99289),z=e.n(S),Y=e(74763),T=e(17186),x=e(5966),y=e(86250),b=e(67294),C=e(85893),F=(0,b.forwardRef)(function(h,$){var D=(0,b.useRef)();(0,b.useImperativeHandle)($,function(){return{addItem:function(i){function s(m,n,u){return i.apply(this,arguments)}return s.toString=function(){return i.toString()},s}(function(i,s,m){var n,u=(n=D.current)===null||n===void 0?void 0:n.getList(),E;if(u==null||u.forEach(function(X,Q){X[i]==s[i]&&(E=Q)}),!(0,Y.k)(E)&&m){var t;(t=D.current)===null||t===void 0||t.remove(E),E=void 0}if(!E){var K;(K=D.current)===null||K===void 0||K.add(s)}}),removeItemByKey:function(s,m){return z()(A()().mark(function n(){var u,E;return A()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return E=(u=D.current)===null||u===void 0?void 0:u.getList(),E==null||E.forEach(function(X,Q){if(X[s]==m){var k;(k=D.current)===null||k===void 0||k.remove(Q);return}}),K.abrupt("return");case 3:case"end":return K.stop()}},n)}))()},clear:function(s){if(!s){var m;s=(m=D.current)===null||m===void 0||(m=m.getList())===null||m===void 0?void 0:m.map(function(u,E){return E})}if(s){var n;(n=D.current)===null||n===void 0||n.remove(s)}},getList:function(){var s;return(s=D.current)===null||s===void 0?void 0:s.getList()}}});var L={};return h.hideCopyButton===!0&&(L.copyIconProps=!1),h.hideDeleteButton===!0&&(L.deleteIconProps=!1),(0,C.jsx)(T.u,v()(v()({initialValue:h.initialValue,label:h.label,name:h.name,actionRef:D,creatorButtonProps:h.showAddButton?{creatorButtonText:h.label?h.label:h.showAddButtonLabel?h.showAddButtonLabel:h.name}:!1,min:h.min?h.min:0},L),{},{children:function(s,m,n){return(0,C.jsx)(y.Z,{justify:h.justify,gap:h.gap,children:h.items.map(function(u){return u.render?(0,C.jsx)("div",{children:u.render&&u.render(s,m,n)},"".concat(h.name,"-").concat(u.name,"-").concat(s.key)):(0,C.jsx)(x.Z,{width:u.width,name:u.name,label:u.label,required:u.required,rules:[{required:u.required}],disabled:u.disabled,placeholder:u.placeholder},"".concat(h.name,"-").concat(u.name,"-").concat(s.key))})})}}))});V.Z=F},36435:function(ae,V,e){var w=e(15009),v=e.n(w),H=e(64599),A=e.n(H),S=e(99289),z=e.n(S),Y=e(9783),T=e.n(Y),x=e(5574),y=e.n(x),b=e(67294),C=e(184),F=e(38345),h=e(97269),$=e(97321),D=e(97462),L=e(64317),i=e(5966),s=e(86615),m=e(68602),n=e(83622),u=e(83403),E=e(24963),t=e(1699),K=e(29177),X=e(1883),Q=e(43425),k=e(44349),oe=e(3616),ne=e(36146),O=e(85893),le=(0,b.forwardRef)(function(G,de){var ue=(0,b.useState)(!1),se=y()(ue,2),te=se[0],q=se[1],J=(0,b.useRef)(),M=(0,b.useContext)(E.Z),ee=M.message,re=(0,b.useState)([]),Z=y()(re,2),R=Z[0],d=Z[1],_=new ne.Uo("components.permissionButton"),N=T()(T()(T()(T()(T()({},u.W6.CONTAINER,"Id"),u.W6.APPSTORE,"name"),u.W6.COMPOSE,"name"),u.W6.REGISTRY,"serverAddress"),u.W6.DOCKER_ENV,"name"),I=T()(T()(T()(T()(T()({},u.W6.CONTAINER,"name"),u.W6.APPSTORE,"name"),u.W6.COMPOSE,"name"),u.W6.REGISTRY,"title"),u.W6.DOCKER_ENV,"title"),g=N[G.type],o=I[G.type],U=G.selected.map(function(P){return P[N[G.type]]});return b.useEffect(function(){if(te){if(!G.selected||G.selected.length==0){ee.error(ne.FD.format("title.noDataSelect")),q(!1);return}(0,m.dP)({permission:{uri:G.type,key:g,value:U}}).then(function(P){var a;(a=J.current)===null||a===void 0||a.setFieldValue("list",Object.keys(P.data.list).map(function(p){return{name:p,type:P.data.list[p].type,users:P.data.list[p].users}}))}),(0,m.lE)().then(function(P){var a,p=(a=P.data)===null||a===void 0||(a=a.list)===null||a===void 0?void 0:a.map(function(l){return{label:l.username,value:l.username}});d(p)})}},[te]),(0,O.jsx)(t.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,O.jsxs)(C.a,{name:"create",title:_.format("drawerTitle"),open:te,onOpenChange:function(a){if(!a){var p;(p=J.current)===null||p===void 0||p.resetFields()}q(a)},drawerProps:{forceRender:!0,width:oe.R_},formRef:J,trigger:(0,O.jsx)(n.ZP,{icon:(0,O.jsx)(K.Z,{}),children:_.format("drawerTriggerButton")}),onFinish:function(){var P=z()(v()().mark(function a(p){var l,r,f;return v()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:l=A()(p.list),c.prev=1,l.s();case 3:if((r=l.n()).done){c.next=9;break}return f=r.value,c.next=7,(0,m.Db)({usernames:f.users,permissionType:f.type,permission:{uri:G.type,key:g,showKey:o,value:[f.name]}});case 7:c.next=3;break;case 9:c.next=14;break;case 11:c.prev=11,c.t0=c.catch(1),l.e(c.t0);case 14:return c.prev=14,l.f(),c.finish(14);case 17:ee.success(ne.FD.format("finish")),q(!1),G.onSuccess();case 20:case"end":return c.stop()}},a,null,[[1,11,14,17]])}));return function(a){return P.apply(this,arguments)}}(),children:[(0,O.jsxs)(F.Z,{ghost:!0,title:(0,O.jsx)(X.Z,{}),subTitle:_.format("batchTitle"),children:[(0,O.jsx)(h.A.Item,{name:"type",style:{marginBottom:0},children:(0,O.jsx)($.Z.Group,{defaultValue:"admin",onChange:function(a){var p,l,r=(p=J.current)===null||p===void 0?void 0:p.getFieldValue("list");r.forEach(function(f){f.type=a,f.users=[]}),(l=J.current)===null||l===void 0||l.setFieldValue("list",r)},children:["admin","restricted","public"].map(function(P){return(0,O.jsx)($.Z,{style:{width:240},title:_.format("dataTypeOption.".concat(P)),description:_.format("dataTypeDescOption.".concat(P)),value:P},P)})})}),(0,O.jsx)(D.Z,{name:["type"],children:function(a){var p=a.type;if(p==="restricted")return(0,O.jsx)(L.Z,{mode:"multiple",name:"usernames",label:_.format("formUsernames"),onChange:function(r){var f,j,c=(f=J.current)===null||f===void 0?void 0:f.getFieldValue("list");c.forEach(function(B){B.users=r}),(j=J.current)===null||j===void 0||j.setFieldValue("list",c)},rules:[{required:!0}],request:z()(v()().mark(function l(){var r,f,j;return v()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(!(R.length>0)){B.next=2;break}return B.abrupt("return",R);case 2:return B.next=4,(0,m.lE)();case 4:return f=B.sent,j=(r=f.data)===null||r===void 0||(r=r.list)===null||r===void 0?void 0:r.map(function(W){return{label:W.username,value:W.username}}),d(j),B.abrupt("return",j);case 8:case"end":return B.stop()}},l)}))})}})]}),(0,O.jsx)(F.Z,{ghost:!0,title:(0,O.jsx)(Q.Z,{}),subTitle:_.format("dataTitle"),children:(0,O.jsx)(k.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:_.format("dataName"),render:function(a,p,l){var r=l.getCurrentRowData();return(0,O.jsx)(i.Z,{disabled:!0,label:_.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:_.format("dataType"),render:function(a,p,l){var r=l.getCurrentRowData();return(0,O.jsx)(s.Z.Group,{label:_.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(f){return{label:_.format("dataTypeOption.".concat(f)),value:f}})})}},{name:"users",label:_.format("dataUsers"),render:function(a,p,l){return(0,O.jsx)(D.Z,{name:["type"],children:function(f){var j=f.type;if(j=="restricted")return(0,O.jsx)(L.Z,{width:"sm",mode:"tags",name:"users",label:_.format("dataUsers"),options:R})}})}}]})})]})})});V.Z=le},3616:function(ae,V,e){e.d(V,{Ed:function(){return A},FK:function(){return v},R_:function(){return w},ob:function(){return H}});var w=window.innerWidth<=1024?"90vw":"65vw",v="90vw",H="60vw",A="50vh"},29337:function(ae,V,e){e.r(V),e.d(V,{default:function(){return J}});var w=e(15009),v=e.n(w),H=e(99289),A=e.n(H),S=e(5574),z=e.n(S),Y=e(3616),T=e(24963),x=e(15078),y=e(36146),b=e(184),C=e(5966),F=e(97462),h=e(86615),$=e(62370),D=e(82346),L=e(83622),i=e(42075),s=e(25593),m=e(66309),n=e(40056),u=e(79697),E=e(67294),t=e(85893),K=(0,E.forwardRef)(function(M,ee){var re=(0,E.useState)(!1),Z=z()(re,2),R=Z[0],d=Z[1],_=(0,E.useRef)(),N=(0,E.useContext)(T.Z),I=N.message,g=(0,D.useSearchParams)(),o=z()(g,2),U=o[0],P=o[1],a=new y.Uo("components.appstore");return(0,E.useImperativeHandle)(ee,function(){return{edit:function(l){var r;(r=_.current)===null||r===void 0||r.setFieldsValue({title:l.title,name:l.name,type:l.setting.type,url:l.setting.url,id:l.id}),d(!0)}}}),(0,E.useEffect)(function(){U.get("op")=="create"&&d(!0)},[]),(0,t.jsxs)(b.a,{name:"appstoreCreate",title:a.format("createDrawerTitle"),open:R,onOpenChange:function(l){var r;!l&&((r=_.current)===null||r===void 0||r.resetFields()),d(l)},drawerProps:{forceRender:!0,width:Y.R_},formRef:_,trigger:(0,t.jsx)(L.ZP,{type:"primary",children:a.format("createDrawerTitle")}),onFinish:function(){var p=A()(v()().mark(function l(r){var f,j,c;return v()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return r.type=="1panel-local"&&(r.url="/dpanel/store/".concat(r.name)),W.next=3,(0,x.ks)({name:r.name,url:r.url,type:r.type});case 3:if(f=W.sent,!(f&&f.data)){W.next=13;break}return W.next=7,(0,x.$c)({id:r.id,name:r.name,title:r.title,type:r.type,url:r.url,apps:f.data.list});case 7:if(j=W.sent,!(j&&j.data)){W.next=13;break}return I.success(y.FD.format("finish")),M.onFinish&&M.onFinish(),(c=_.current)===null||c===void 0||c.resetFields(),W.abrupt("return",!0);case 13:case"end":return W.stop()}},l)}));return function(l){return p.apply(this,arguments)}}(),children:[(0,t.jsx)(C.Z,{name:"id",hidden:!0}),(0,t.jsx)(C.Z,{label:a.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],placeholder:a.format("formTitleEmpty")}),(0,t.jsx)(F.Z,{name:["id"],children:function(l){var r=l.id;return(0,t.jsx)(C.Z,{label:a.format("formName"),name:"name",required:!0,disabled:!!r,rules:[{required:!0}],placeholder:a.format("formNameEmpty")})}}),(0,t.jsx)(h.Z.Group,{name:"type",label:a.format("formType"),options:a.option("formTypeOption",["casaos","1panel","1panel-local","baota"]),fieldProps:{onChange:function(l){var r;(r=_.current)===null||r===void 0||r.resetFields(["url"])}}}),(0,t.jsx)(F.Z,{name:["type","name"],children:function(l){var r=l.type,f=l.name,j=[],c=[];if(r=="1panel"&&(c=["https://gitee.com/qyg2297248353/appstore-dpanel","https://github.com/1Panel-dev/appstore","https://github.com/okxlin/appstore"],j=[(0,t.jsx)(C.Z,{label:a.format("formGitUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:a.format("formGitUrlEmpty")},"gitUrl")]),r=="baota"&&(c=[],j=[(0,t.jsx)(C.Z,{hidden:!0,label:a.format("formGitUrl"),name:"url",required:!0,rules:[{required:!0}],initialValue:"https://download.bt.cn/src/dk_app/apps",placeholder:a.format("formGitUrlEmpty")},"gitUrl")]),r=="portainer"&&(j=[(0,t.jsx)(C.Z,{label:a.format("formJsonUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:"https://github.com/Lissy93/portainer-templates/blob/main/templates.json"},"jsonUrl")]),r=="casaos"&&(c=["https://play.cuse.eu.org/Cp0204-AppStore-Play.zip"],j=[(0,t.jsx)(C.Z,{label:a.format("formZipUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:a.format("formZipUrlEmpty")},"zipUrl")]),r&&r!="1panel-local")return[j,!(0,u.Z)(c)&&(0,t.jsx)($.Z,{label:(0,t.jsxs)(i.Z,{children:[a.format("formRecommend"),(0,t.jsx)("a",{href:"https://dpanel.cc/manual/system-store",target:"_blank",children:y.FD.format("help")})]}),children:(0,t.jsx)(i.Z,{wrap:!0,children:c.map(function(B,W){return(0,t.jsx)(s.Z.Link,{onClick:function(){var ie;(ie=_.current)===null||ie===void 0||ie.setFieldValue("url",B)},children:(0,t.jsx)(m.Z,{color:"cyan",children:B})},W)})})},"recommend")];if(r=="1panel-local")return[j,(0,t.jsx)($.Z,{children:(0,t.jsx)(n.Z,{message:a.format("formLocalDesc",{name:f})})},"local-description")]}})]})}),X=K,Q=e(80821),k=e(36435),oe=e(98510),ne=e(83403),O=e(5251),le=e(99611),G=e(86548),de=e(98165),ue=e(82061),se=e(74453),te=e(96074),q=e(83062);function J(){var M=(0,E.useRef)(),ee=(0,D.useAccess)(),re=(0,E.useRef)();return(0,t.jsx)(se._z,{header:{extra:[ee.canSeeFounder&&(0,t.jsx)(X,{ref:re,onFinish:function(){var R,d;!((R=M.current)===null||R===void 0)&&R.reloadAndRest&&((d=M.current)===null||d===void 0||d.reloadAndRest())}},"create")]},children:(0,t.jsx)(oe.C,{rowKey:"id",columns:[{title:y.FD.format("listName"),dataIndex:"name",width:200},{title:y.FD.format("listTitle"),dataIndex:"title"},{title:y.FD.format("listTargetRoot"),width:500,search:!1,render:function(R,d,_,N,I){return(0,t.jsx)("a",{href:d.setting.url,target:"_blank",children:(0,t.jsx)(m.Z,{children:d.setting.url})})}},{title:y.FD.format("listUpdatedAt"),width:180,search:!1,render:function(R,d,_,N,I){if(d.setting.updatedAt)return(0,O.ZM)(d.setting.updatedAt*1e3)}},{title:y.FD.format("listManage"),width:150,search:!1,fixed:"right",render:function(R,d,_,N,I){return(0,t.jsxs)(i.Z,{split:(0,t.jsx)(te.Z,{type:"vertical"}),children:[(0,t.jsx)(D.Link,{to:"/compose/appstore",state:{name:d.name},children:(0,t.jsx)(q.Z,{title:y.FD.format("listManageView"),children:(0,t.jsx)(le.Z,{})})}),(0,t.jsx)(s.Z.Link,{onClick:function(){var o;(o=re.current)===null||o===void 0||o.edit(d)},children:(0,t.jsx)(q.Z,{title:y.FD.format("listManageEdit"),children:(0,t.jsx)(G.Z,{})})},"manage"),(0,t.jsx)(Q.Z,{buttonProps:{type:"link",icon:(0,t.jsx)(de.Z,{}),ghost:!0},action:function(){var o,U;return(0,x.ks)({id:d.id,name:d.name,url:(o=d.setting.url)!==null&&o!==void 0?o:"",type:(U=d.setting.type)!==null&&U!==void 0?U:""})},onSuccess:function(){var o,U;return!((o=M.current)===null||o===void 0)&&o.reloadAndRest&&((U=M.current)===null||U===void 0||U.reloadAndRest()),!0},onError:function(){var o,U;return!((o=M.current)===null||o===void 0)&&o.reloadAndRest&&((U=M.current)===null||U===void 0||U.reloadAndRest()),!0},tips:y.FD.format("listManageSync")},"upgrade")]})}}],request:function(){var Z=A()(v()().mark(function R(d,_,N){var I;return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,x.eO)({name:d.name,title:d.title});case 2:return I=o.sent,o.abrupt("return",{data:I.data.list,success:!0,total:I.data.list.length});case 4:case"end":return o.stop()}},R)}));return function(R,d,_){return Z.apply(this,arguments)}}(),actionRef:M,quickToolbarRender:function(R){var d=R.selectedRows,_=R.finish,N=R.loading;return(0,t.jsxs)(i.Z,{size:16,children:[(0,t.jsx)(k.Z,{type:ne.W6.APPSTORE,selected:d,onSuccess:function(){var g,o;return!((g=M.current)===null||g===void 0)&&g.reloadAndRest&&((o=M.current)===null||o===void 0||o.reloadAndRest()),!0}}),(0,t.jsx)(Q.Z,{buttonProps:{danger:!0,type:"primary",icon:(0,t.jsx)(ue.Z,{})},confirmProps:{showCommonConfirm:!0},action:function(){return N(),(0,x.Me)({id:d.map(function(g){return g.id})}).finally(function(){_(!0)})},onSuccess:function(){var g,o;return!((g=M.current)===null||g===void 0)&&g.reloadAndRest&&((o=M.current)===null||o===void 0||o.reloadAndRest()),!0},onError:function(){var g,o;return!((g=M.current)===null||g===void 0)&&g.reset&&((o=M.current)===null||o===void 0||o.reset()),!0},children:y.FD.format("listManageDeleteBatch")},"delete")]})}},"appstore-list")})}},15078:function(ae,V,e){e.d(V,{$c:function(){return z},Me:function(){return h},eO:function(){return C},ks:function(){return T},yL:function(){return D}});var w=e(15009),v=e.n(w),H=e(99289),A=e.n(H),S=e(82346);function z(i){return Y.apply(this,arguments)}function Y(){return Y=A()(v()().mark(function i(s){return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,S.request)("/dpanel/api/common/store/create",{method:"POST",data:s}));case 1:case"end":return n.stop()}},i)})),Y.apply(this,arguments)}function T(i){return x.apply(this,arguments)}function x(){return x=A()(v()().mark(function i(s){return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,S.request)("/dpanel/api/common/store/sync",{method:"POST",data:s}));case 1:case"end":return n.stop()}},i)})),x.apply(this,arguments)}function y(i){return b.apply(this,arguments)}function b(){return b=_asyncToGenerator(_regeneratorRuntime().mark(function i(s){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/dpanel/api/common/store/get-detail",{method:"POST",data:s}));case 1:case"end":return n.stop()}},i)})),b.apply(this,arguments)}function C(i){return F.apply(this,arguments)}function F(){return F=A()(v()().mark(function i(s){return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,S.request)("/dpanel/api/common/store/get-list",{method:"POST",data:s}));case 1:case"end":return n.stop()}},i)})),F.apply(this,arguments)}function h(i){return $.apply(this,arguments)}function $(){return $=A()(v()().mark(function i(s){return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,S.request)("/dpanel/api/common/store/delete",{method:"POST",data:s});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},i)})),$.apply(this,arguments)}function D(i){return L.apply(this,arguments)}function L(){return L=A()(v()().mark(function i(s){return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,S.request)(s==null?void 0:s.path,{method:"GET"}));case 1:case"end":return n.stop()}},i)})),L.apply(this,arguments)}}}]);
