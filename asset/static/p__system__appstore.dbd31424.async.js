"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3917],{44349:function(ne,G,e){var V=e(97857),p=e.n(V),N=e(15009),U=e.n(N),K=e(99289),w=e.n(K),H=e(74763),T=e(17186),B=e(5966),D=e(86250),b=e(67294),C=e(85893),Z=(0,b.forwardRef)(function(f,S){var y=(0,b.useRef)();(0,b.useImperativeHandle)(S,function(){return{addItem:function(i){function o(m,t,a){return i.apply(this,arguments)}return o.toString=function(){return i.toString()},o}(function(i,o,m){var t,a=(t=y.current)===null||t===void 0?void 0:t.getList(),r;if(a==null||a.forEach(function(Y,J){Y[i]==o[i]&&(r=J)}),!(0,H.k)(r)&&m){var z;(z=y.current)===null||z===void 0||z.remove(r),r=void 0}if(!r){var L;(L=y.current)===null||L===void 0||L.add(o)}}),removeItemByKey:function(o,m){return w()(U()().mark(function t(){var a,r;return U()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return r=(a=y.current)===null||a===void 0?void 0:a.getList(),r==null||r.forEach(function(Y,J){if(Y[o]==m){var Q;(Q=y.current)===null||Q===void 0||Q.remove(J);return}}),L.abrupt("return");case 3:case"end":return L.stop()}},t)}))()},clear:function(o){if(!o){var m;o=(m=y.current)===null||m===void 0||(m=m.getList())===null||m===void 0?void 0:m.map(function(a,r){return r})}if(o){var t;(t=y.current)===null||t===void 0||t.remove(o)}},getList:function(){var o;return(o=y.current)===null||o===void 0?void 0:o.getList()}}});var x={};return f.hideCopyButton===!0&&(x.copyIconProps=!1),f.hideDeleteButton===!0&&(x.deleteIconProps=!1),(0,C.jsx)(T.u,p()(p()({initialValue:f.initialValue,label:f.label,name:f.name,actionRef:y,creatorButtonProps:f.showAddButton?{creatorButtonText:f.label?f.label:f.showAddButtonLabel?f.showAddButtonLabel:f.name}:!1,min:f.min?f.min:0},x),{},{children:function(o,m,t){return(0,C.jsx)(D.Z,{justify:f.justify,gap:f.gap,children:f.items.map(function(a){return a.render?(0,C.jsx)("div",{children:a.render&&a.render(o,m,t)},"".concat(f.name,"-").concat(a.name,"-").concat(o.key)):(0,C.jsx)(B.Z,{width:a.width,name:a.name,label:a.label,required:a.required,rules:[{required:a.required}],disabled:a.disabled,placeholder:a.placeholder},"".concat(f.name,"-").concat(a.name,"-").concat(o.key))})})}}))});G.Z=Z},36435:function(ne,G,e){var V=e(15009),p=e.n(V),N=e(64599),U=e.n(N),K=e(99289),w=e.n(K),H=e(9783),T=e.n(H),B=e(5574),D=e.n(B),b=e(67294),C=e(184),Z=e(38345),f=e(97269),S=e(97321),y=e(97462),x=e(64317),i=e(5966),o=e(86615),m=e(68602),t=e(83622),a=e(83403),r=e(24963),z=e(1699),L=e(29177),Y=e(1883),J=e(43425),Q=e(44349),ae=e(3616),q=e(36146),O=e(85893),se=(0,b.forwardRef)(function(F,ie){var oe=(0,b.useState)(!1),te=D()(oe,2),k=te[0],ee=te[1],v=(0,b.useRef)(),re=(0,b.useContext)(r.Z),X=re.message,$=(0,b.useState)([]),M=D()($,2),d=M[0],A=M[1],g=new q.Uo("components.permissionButton"),W=T()(T()(T()(T()(T()({},a.W6.CONTAINER,"Id"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"serverAddress"),a.W6.DOCKER_ENV,"name"),j=T()(T()(T()(T()(T()({},a.W6.CONTAINER,"name"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"title"),a.W6.DOCKER_ENV,"title"),s=W[F.type],I=j[F.type],de=F.selected.map(function(l){return l[W[F.type]]});return b.useEffect(function(){if(k){if(!F.selected||F.selected.length==0){X.error(q.FD.format("title.noDataSelect")),ee(!1);return}(0,m.dP)({permission:{uri:F.type,key:s,value:de}}).then(function(l){var _;(_=v.current)===null||_===void 0||_.setFieldValue("list",Object.keys(l.data.list).map(function(u){return{name:u,type:l.data.list[u].type,users:l.data.list[u].users}}))}),(0,m.lE)().then(function(l){var _,u=(_=l.data)===null||_===void 0||(_=_.list)===null||_===void 0?void 0:_.map(function(n){return{label:n.username,value:n.username}});A(u)})}},[k]),(0,O.jsx)(z.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,O.jsxs)(C.a,{name:"create",title:g.format("drawerTitle"),open:k,onOpenChange:function(_){if(!_){var u;(u=v.current)===null||u===void 0||u.resetFields()}ee(_)},drawerProps:{forceRender:!0,width:ae.R_},formRef:v,trigger:(0,O.jsx)(t.ZP,{icon:(0,O.jsx)(L.Z,{}),children:g.format("drawerTriggerButton")}),onFinish:function(){var l=w()(p()().mark(function _(u){var n,h,c;return p()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:n=U()(u.list),P.prev=1,n.s();case 3:if((h=n.n()).done){P.next=9;break}return c=h.value,P.next=7,(0,m.Db)({usernames:c.users,permissionType:c.type,permission:{uri:F.type,key:s,showKey:I,value:[c.name]}});case 7:P.next=3;break;case 9:P.next=14;break;case 11:P.prev=11,P.t0=P.catch(1),n.e(P.t0);case 14:return P.prev=14,n.f(),P.finish(14);case 17:X.success(q.FD.format("finish")),ee(!1),F.onSuccess();case 20:case"end":return P.stop()}},_,null,[[1,11,14,17]])}));return function(_){return l.apply(this,arguments)}}(),children:[(0,O.jsxs)(Z.Z,{ghost:!0,title:(0,O.jsx)(Y.Z,{}),subTitle:g.format("batchTitle"),children:[(0,O.jsx)(f.A.Item,{name:"type",style:{marginBottom:0},children:(0,O.jsx)(S.Z.Group,{defaultValue:"admin",onChange:function(_){var u,n,h=(u=v.current)===null||u===void 0?void 0:u.getFieldValue("list");h.forEach(function(c){c.type=_,c.users=[]}),(n=v.current)===null||n===void 0||n.setFieldValue("list",h)},children:["admin","restricted","public"].map(function(l){return(0,O.jsx)(S.Z,{style:{width:240},title:g.format("dataTypeOption.".concat(l)),description:g.format("dataTypeDescOption.".concat(l)),value:l},l)})})}),(0,O.jsx)(y.Z,{name:["type"],children:function(_){var u=_.type;if(u==="restricted")return(0,O.jsx)(x.Z,{mode:"multiple",name:"usernames",label:g.format("formUsernames"),onChange:function(h){var c,R,P=(c=v.current)===null||c===void 0?void 0:c.getFieldValue("list");P.forEach(function(E){E.users=h}),(R=v.current)===null||R===void 0||R.setFieldValue("list",P)},rules:[{required:!0}],request:w()(p()().mark(function n(){var h,c,R;return p()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(!(d.length>0)){E.next=2;break}return E.abrupt("return",d);case 2:return E.next=4,(0,m.lE)();case 4:return c=E.sent,R=(h=c.data)===null||h===void 0||(h=h.list)===null||h===void 0?void 0:h.map(function(le){return{label:le.username,value:le.username}}),A(R),E.abrupt("return",R);case 8:case"end":return E.stop()}},n)}))})}})]}),(0,O.jsx)(Z.Z,{ghost:!0,title:(0,O.jsx)(J.Z,{}),subTitle:g.format("dataTitle"),children:(0,O.jsx)(Q.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:g.format("dataName"),render:function(_,u,n){var h=n.getCurrentRowData();return(0,O.jsx)(i.Z,{disabled:!0,label:g.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:g.format("dataType"),render:function(_,u,n){var h=n.getCurrentRowData();return(0,O.jsx)(o.Z.Group,{label:g.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(c){return{label:g.format("dataTypeOption.".concat(c)),value:c}})})}},{name:"users",label:g.format("dataUsers"),render:function(_,u,n){return(0,O.jsx)(y.Z,{name:["type"],children:function(c){var R=c.type;if(R=="restricted")return(0,O.jsx)(x.Z,{width:"sm",mode:"tags",name:"users",label:g.format("dataUsers"),options:d})}})}}]})})]})})});G.Z=se},3616:function(ne,G,e){e.d(G,{Ed:function(){return U},FK:function(){return p},R_:function(){return V},ob:function(){return N}});var V=window.innerWidth<=1024?"90vw":"65vw",p="90vw",N="60vw",U="50vh"},29337:function(ne,G,e){e.r(G),e.d(G,{default:function(){return ee}});var V=e(15009),p=e.n(V),N=e(99289),U=e.n(N),K=e(5574),w=e.n(K),H=e(3616),T=e(24963),B=e(15078),D=e(36146),b=e(184),C=e(5966),Z=e(97462),f=e(86615),S=e(62370),y=e(82346),x=e(83622),i=e(42075),o=e(25593),m=e(66309),t=e(40056),a=e(67294),r=e(85893),z=(0,a.forwardRef)(function(v,re){var X=(0,a.useState)(!1),$=w()(X,2),M=$[0],d=$[1],A=(0,a.useRef)(),g=(0,a.useContext)(T.Z),W=g.message,j=(0,y.useSearchParams)(),s=w()(j,2),I=s[0],de=s[1],l=new D.Uo("components.appstore");return(0,a.useImperativeHandle)(re,function(){return{edit:function(u){var n;(n=A.current)===null||n===void 0||n.setFieldsValue({title:u.title,name:u.name,type:u.setting.type,url:u.setting.url,id:u.id}),d(!0)}}}),(0,a.useEffect)(function(){I.get("op")=="create"&&d(!0)},[]),(0,r.jsxs)(b.a,{name:"appstoreCreate",title:l.format("createDrawerTitle"),open:M,onOpenChange:function(u){var n;!u&&((n=A.current)===null||n===void 0||n.resetFields()),d(u)},drawerProps:{forceRender:!0,width:H.R_},formRef:A,trigger:(0,r.jsx)(x.ZP,{type:"primary",children:l.format("createDrawerTitle")}),onFinish:function(){var _=U()(p()().mark(function u(n){var h,c,R;return p()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return n.type=="1panel-local"&&(n.url="/dpanel/store/".concat(n.name)),E.next=3,(0,B.ks)({name:n.name,url:n.url,type:n.type});case 3:if(h=E.sent,!(h&&h.data)){E.next=13;break}return E.next=7,(0,B.$c)({id:n.id,name:n.name,title:n.title,type:n.type,url:n.url,apps:h.data.list});case 7:if(c=E.sent,!(c&&c.data)){E.next=13;break}return W.success(D.FD.format("finish")),v.onFinish&&v.onFinish(),(R=A.current)===null||R===void 0||R.resetFields(),E.abrupt("return",!0);case 13:case"end":return E.stop()}},u)}));return function(u){return _.apply(this,arguments)}}(),children:[(0,r.jsx)(C.Z,{name:"id",hidden:!0}),(0,r.jsx)(C.Z,{label:l.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],placeholder:l.format("formTitleEmpty")}),(0,r.jsx)(Z.Z,{name:["id"],children:function(u){var n=u.id;return(0,r.jsx)(C.Z,{label:l.format("formName"),name:"name",required:!0,disabled:!!n,rules:[{required:!0}],placeholder:l.format("formNameEmpty")})}}),(0,r.jsx)(f.Z.Group,{name:"type",label:l.format("formType"),options:l.option("formTypeOption",["casaos","1panel","1panel-local","baota"]),fieldProps:{onChange:function(u){var n;(n=A.current)===null||n===void 0||n.resetFields(["url"])}}}),(0,r.jsx)(Z.Z,{name:["type","name"],children:function(u){var n=u.type,h=u.name,c=[],R=[];if(n=="1panel"&&(R=["https://gitee.com/qyg2297248353/appstore-dpanel","https://github.com/1Panel-dev/appstore","https://github.com/okxlin/appstore"],c=[(0,r.jsx)(C.Z,{label:l.format("formGitUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:l.format("formGitUrlEmpty")},"gitUrl")]),n=="baota"&&(R=["https://node.aapanel.com/src/dk_app/aapanel/apps/apps.json"],c=[(0,r.jsx)(C.Z,{label:l.format("formGitUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:l.format("formGitUrlEmpty")},"gitUrl")]),n=="portainer"&&(c=[(0,r.jsx)(C.Z,{label:l.format("formJsonUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:"https://github.com/Lissy93/portainer-templates/blob/main/templates.json"},"jsonUrl")]),n=="casaos"&&(R=["https://play.cuse.eu.org/Cp0204-AppStore-Play.zip"],c=[(0,r.jsx)(C.Z,{label:l.format("formZipUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:l.format("formZipUrlEmpty")},"zipUrl")]),n&&n!="1panel-local")return[c,(0,r.jsx)(S.Z,{label:(0,r.jsxs)(i.Z,{children:[l.format("formRecommend"),(0,r.jsx)("a",{href:"https://dpanel.cc/manual/system-store",target:"_blank",children:D.FD.format("help")})]}),children:(0,r.jsx)(i.Z,{wrap:!0,children:R.map(function(P,E){return(0,r.jsx)(o.Z.Link,{onClick:function(){var ue;(ue=A.current)===null||ue===void 0||ue.setFieldValue("url",P)},children:(0,r.jsx)(m.Z,{color:"cyan",children:P})},E)})})},"recommend")];if(n=="1panel-local")return[c,(0,r.jsx)(S.Z,{children:(0,r.jsx)(t.Z,{message:l.format("formLocalDesc",{name:h})})},"local-description")]}})]})}),L=z,Y=e(80821),J=e(36435),Q=e(98510),ae=e(83403),q=e(5251),O=e(99611),se=e(86548),F=e(98165),ie=e(82061),oe=e(74453),te=e(96074),k=e(83062);function ee(){var v=(0,a.useRef)(),re=(0,y.useAccess)(),X=(0,a.useRef)();return(0,r.jsx)(oe._z,{header:{extra:[re.canSeeFounder&&(0,r.jsx)(L,{ref:X,onFinish:function(){var M,d;!((M=v.current)===null||M===void 0)&&M.reloadAndRest&&((d=v.current)===null||d===void 0||d.reloadAndRest())}},"create")]},children:(0,r.jsx)(Q.C,{rowKey:"id",columns:[{title:D.FD.format("listName"),dataIndex:"name",width:200},{title:D.FD.format("listTitle"),dataIndex:"title"},{title:D.FD.format("listTargetRoot"),width:500,search:!1,render:function(M,d,A,g,W){return(0,r.jsx)("a",{href:d.setting.url,target:"_blank",children:(0,r.jsx)(m.Z,{children:d.setting.url})})}},{title:D.FD.format("listUpdatedAt"),width:180,search:!1,render:function(M,d,A,g,W){if(d.setting.updatedAt)return(0,q.ZM)(d.setting.updatedAt*1e3)}},{title:D.FD.format("listManage"),width:150,search:!1,fixed:"right",render:function(M,d,A,g,W){return(0,r.jsxs)(i.Z,{split:(0,r.jsx)(te.Z,{type:"vertical"}),children:[(0,r.jsx)(y.Link,{to:"/compose/appstore",state:{name:d.name},children:(0,r.jsx)(k.Z,{title:D.FD.format("listManageView"),children:(0,r.jsx)(O.Z,{})})}),(0,r.jsx)(o.Z.Link,{onClick:function(){var s;(s=X.current)===null||s===void 0||s.edit(d)},children:(0,r.jsx)(k.Z,{title:D.FD.format("listManageEdit"),children:(0,r.jsx)(se.Z,{})})},"manage"),(0,r.jsx)(Y.Z,{buttonProps:{type:"link",icon:(0,r.jsx)(F.Z,{}),ghost:!0},action:function(){var s,I;return(0,B.ks)({id:d.id,name:d.name,url:(s=d.setting.url)!==null&&s!==void 0?s:"",type:(I=d.setting.type)!==null&&I!==void 0?I:""})},onSuccess:function(){var s,I;return!((s=v.current)===null||s===void 0)&&s.reloadAndRest&&((I=v.current)===null||I===void 0||I.reloadAndRest()),!0},onError:function(){var s,I;return!((s=v.current)===null||s===void 0)&&s.reloadAndRest&&((I=v.current)===null||I===void 0||I.reloadAndRest()),!0},tips:D.FD.format("listManageSync")},"upgrade")]})}}],request:function(){var $=U()(p()().mark(function M(d,A,g){var W;return p()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,B.eO)({name:d.name,title:d.title});case 2:return W=s.sent,s.abrupt("return",{data:W.data.list,success:!0,total:W.data.list.length});case 4:case"end":return s.stop()}},M)}));return function(M,d,A){return $.apply(this,arguments)}}(),actionRef:v,quickToolbarRender:function(M){var d=M.selectedRows,A=M.finish,g=M.loading;return(0,r.jsxs)(i.Z,{size:16,children:[(0,r.jsx)(J.Z,{type:ae.W6.APPSTORE,selected:d,onSuccess:function(){var j,s;return!((j=v.current)===null||j===void 0)&&j.reloadAndRest&&((s=v.current)===null||s===void 0||s.reloadAndRest()),!0}}),(0,r.jsx)(Y.Z,{buttonProps:{danger:!0,type:"primary",icon:(0,r.jsx)(ie.Z,{})},confirmProps:{showCommonConfirm:!0},action:function(){return g(),(0,B.Me)({id:d.map(function(j){return j.id})}).finally(function(){A(!0)})},onSuccess:function(){var j,s;return!((j=v.current)===null||j===void 0)&&j.reloadAndRest&&((s=v.current)===null||s===void 0||s.reloadAndRest()),!0},onError:function(){var j,s;return!((j=v.current)===null||j===void 0)&&j.reset&&((s=v.current)===null||s===void 0||s.reset()),!0},children:D.FD.format("listManageDeleteBatch")},"delete")]})}},"appstore-list")})}},15078:function(ne,G,e){e.d(G,{$c:function(){return w},Me:function(){return f},eO:function(){return C},ks:function(){return T},yL:function(){return y}});var V=e(15009),p=e.n(V),N=e(99289),U=e.n(N),K=e(82346);function w(i){return H.apply(this,arguments)}function H(){return H=U()(p()().mark(function i(o){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,K.request)("/api/common/store/create",{method:"POST",data:o}));case 1:case"end":return t.stop()}},i)})),H.apply(this,arguments)}function T(i){return B.apply(this,arguments)}function B(){return B=U()(p()().mark(function i(o){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,K.request)("/api/common/store/sync",{method:"POST",data:o}));case 1:case"end":return t.stop()}},i)})),B.apply(this,arguments)}function D(i){return b.apply(this,arguments)}function b(){return b=_asyncToGenerator(_regeneratorRuntime().mark(function i(o){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/common/store/get-detail",{method:"POST",data:o}));case 1:case"end":return t.stop()}},i)})),b.apply(this,arguments)}function C(i){return Z.apply(this,arguments)}function Z(){return Z=U()(p()().mark(function i(o){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,K.request)("/api/common/store/get-list",{method:"POST",data:o}));case 1:case"end":return t.stop()}},i)})),Z.apply(this,arguments)}function f(i){return S.apply(this,arguments)}function S(){return S=U()(p()().mark(function i(o){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,K.request)("/api/common/store/delete",{method:"POST",data:o});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},i)})),S.apply(this,arguments)}function y(i){return x.apply(this,arguments)}function x(){return x=U()(p()().mark(function i(o){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,K.request)(o==null?void 0:o.path,{method:"GET"}));case 1:case"end":return t.stop()}},i)})),x.apply(this,arguments)}}}]);
