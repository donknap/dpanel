"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{75293:function(k,C,r){r.d(C,{Z:function(){return T}});var j=r(25593),_=r(85893);function T(h){return(0,_.jsx)(j.Z.Text,{copyable:!0,style:{padding:10,display:h.block?"block":"",background:"#24292f",color:"#ffffff"},children:h.content})}},77273:function(k,C,r){var j=r(15009),_=r.n(j),T=r(99289),h=r.n(T),M=r(5574),b=r.n(M),A=r(184),m=r(5966),g=r(86615),D=r(97462),U=r(64317),p=r(52688),c=r(62370),s=r(38345),Y=r(31199),d=r(90672),R=r(71230),S=r(15746),$=r(42075),L=r(86250),G=r(40056),O=r(67294),J=r(87662),x=r(12491),Q=r(89035),F=r(36146),N=r(3616),w=r(75293),X=r(2831),e=r(85893),K=(0,O.forwardRef)(function(W,Z){var V;(0,O.useImperativeHandle)(Z,function(){return{edit:function(a){var n,l=a.address.split("://"),i=b()(l,2),E=i[0],v=i[1];(n=f.current)===null||n===void 0||n.setFieldsValue({name:a.name,title:a.title,addressType:"".concat(E=="ssh"?"tcp":E,"://"),address:v,serverUrl:a.serverUrl,enableTLS:a.enableTLS,tlsCa:a.tlsCa,tlsCert:a.tlsCert,tlsKey:a.tlsKey,enableComposePath:a.enableComposePath,enableSSH:a.enableSSH,sshServerInfo:a.sshServerInfo,remoteType:a.remoteType?a.remoteType:"docker"}),ee(!0),ne(a.name)}}}),(0,O.useEffect)(function(){(0,X.aF)().then(function(I){I.data.rsa.public&&H(I.data.rsa.public)})},[]);var z=(0,O.useState)(),B=b()(z,2),y=B[0],H=B[1],t=new F.Uo("components.dockerEnvCreate"),te=(0,O.useState)(!1),q=b()(te,2),se=q[0],ee=q[1],f=(0,O.useRef)(),ae=(0,O.useState)(""),re=b()(ae,2),oe=re[0],ne=re[1];return(0,e.jsxs)(A.a,{drawerProps:{forceRender:!0,width:N.R_},onOpenChange:function(a){if(!a){var n;ne(""),(n=f.current)===null||n===void 0||n.resetFields()}ee(a)},open:se,width:800,trigger:W.trigger,formRef:f,title:t.format((V=f.current)!==null&&V!==void 0&&V.getFieldValue&&f.current.getFieldValue("name")=="local"?"drawerTitleDefault":"drawerTitle"),onFinish:function(){var I=h()(_()().mark(function a(n){var l,i,E,v;return _()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i="",n.remoteType&&n.remoteType=="ssh"?i="ssh://":i=(E=n.addressType)!==null&&E!==void 0?E:"unix://",o.next=4,(0,J.ad)({name:n.name,title:n.title,address:"".concat(i).concat((l=n.address)!==null&&l!==void 0?l:n.sshServerInfo.address),serverUrl:n.serverUrl,enableTLS:n.enableTLS,tlsCa:n.tlsCa,tlsCert:n.tlsCert,tlsKey:n.tlsKey,enableComposePath:n.enableComposePath,composePath:n.enableComposePath?n.composePath:"",enableSSH:n.enableSSH||n.remoteType=="ssh",sshServerInfo:n.sshServerInfo,remoteType:n.remoteType});case 4:return v=o.sent,W.onFinish&&W.onFinish(),o.abrupt("return",!0);case 7:case"end":return o.stop()}},a)}));return function(a){return I.apply(this,arguments)}}(),children:[(0,e.jsx)(m.Z,{label:t.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle"}},"envTitle"),(0,e.jsx)(m.Z,{label:t.format("formName"),name:"name",required:!0,disabled:oe!="",rules:[{required:!0}],placeholder:t.format("formNameEmpty")}),(0,e.jsx)(m.Z,{tooltip:t.format("formServerUrlTip"),label:t.format("formServerUrl"),name:"serverUrl",placeholder:t.format("formServerUrlEmpty")}),(0,e.jsx)(g.Z.Group,{label:t.format("formRemoteType"),name:"remoteType",options:[{label:"DockerApi",value:"docker"},{label:"SSH",value:"ssh"}]}),(0,e.jsx)(D.Z,{name:["remoteType","name"],children:function(a){var n=a.remoteType,l=a.name;return(0,e.jsxs)(e.Fragment,{children:[n=="docker"&&(0,e.jsx)(R.Z,{children:(0,e.jsx)(S.Z,{span:24,children:(0,e.jsxs)($.Z.Compact,{children:[(0,e.jsx)(U.Z,{name:"addressType",label:t.format("formAddressType"),valueEnum:{"unix://":"unix://","tcp://":"tcp://"},initialValue:"tcp://",fieldProps:{defaultValue:"tcp://"},width:"sm",tooltip:t.format("formAddressTypeTip")}),(0,e.jsx)(m.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:t.format("formAddressEmpty")})]})})}),(0,e.jsxs)(R.Z,{gutter:[15,0],children:[n=="docker"&&(0,e.jsx)(S.Z,{children:(0,e.jsx)(p.Z,{label:t.format("formEnableTLS"),name:"enableTLS",tooltip:t.format("formEnableTLSTip")})}),l!="local"&&typeof n!="undefined"&&(0,e.jsx)(S.Z,{children:(0,e.jsx)(p.Z,{label:t.format("formEnableComposePath"),name:"enableComposePath",tooltip:t.format("formEnableComposePathTip")})}),n=="docker"&&(0,e.jsx)(S.Z,{children:(0,e.jsx)(p.Z,{label:t.format("formEnableSSH"),name:"enableSSH"})})]})]})}}),(0,e.jsx)(D.Z,{name:["enableTLS","remoteType"],children:function(a){var n=a.enableTLS,l=a.remoteType;if(n&&l=="docker"){var i,E,v;return(0,e.jsxs)(L.Z,{gap:10,justify:"start",children:[(0,e.jsx)(c.Z,{name:"tlsCa",label:t.format("formTlsCa"),children:(0,e.jsx)(x.Z,{showPaset:!0,data:(i=f.current)===null||i===void 0?void 0:i.getFieldValue("tlsCa"),title:"ca.pem",onImport:function(o){var P;return(P=f.current)===null||P===void 0||P.setFieldValue("tlsCa",o),!0},onLoad:function(o){if(o.indexOf("CERTIFICATE")<0)throw new Error(t.format("formEnableTLSMessageUploadError",{name:"ca.pem"}));return!0}})}),(0,e.jsx)(c.Z,{name:"tlsCert",label:" ",children:(0,e.jsx)(x.Z,{showPaset:!0,data:(E=f.current)===null||E===void 0?void 0:E.getFieldValue("tlsCert"),title:"cert.pem",onImport:function(o){var P;return(P=f.current)===null||P===void 0||P.setFieldValue("tlsCert",o),!0},onLoad:function(o){if(o.indexOf("CERTIFICATE")<0)throw new Error(t.format("formEnableTLSMessageUploadError",{name:"cert.pem"}));return!0}})}),(0,e.jsx)(c.Z,{label:" ",name:"tlsKey",children:(0,e.jsx)(x.Z,{showPaset:!0,data:(v=f.current)===null||v===void 0?void 0:v.getFieldValue("tlsKey"),title:"key.pem",onImport:function(o){var P;return(P=f.current)===null||P===void 0||P.setFieldValue("tlsKey",o),!0},onLoad:function(o){if(o.indexOf("PRIVATE")<0)throw new Error(t.format("formEnableTLSMessageUploadError",{name:"key.pem"}));return!0}})})]})}}}),(0,e.jsx)(D.Z,{name:["enableComposePath","name"],children:function(a){var n=a.enableComposePath,l=a.name;if(n)return(0,e.jsx)(m.Z,{label:t.format("formComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(l!=null?l:"")}})}}),(0,e.jsx)(D.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(a){var n=a.enableSSH,l=a.sshServerInfo,i=a.remoteType,E=a.address;return(n||i=="ssh")&&[(0,e.jsxs)(s.Z,{title:(0,e.jsx)(Q.Z,{}),subTitle:t.format("formEnableSSHTitle"),ghost:!0,children:[(0,e.jsxs)(e.Fragment,{children:[i=="ssh"&&(0,e.jsx)(c.Z,{children:(0,e.jsx)(G.Z,{message:(0,e.jsxs)(e.Fragment,{children:[t.format("formEnableSSHAlert")," \xA0",(0,e.jsx)("a",{href:"https://dpanel.cc/manual/system-env#ssh",target:"_blank",children:F.FD.format("help")})]})})}),(0,e.jsx)(m.Z,{label:t.format("formSshServerInfoAddress"),placeholder:t.format("formSshServerInfoAddressEmpty"),name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,e.jsxs)(R.Z,{children:[(0,e.jsx)(S.Z,{children:(0,e.jsx)(Y.Z,{initialValue:22,label:t.format("formSshServerInfoPort"),name:["sshServerInfo","port"]})}),(0,e.jsx)(S.Z,{offset:2,children:(0,e.jsx)(m.Z,{width:"lg",label:t.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]})})]}),(0,e.jsx)(g.Z.Group,{label:t.format("formSshServerInfoAuthType"),name:["sshServerInfo","authType"],options:t.option("formSshServerInfoAuthTypeOption",["basic","pem","pemDefault"]),fieldProps:{onChange:function(){var u;(u=f.current)===null||u===void 0||u.setFieldValue(["sshServerInfo","password"],"")}},required:!0,rules:[{required:!0}]}),l&&l.authType=="basic"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(m.Z.Password,{label:t.format("formSshServerInfoPassword"),name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})}),l&&l.authType=="pem"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(x.Z,{title:t.format("formSshServerInfoPrivateKeyImport"),onImport:function(u){var o;return(o=f.current)===null||o===void 0||o.setFieldValue(["sshServerInfo","privateKey"],u),!0},onLoad:function(u){if(!u.includes("PRIVATE KEY"))throw new Error(t.format("formEnableTLSMessageUploadError",{name:"private.key"}));return!0}}),(0,e.jsx)(d.Z,{name:["sshServerInfo","privateKey"],label:t.format("formSshServerInfoPrivateKey"),required:!0,rules:[{required:!0}]}),(0,e.jsx)(m.Z.Password,{name:["sshServerInfo","password"],label:t.format("formSshServerInfoPrivateKeyPassword")})]}),l&&l.authType=="pemDefault"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(D.Z,{name:["sshServerInfo"],children:function(u){var o=u.sshServerInfo;if(!(!o||!o.username))return[(0,e.jsx)(G.Z,{message:t.format("formSshServerInfoAddPublicKey",{user:o.username}),style:{marginBottom:15}},"message"),y&&(0,e.jsx)(w.Z,{content:'mkdir -p ~/.ssh && chmod 700 ~/.ssh && ! grep -q "'.concat(y.substring(y.length/2,y.length/2+18),`" ~/.ssh/authorized_keys 2>/dev/null && echo "
`).concat(y,'" >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys'),block:!0},"copycode")]}})})]},"sshSetting")]}})]})});C.Z=K},12491:function(k,C,r){r.d(C,{Z:function(){return Y}});var j=r(5574),_=r.n(j),T=r(3616),h=r(24963),M=r(36146),b=r(88484),A=r(57546),m=r(62370),g=r(11106),D=r(42075),U=r(83622),p=r(85576),c=r(67294),s=r(85893);function Y(d){var R=(0,c.useContext)(h.Z),S=R.message,$=R.notice,L=(0,c.useRef)(null),G=(0,c.useState)(!1),O=_()(G,2),J=O[0],x=O[1],Q=(0,c.useState)(""),F=_()(Q,2),N=F[0],w=F[1];(0,c.useEffect)(function(){d.data&&w(d.data)},[d.data]);var X=function(){L.current&&(L.current.click(),L.current.onchange=function(K){if(!K||!K.target)return"";var W=new FileReader;W.onload=function(z){var B,y,H=(B=z.target)===null||B===void 0?void 0:B.result;if(d.onLoad)try{d.onLoad&&d.onLoad(H)}catch(t){$.error(t);return}w(H),typeof d.onImport=="function"&&(S.success(M.FD.format("finish")),d.onImport(H)),(y=L.current)!==null&&y!==void 0&&y.value&&(L.current.value="")};var Z=K.target;if(Z.files&&Z.files[0]){var V=Z.files[0];try{W.readAsText(V)}catch(z){$.error(M.FD.format("commonContentIncorrectFormat",{name:Z.files[0].name}))}}})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{children:(0,s.jsxs)(D.Z.Compact,{block:!0,children:[(0,s.jsx)(U.ZP,{icon:(0,s.jsx)(b.Z,{}),block:!0,onClick:X,children:d.title}),d.showPaset&&(0,s.jsx)(U.ZP,{icon:(0,s.jsx)(A.Z,{}),onClick:function(){x(!0)}})]})}),(0,s.jsx)("input",{style:{display:"none"},type:"file",ref:L,name:"importFileInput"}),(0,s.jsx)(p.Z,{width:T.ob,open:J,onCancel:function(){x(!1)},onOk:function(){typeof d.onImport=="function"&&(S.success(M.FD.format("finish")),d.onImport(N)),x(!1)},children:(0,s.jsx)(g.ZP,{height:T.Ed,theme:"dark",value:N,onChange:function(K){w(K)}})})]})}},3616:function(k,C,r){r.d(C,{Ed:function(){return h},FK:function(){return _},R_:function(){return j},ob:function(){return T}});var j=window.innerWidth<=1024?"90vw":"65vw",_="90vw",T="60vw",h="50vh"},2831:function(k,C,r){r.d(C,{Ll:function(){return D},aF:function(){return b},u5:function(){return m}});var j=r(15009),_=r.n(j),T=r(99289),h=r.n(T),M=r(82346);function b(){return A.apply(this,arguments)}function A(){return A=h()(_()().mark(function p(){return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,M.request)("/api/common/home/info",{method:"POST"});case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}},p)})),A.apply(this,arguments)}function m(){return g.apply(this,arguments)}function g(){return g=h()(_()().mark(function p(){return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,M.request)("/api/common/home/check-new-version",{method:"POST"});case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}},p)})),g.apply(this,arguments)}function D(){return U.apply(this,arguments)}function U(){return U=h()(_()().mark(function p(){return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,M.request)("/api/common/home/usage",{method:"POST"});case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}},p)})),U.apply(this,arguments)}}}]);
