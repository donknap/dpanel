!(function(){var oe=Object.defineProperty,le=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var ee=(w,C,t)=>C in w?oe(w,C,{enumerable:!0,configurable:!0,writable:!0,value:t}):w[C]=t,te=(w,C)=>{for(var t in C||(C={}))ue.call(C,t)&&ee(w,t,C[t]);if(q)for(var t of q(C))ce.call(C,t)&&ee(w,t,C[t]);return w},re=(w,C)=>le(w,_e(C));(self.webpackChunk=self.webpackChunk||[]).push([[6296],{52688:function(w,C,t){"use strict";var P=t(1413),c=t(45987),T=t(67294),u=t(40284),h=t(85893),d=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],v=T.forwardRef(function(b,e){var r=b.fieldProps,a=b.unCheckedChildren,n=b.checkedChildren,i=b.proFieldProps,o=(0,c.Z)(b,d);return(0,h.jsx)(u.Z,(0,P.Z)({valueType:"switch",fieldProps:(0,P.Z)({unCheckedChildren:a,checkedChildren:n},r),ref:e,valuePropName:"checked",proFieldProps:i,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},o))});C.Z=v},90672:function(w,C,t){"use strict";var P=t(1413),c=t(45987),T=t(67294),u=t(40284),h=t(85893),d=["fieldProps","proFieldProps"],v=function(e,r){var a=e.fieldProps,n=e.proFieldProps,i=(0,c.Z)(e,d);return(0,h.jsx)(u.Z,(0,P.Z)({ref:r,valueType:"textarea",fieldProps:a,proFieldProps:n},i))};C.Z=T.forwardRef(v)},74026:function(w,C,t){"use strict";var P=t(15009),c=t.n(P),T=t(99289),u=t.n(T),h=t(5574),d=t.n(h),v=t(66554),b=t(184),e=t(86615),r=t(97462),a=t(90672),n=t(64317),i=t(5966),o=t(62370),l=t(52688),p=t(83622),m=t(42075),D=t(71230),g=t(15746),y=t(67294),B=t(12491),Z=t(75544),I=t(77865),K=t(63713),O=t(3616),A=t(36146),E=t(85893),k=(0,y.forwardRef)(function(R,$){var j=(0,y.useState)(!1),_=d()(j,2),f=_[0],M=_[1],s=(0,y.useRef)(),G=(0,y.useRef)(),V=(0,y.useState)([]),N=d()(V,2),H=N[0],X=N[1],ne=(0,K.useModel)("subscriber"),se=(0,y.useState)(),Q=d()(se,2),ie=Q[0],J=Q[1],S=new A.Uo("components.appDomain");return ne.addDataHandler("domain:apply",function(Y){var W;(W=G.current)===null||W===void 0||W.write(Y.data)}),(0,y.useImperativeHandle)($,function(){return{edit:function(W){var L,x;J(W),(L=s.current)===null||L===void 0||L.resetFields(),(x=s.current)===null||x===void 0||x.setFieldsValue({type:W.CA=="import"?"upload":"apply",domain:W.domain,dnsApi:W.dnsApi,sslKeyContent:W.sslKeyContent,sslCrtContent:W.sslCrtContent}),M(!0)}}}),(0,y.useEffect)(function(){(0,v.q2)().then(function(Y){X(Y.data.setting.map(function(W){return{label:W.title,value:W.serverName}}))})},[]),(0,E.jsx)(E.Fragment,{children:(0,E.jsxs)(b.a,{title:S.format("certTitle"),drawerProps:{forceRender:!0,width:O.R_},trigger:(0,E.jsx)(p.ZP,{type:"primary",children:S.format("certTitle")}),formRef:s,onFinish:function(){var Y=u()(c()().mark(function W(L){var x,F,U,ae;return c()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if((x=G.current)===null||x===void 0||x.clear(),L.type!="upload"){z.next=7;break}return z.next=4,(0,v.ui)({type:L.type,sslKeyContent:L.sslKeyContent,sslCrtContent:L.sslCrtContent});case 4:F=z.sent,z.next=11;break;case 7:return localStorage.setItem("email",(U=L.email)!==null&&U!==void 0?U:""),z.next=10,(0,v.Pf)({type:L.type,domain:L.domain,email:L.email,certServer:L.certServer,autoUpgrade:L.autoUpgrade,renew:L.renew,debug:L.debug,dnsApi:L.dnsApi});case 10:ae=z.sent;case 11:return R.onFinish&&R.onFinish(),z.abrupt("return",!0);case 13:case"end":return z.stop()}},W)}));return function(W){return Y.apply(this,arguments)}}(),onOpenChange:function(W){var L,x;if(!W){var F;J(void 0),(F=s.current)===null||F===void 0||F.resetFields()}if(R.domain&&R.domain.length>0){var U;(U=s.current)===null||U===void 0||U.setFieldValue("domain",R.domain)}(L=s.current)===null||L===void 0||L.setFieldsValue({email:(x=localStorage.getItem("email"))!==null&&x!==void 0?x:""}),M(W)},open:f,children:[(0,E.jsx)(e.Z.Group,{label:S.format("certFormType"),name:"type",initialValue:"apply",disabled:!!ie,options:S.option("certFormTypeOption",["upload","apply"])}),(0,E.jsx)(r.Z,{name:["type"],children:function(W){var L=W.type;return L=="upload"?[(0,E.jsx)(a.Z,{fieldProps:{rows:10},label:S.format("certFormSslCrtContent"),name:"sslCrtContent",tooltip:S.format("certFormSslCrtContentTip"),placeholder:"-----BEGIN CERTIFICATE-----",required:!0},"sslCrt"),(0,E.jsx)(B.Z,{title:S.format("certFormImportCrt"),onImport:function(F){var U;return(U=s.current)===null||U===void 0||U.setFieldValue("sslCrtContent",F),!0},onLoad:function(F){if(F.indexOf("BEGIN CERTIFICATE")<0)throw new Error(A.FD.format("commonFileIncorrectFormat",{name:".crt"}));return!0}},"importCrt"),(0,E.jsx)(a.Z,{fieldProps:{rows:10},label:S.format("certFormSslKeyContent"),name:"sslKeyContent",tooltip:S.format("certFormSslKeyContentTip"),placeholder:"-----BEGIN PRIVATE KEY-----",required:!0},"sslKey"),(0,E.jsx)(B.Z,{title:S.format("certFormImportKey"),onImport:function(F){var U;return(U=s.current)===null||U===void 0||U.setFieldValue("sslKeyContent",F),!0},onLoad:function(F){if(F.indexOf("PRIVATE KEY")<0)throw new Error(A.FD.format("commonFileIncorrectFormat",{name:".key"}));return!0}},"importKey")]:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(n.Z,{mode:"tags",name:"domain",label:S.format("certFormDomain"),placeholder:S.format("certFormDomainEmpty"),required:!0,rules:[{required:!0}]},"domain"),(0,E.jsx)(i.Z,{label:S.format("certFormEmail"),name:"email",required:!0,rules:[{required:!0}]}),(0,E.jsxs)(m.Z.Compact,{children:[(0,E.jsx)(n.Z,{label:S.format("certFormDnsApi"),tooltip:S.format("certFormDnsApiTip"),name:"dnsApi",width:"lg",required:!0,rules:[{required:!0}],options:H}),(0,E.jsx)(o.Z,{label:" ",children:(0,E.jsx)(I.Z,{onFinish:function(F){X(F.map(function(U){return{label:U.title,value:U.serverName}}))}},"dns")})]}),(0,E.jsx)(n.Z,{label:S.format("certFormCertServer"),name:"certServer",tooltip:S.format("certFormCertServerTip"),initialValue:"letsencrypt",options:[{value:"letsencrypt",label:"Let's Encrypt"},{value:"zerossl",label:"ZeroSSL"}]}),(0,E.jsxs)(D.Z,{gutter:[20,10],children:[(0,E.jsx)(g.Z,{children:(0,E.jsx)(l.Z,{label:S.format("certFormAutoUpgrade"),name:"autoUpgrade",initialValue:!0})}),(0,E.jsx)(g.Z,{children:(0,E.jsx)(l.Z,{tooltip:S.format("certFormRenewTip"),label:S.format("certFormRenew"),name:"renew",initialValue:!1})}),(0,E.jsx)(g.Z,{children:(0,E.jsx)(l.Z,{tooltip:S.format("certFormDebugTip"),label:"Debug",name:"debug",initialValue:!1})}),(0,E.jsx)(g.Z,{})]}),(0,E.jsx)(Z.Z,{height:"200px",style:{fontSize:12},ref:G})]})}})]})})});C.Z=k},77865:function(w,C,t){"use strict";var P=t(15009),c=t.n(P),T=t(99289),u=t.n(T),h=t(5574),d=t.n(h),v=t(184),b=t(86615),e=t(97462),r=t(5966),a=t(83622),n=t(67294),i=t(44349),o=t(52255),l=t(66554),p=t(3616),m=t(36146),D=t(85893),g=new m.Uo("components.appDomain"),y=[{value:"dns_cf",label:"CloudFlare",fields:[{name:"CF_Token"}],help:"https://dash.cloudflare.com/profile/api-tokens"},{value:"dns_dp",label:"DNSPod",fields:[{name:"DP_Id"},{name:"DP_Key"}],help:"https://console.dnspod.cn/account/token/token"},{value:"dns_tencent",label:g.format("dnsApiOption.dns_tencent"),fields:[{name:"Tencent_SecretId"},{name:"Tencent_SecretKey"}],help:"https://console.cloud.tencent.com/cam/capi"},{label:g.format("dnsApiOption.dns_ali"),value:"dns_ali",fields:[{name:"Ali_Key"},{name:"Ali_Secret"}],help:"https://ram.console.aliyun.com/users"},{label:g.format("dnsApiOption.dns_huaweicloud"),value:"dns_huaweicloud",fields:[{name:"HUAWEICLOUD_Username"},{name:"HUAWEICLOUD_Password"},{name:"HUAWEICLOUD_DomainName"}],help:"https://support.huaweicloud.com/api-iam/iam_01_0006.html"},{label:"GoDaddy",value:"dns_gd",fields:[{name:"GD_Key"},{name:"GD_Secret"}],help:"https://developer.godaddy.com/keys/"},{label:g.format("dnsApiOption.user"),value:"user",help:"https://github.com/acmesh-official/acme.sh/wiki/dnsapi"}],B=(0,n.forwardRef)(function(Z,I){(0,n.useImperativeHandle)(I,function(){return{show:function(){E(!0)}}});var K=(0,n.useState)(!1),O=d()(K,2),A=O[0],E=O[1],k=(0,n.useRef)();return(0,D.jsxs)(v.a,{drawerProps:{width:p.R_},title:g.format("dnsApiTitle"),trigger:(0,D.jsx)(a.ZP,{children:g.format("dnsApiTitle")}),formRef:k,open:A,onFinish:function(){var R=u()(c()().mark(function $(j){var _,f;return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,l.q2)({account:Object.keys((_=j.account)!==null&&_!==void 0?_:{}).map(function(G){var V;return{title:(V=y.find(function(N){return N.value==G}))===null||V===void 0?void 0:V.label,serverName:G,env:Object.keys(j.account[G]).map(function(N){return{name:N,value:j.account[G][N]}})}}),user:j.user});case 2:return f=s.sent,Z.onFinish&&Z.onFinish(f.data.setting),s.abrupt("return",!0);case 5:case"end":return s.stop()}},$)}));return function($){return R.apply(this,arguments)}}(),onOpenChange:function(){var R=u()(c()().mark(function $(j){var _,f,M,s;return c()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(E(j),!j){V.next=9;break}return(_=k.current)===null||_===void 0||_.resetFields(),V.next=5,(0,l.q2)();case 5:M=V.sent,s=[],M.data.setting&&M.data.setting.map(function(N){y.find(function(H){return H.value==N.serverName})?N.env&&N.env.map(function(H){var X;(X=k.current)===null||X===void 0||X.setFieldValue(["account",N.serverName,H.name],H.value)}):N.env&&s.push(N)}),(f=k.current)===null||f===void 0||f.setFieldValue("user",s);case 9:case"end":return V.stop()}},$)}));return function($){return R.apply(this,arguments)}}(),children:[(0,D.jsx)(b.Z.Group,{label:g.format("dnsApiServerNameSelect"),name:"serverNameSelect",radioType:"button",initialValue:"dns_dp",options:y.map(function(R){return{label:R.label,value:R.value}})}),(0,D.jsx)(e.Z,{name:["serverNameSelect"],children:function($){var j,_=$.serverNameSelect,f=(j=y.find(function(M){return M.value===_}))===null||j===void 0?void 0:j.help;return(0,D.jsxs)("div",{style:{marginBottom:20},children:[g.format("dnsApiServerNameTip"),": ",(0,D.jsx)("a",{href:f,target:"_blank",children:f})]})}}),(0,D.jsx)(e.Z,{name:["serverNameSelect"],children:function($){var j=$.serverNameSelect;return(0,D.jsxs)(D.Fragment,{children:[y.map(function(_){if(_.fields)return(0,D.jsx)(o.Z,{show:j==_.value,children:_.fields.map(function(f,M){return(0,D.jsx)(r.Z,{label:f.name,name:["account",_.value,f.name]},"".concat(_.value,"-").concat(M,"-").concat(f.name))})},_.value)}),(0,D.jsx)(o.Z,{show:j=="user",children:(0,D.jsx)(i.Z,{gap:20,name:"user",label:g.format("dnsApiUser"),showAddButton:!0,hideCopyButton:!0,items:[{name:"serverName",label:g.format("dnsApiUserServerName")},{name:"env",render:function(f,M,s){return(0,D.jsx)(i.Z,{gap:20,name:"env",label:g.format("dnsApiUserEnv"),showAddButton:!0,hideCopyButton:!0,items:[{name:"name",label:g.format("dnsApiUserEnvName")},{name:"value",label:g.format("dnsApiUserEnvValue")}]},"env")}}]})},"user")]})}})]})});C.Z=B},52255:function(w,C,t){"use strict";t.d(C,{Z:function(){return T}});var P=t(67294),c=t(85893);function T(u){return(0,c.jsx)("div",{style:{display:u.show?"block":"none"},children:u.children})}},75544:function(w,C,t){"use strict";var P=t(5574),c=t.n(P),T=t(12323),u=t(78267),h=t.n(u),d=t(75458),v=t.n(d),b=t(67294),e=t(4244),r=t.n(e),a=t(24078),n=t(85893),i,o,l,p=(0,b.forwardRef)(function(m,D){var g,y=(0,b.useState)(!0),B=c()(y,2),Z=B[0],I=B[1];return(0,b.useEffect)(function(){return i=new e.Terminal(T.X),o=new d.SearchAddon,l=new u.FitAddon,window.addEventListener("resize",function(){m.showInModal||l.fit()}),m.style&&m.style.fontSize&&(i.options.fontSize=m.style.fontSize),i.loadAddon(l),i.loadAddon(o),i.open(document.getElementById(m.id?m.id:"terminal-container")),m.showInModal||l.fit(),function(){i.reset(),I(!0)}},[]),(0,b.useImperativeHandle)(D,function(){return{write:function(O){Z&&(l.fit(),I(!1)),i.write(O)},clear:function(){i.clear()},getTerminal:function(){return i},findNext:function(O){o.findNext(O)},findPrev:function(O){o.findPrevious(O)},fit:function(){l.fit()},onData:function(O){return i.onData(O)}}}),(0,n.jsx)("div",{id:m.id?m.id:"terminal-container",style:{width:m.width?m.width:"100%",height:m.height?m.height:"500px",marginTop:(g=m.style)===null||g===void 0?void 0:g.marginTop}})});C.Z=p},12323:function(w,C,t){"use strict";t.d(C,{X:function(){return P},n:function(){return c}});var P={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},c=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"]},66554:function(w,C,t){"use strict";t.d(C,{Fj:function(){return b},KK:function(){return k},Pf:function(){return p},Ss:function(){return Z},dZ:function(){return A},dj:function(){return n},hZ:function(){return y},i7:function(){return d},lQ:function(){return o},ll:function(){return $},q2:function(){return K},ui:function(){return D}});var P=t(15009),c=t.n(P),T=t(99289),u=t.n(T),h=t(63713);function d(_){return v.apply(this,arguments)}function v(){return v=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/get-list",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),v.apply(this,arguments)}function b(_){return e.apply(this,arguments)}function e(){return e=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/create",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),e.apply(this,arguments)}function r(_){return a.apply(this,arguments)}function a(){return a=_asyncToGenerator(_regeneratorRuntime().mark(function _(f){return _regeneratorRuntime().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",request("/dpanel/api/app/site-domain/update",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),a.apply(this,arguments)}function n(_){return i.apply(this,arguments)}function i(){return i=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/delete",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),i.apply(this,arguments)}function o(_){return l.apply(this,arguments)}function l(){return l=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/get-detail",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),l.apply(this,arguments)}function p(_){return m.apply(this,arguments)}function m(){return m=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/apply",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),m.apply(this,arguments)}function D(_){return g.apply(this,arguments)}function g(){return g=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/import",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),g.apply(this,arguments)}function y(){return B.apply(this,arguments)}function B(){return B=u()(c()().mark(function _(){return c()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/restart-nginx",{method:"POST"}));case 1:case"end":return M.stop()}},_)})),B.apply(this,arguments)}function Z(_){return I.apply(this,arguments)}function I(){return I=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/update-vhost",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),I.apply(this,arguments)}function K(_){return O.apply(this,arguments)}function O(){return O=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/dns-api",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),O.apply(this,arguments)}function A(_){return E.apply(this,arguments)}function E(){return E=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/get-list",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),E.apply(this,arguments)}function k(_){return R.apply(this,arguments)}function R(){return R=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/delete",{method:"POST",data:f}));case 1:case"end":return s.stop()}},_)})),R.apply(this,arguments)}function $(_){return j.apply(this,arguments)}function j(){return j=u()(c()().mark(function _(f){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/download",{method:"POST",data:f,responseType:"blob"}));case 1:case"end":return s.stop()}},_)})),j.apply(this,arguments)}},24078:function(){"use strict"},78267:function(w){(function(C,t){w.exports=t()})(self,()=>(()=>{"use strict";var C={};return(()=>{var t=C;Object.defineProperty(t,"__esModule",{value:!0}),t.FitAddon=void 0,t.FitAddon=class{activate(P){this._terminal=P}dispose(){}fit(){const P=this.proposeDimensions();if(!P||!this._terminal||isNaN(P.cols)||isNaN(P.rows))return;const c=this._terminal._core;this._terminal.rows===P.rows&&this._terminal.cols===P.cols||(c._renderService.clear(),this._terminal.resize(P.cols,P.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const P=this._terminal._core,c=P._renderService.dimensions;if(c.css.cell.width===0||c.css.cell.height===0)return;const T=this._terminal.options.scrollback===0?0:P.viewport.scrollBarWidth,u=window.getComputedStyle(this._terminal.element.parentElement),h=parseInt(u.getPropertyValue("height")),d=Math.max(0,parseInt(u.getPropertyValue("width"))),v=window.getComputedStyle(this._terminal.element),b=h-(parseInt(v.getPropertyValue("padding-top"))+parseInt(v.getPropertyValue("padding-bottom"))),e=d-(parseInt(v.getPropertyValue("padding-right"))+parseInt(v.getPropertyValue("padding-left")))-T;return{cols:Math.max(2,Math.floor(e/c.css.cell.width)),rows:Math.max(1,Math.floor(b/c.css.cell.height))}}}})(),C})())},75458:function(w){(function(C,t){w.exports=t()})(self,()=>(()=>{"use strict";var C={345:(T,u)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.runAndSubscribe=u.forwardEvent=u.EventEmitter=void 0,u.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=h=>(this._listeners.push(h),{dispose:()=>{if(!this._disposed){for(let d=0;d<this._listeners.length;d++)if(this._listeners[d]===h)return void this._listeners.splice(d,1)}}})),this._event}fire(h,d){const v=[];for(let b=0;b<this._listeners.length;b++)v.push(this._listeners[b]);for(let b=0;b<v.length;b++)v[b].call(void 0,h,d)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},u.forwardEvent=function(h,d){return h(v=>d.fire(v))},u.runAndSubscribe=function(h,d){return d(void 0),h(v=>d(v))}},859:(T,u)=>{function h(d){for(const v of d)v.dispose();d.length=0}Object.defineProperty(u,"__esModule",{value:!0}),u.getDisposeArrayDisposable=u.disposeArray=u.toDisposable=u.MutableDisposable=u.Disposable=void 0,u.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const d of this._disposables)d.dispose();this._disposables.length=0}register(d){return this._disposables.push(d),d}unregister(d){const v=this._disposables.indexOf(d);v!==-1&&this._disposables.splice(v,1)}},u.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(d){var v;this._isDisposed||d===this._value||((v=this._value)==null||v.dispose(),this._value=d)}clear(){this.value=void 0}dispose(){var d;this._isDisposed=!0,(d=this._value)==null||d.dispose(),this._value=void 0}},u.toDisposable=function(d){return{dispose:d}},u.disposeArray=h,u.getDisposeArrayDisposable=function(d){return{dispose:()=>h(d)}}}},t={};function P(T){var u=t[T];if(u!==void 0)return u.exports;var h=t[T]={exports:{}};return C[T](h,h.exports,P),h.exports}var c={};return(()=>{var T=c;Object.defineProperty(T,"__esModule",{value:!0}),T.SearchAddon=void 0;const u=P(345),h=P(859),d=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class v extends h.Disposable{constructor(e){var r;super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new h.MutableDisposable),this._linesCacheTimeoutId=0,this._linesCacheDisposables=new h.MutableDisposable,this._onDidChangeResults=this.register(new u.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=(r=e==null?void 0:e.highlightLimit)!=null?r:1e3}activate(e){this._terminal=e,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,h.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){var e;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&((e=this._lastSearchOptions)!=null&&e.decorations)&&(this._highlightTimeout=setTimeout(()=>{const r=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(r,re(te({},this._lastSearchOptions),{incremental:!0,noScroll:!0}))},200))}clearDecorations(e){this._selectedDecoration.clear(),(0,h.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),e||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){this._selectedDecoration.clear()}findNext(e,r){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const a=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,r);this._lastSearchOptions=r,r!=null&&r.decorations&&(this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||a)&&this._highlightAllMatches(e,r);const n=this._findNextAndSelect(e,r);return this._fireResults(r),this._cachedSearchTerm=e,n}_highlightAllMatches(e,r){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||e.length===0)return void this.clearDecorations();r=r||{},this.clearDecorations(!0);const a=[];let n,i=this._find(e,0,0,r);for(;i&&((n==null?void 0:n.row)!==i.row||(n==null?void 0:n.col)!==i.col)&&!(a.length>=this._highlightLimit);)n=i,a.push(n),i=this._find(e,n.col+n.term.length>=this._terminal.cols?n.row+1:n.row,n.col+n.term.length>=this._terminal.cols?0:n.col+1,r);for(const o of a){const l=this._createResultDecoration(o,r.decorations);l&&(this._highlightedLines.add(l.marker.line),this._highlightDecorations.push({decoration:l,match:o,dispose(){l.dispose()}}))}}_find(e,r,a,n){var l;if(!this._terminal||!e||e.length===0)return(l=this._terminal)==null||l.clearSelection(),void this.clearDecorations();if(a>this._terminal.cols)throw new Error(`Invalid col: ${a} to search in terminal of ${this._terminal.cols} cols`);let i;this._initLinesCache();const o={startRow:r,startCol:a};if(i=this._findInLine(e,o,n),!i)for(let p=r+1;p<this._terminal.buffer.active.baseY+this._terminal.rows&&(o.startRow=p,o.startCol=0,i=this._findInLine(e,o,n),!i);p++);return i}_findNextAndSelect(e,r){var p;if(!this._terminal||!e||e.length===0)return(p=this._terminal)==null||p.clearSelection(),this.clearDecorations(),!1;const a=this._terminal.getSelectionPosition();this._terminal.clearSelection();let n=0,i=0;a&&(this._cachedSearchTerm===e?(n=a.end.x,i=a.end.y):(n=a.start.x,i=a.start.y)),this._initLinesCache();const o={startRow:i,startCol:n};let l=this._findInLine(e,o,r);if(!l)for(let m=i+1;m<this._terminal.buffer.active.baseY+this._terminal.rows&&(o.startRow=m,o.startCol=0,l=this._findInLine(e,o,r),!l);m++);if(!l&&i!==0)for(let m=0;m<i&&(o.startRow=m,o.startCol=0,l=this._findInLine(e,o,r),!l);m++);return!l&&a&&(o.startRow=a.start.y,o.startCol=0,l=this._findInLine(e,o,r)),this._selectResult(l,r==null?void 0:r.decorations,r==null?void 0:r.noScroll)}findPrevious(e,r){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const a=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,r);this._lastSearchOptions=r,r!=null&&r.decorations&&(this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||a)&&this._highlightAllMatches(e,r);const n=this._findPreviousAndSelect(e,r);return this._fireResults(r),this._cachedSearchTerm=e,n}_didOptionsChange(e,r){return!!r&&(e.caseSensitive!==r.caseSensitive||e.regex!==r.regex||e.wholeWord!==r.wholeWord)}_fireResults(e){if(e!=null&&e.decorations){let r=-1;if(this._selectedDecoration.value){const a=this._selectedDecoration.value.match;for(let n=0;n<this._highlightDecorations.length;n++){const i=this._highlightDecorations[n].match;if(i.row===a.row&&i.col===a.col&&i.size===a.size){r=n;break}}}this._onDidChangeResults.fire({resultIndex:r,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(e,r){var m;if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!e||e.length===0)return(m=this._terminal)==null||m.clearSelection(),this.clearDecorations(),!1;const a=this._terminal.getSelectionPosition();this._terminal.clearSelection();let n=this._terminal.buffer.active.baseY+this._terminal.rows-1,i=this._terminal.cols;const o=!0;this._initLinesCache();const l={startRow:n,startCol:i};let p;if(a&&(l.startRow=n=a.start.y,l.startCol=i=a.start.x,this._cachedSearchTerm!==e&&(p=this._findInLine(e,l,r,!1),p||(l.startRow=n=a.end.y,l.startCol=i=a.end.x))),p||(p=this._findInLine(e,l,r,o)),!p){l.startCol=Math.max(l.startCol,this._terminal.cols);for(let D=n-1;D>=0&&(l.startRow=D,p=this._findInLine(e,l,r,o),!p);D--);}if(!p&&n!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let D=this._terminal.buffer.active.baseY+this._terminal.rows-1;D>=n&&(l.startRow=D,p=this._findInLine(e,l,r,o),!p);D--);return this._selectResult(p,r==null?void 0:r.decorations,r==null?void 0:r.noScroll)}_initLinesCache(){const e=this._terminal;this._linesCache||(this._linesCache=new Array(e.buffer.active.length),this._linesCacheDisposables.value=(0,h.getDisposeArrayDisposable)([e.onLineFeed(()=>this._destroyLinesCache()),e.onCursorMove(()=>this._destroyLinesCache()),e.onResize(()=>this._destroyLinesCache())])),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(e,r,a){return(e===0||d.includes(r[e-1]))&&(e+a.length===r.length||d.includes(r[e+a.length]))}_findInLine(e,r,a={},n=!1){var K;const i=this._terminal,o=r.startRow,l=r.startCol,p=i.buffer.active.getLine(o);if(p!=null&&p.isWrapped)return n?void(r.startCol+=i.cols):(r.startRow--,r.startCol+=i.cols,this._findInLine(e,r,a));let m=(K=this._linesCache)==null?void 0:K[o];m||(m=this._translateBufferLineToStringWithWrap(o,!0),this._linesCache&&(this._linesCache[o]=m));const[D,g]=m,y=this._bufferColsToStringOffset(o,l),B=a.caseSensitive?e:e.toLowerCase(),Z=a.caseSensitive?D:D.toLowerCase();let I=-1;if(a.regex){const O=RegExp(B,"g");let A;if(n)for(;A=O.exec(Z.slice(0,y));)I=O.lastIndex-A[0].length,e=A[0],O.lastIndex-=e.length-1;else A=O.exec(Z.slice(y)),A&&A[0].length>0&&(I=y+(O.lastIndex-A[0].length),e=A[0])}else n?y-B.length>=0&&(I=Z.lastIndexOf(B,y-B.length)):I=Z.indexOf(B,y);if(I>=0){if(a.wholeWord&&!this._isWholeWord(I,Z,e))return;let O=0;for(;O<g.length-1&&I>=g[O+1];)O++;let A=O;for(;A<g.length-1&&I+e.length>=g[A+1];)A++;const E=I-g[O],k=I+e.length-g[A],R=this._stringLengthToBufferSize(o+O,E);return{term:e,col:R,row:o+O,size:this._stringLengthToBufferSize(o+A,k)-R+i.cols*(A-O)}}}_stringLengthToBufferSize(e,r){const a=this._terminal.buffer.active.getLine(e);if(!a)return 0;for(let n=0;n<r;n++){const i=a.getCell(n);if(!i)break;const o=i.getChars();o.length>1&&(r-=o.length-1);const l=a.getCell(n+1);l&&l.getWidth()===0&&r++}return r}_bufferColsToStringOffset(e,r){const a=this._terminal;let n=e,i=0,o=a.buffer.active.getLine(n);for(;r>0&&o;){for(let l=0;l<r&&l<a.cols;l++){const p=o.getCell(l);if(!p)break;p.getWidth()&&(i+=p.getCode()===0?1:p.getChars().length)}if(n++,o=a.buffer.active.getLine(n),o&&!o.isWrapped)break;r-=a.cols}return i}_translateBufferLineToStringWithWrap(e,r){var l;const a=this._terminal,n=[],i=[0];let o=a.buffer.active.getLine(e);for(;o;){const p=a.buffer.active.getLine(e+1),m=!!p&&p.isWrapped;let D=o.translateToString(!m&&r);if(m&&p){const g=o.getCell(o.length-1);g&&g.getCode()===0&&g.getWidth()===1&&((l=p.getCell(0))==null?void 0:l.getWidth())===2&&(D=D.slice(0,-1))}if(n.push(D),!m)break;i.push(i[i.length-1]+D.length),e++,o=p}return[n.join(""),i]}_selectResult(e,r,a){const n=this._terminal;if(this._selectedDecoration.clear(),!e)return n.clearSelection(),!1;if(n.select(e.col,e.row,e.size),r){const i=n.registerMarker(-n.buffer.active.baseY-n.buffer.active.cursorY+e.row);if(i){const o=n.registerDecoration({marker:i,x:e.col,width:e.size,backgroundColor:r.activeMatchBackground,layer:"top",overviewRulerOptions:{color:r.activeMatchColorOverviewRuler}});if(o){const l=[];l.push(i),l.push(o.onRender(p=>this._applyStyles(p,r.activeMatchBorder,!0))),l.push(o.onDispose(()=>(0,h.disposeArray)(l))),this._selectedDecoration.value={decoration:o,match:e,dispose(){o.dispose()}}}}}if(!a&&(e.row>=n.buffer.active.viewportY+n.rows||e.row<n.buffer.active.viewportY)){let i=e.row-n.buffer.active.viewportY;i-=Math.floor(n.rows/2),n.scrollLines(i)}return!0}_applyStyles(e,r,a){e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),r&&(e.style.outline=`1px solid ${r}`)),a&&e.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(e,r){const a=this._terminal,n=a.registerMarker(-a.buffer.active.baseY-a.buffer.active.cursorY+e.row);if(!n)return;const i=a.registerDecoration({marker:n,x:e.col,width:e.size,backgroundColor:r.matchBackground,overviewRulerOptions:this._highlightedLines.has(n.line)?void 0:{color:r.matchOverviewRuler,position:"center"}});if(i){const o=[];o.push(n),o.push(i.onRender(l=>this._applyStyles(l,r.matchBorder,!1))),o.push(i.onDispose(()=>(0,h.disposeArray)(o)))}return i}}T.SearchAddon=v})(),c})())}}]);
}());