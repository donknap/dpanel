"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1218],{83002:function(be,Ce,e){var xe=e(5574),f=e.n(xe),Re=e(15009),S=e.n(Re),K=e(99289),c=e.n(K),ge=e(83622),T=e(85265),H=e(67294),b=e(81146),v=e(1883),N=e(90098),R=e(3616),G=e(36146),F=e(85893),Se=(0,H.forwardRef)(function(h,z){(0,H.useImperativeHandle)(z,function(){return{show:function(A){return c()(S()().mark(function l(){return S()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:Ze(A),re(!0);case 2:case"end":return E.stop()}},l)}))()}}});var ne=(0,H.useState)(!1),ie=f()(ne,2),Y=ie[0],re=ie[1],ce=(0,H.useState)(),_=f()(ce,2),O=_[0],Ze=_[1],oe=(0,H.useRef)();return(0,F.jsxs)(F.Fragment,{children:[h.showTriggerButton&&(0,F.jsx)(ge.ZP,{onClick:c()(S()().mark(function q(){return S()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:Ze(h.composeItem),re(!0);case 2:case"end":return l.stop()}},q)})),icon:(0,F.jsx)(v.Z,{}),children:G.FD.format("listManageLog")},"log"),(0,F.jsx)(T.Z,{title:G.FD.format("listLog"),open:Y,forceRender:!0,onClose:function(){re(!1)},afterOpenChange:function(A){if(A)setTimeout(function(){var i,E;(i=oe.current)===null||i===void 0||i.start(),(E=oe.current)===null||E===void 0||E.fit()},1e3);else{var l;(l=oe.current)===null||l===void 0||l.close()}},width:R.FK,children:O&&Y&&(0,F.jsx)(b.Z,{ref:oe,showInDrawer:!0,id:"compose:log:".concat(String(O.id||O.name)),request:function(){var q=c()(S()().mark(function A(l){var i;return S()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.Yz)({id:O.id||O.name,lineTotal:l.lineTotal,download:(i=l.download)!==null&&i!==void 0?i:!1,showTime:l.showTime});case 2:case"end":return n.stop()}},A)}));return function(A){return q.apply(this,arguments)}}(),download:function(){var q=c()(S()().mark(function A(l){var i;return S()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.vf)({id:O.id||O.name,lineTotal:l.lineTotal,showTime:l.showTime,download:!0});case 2:return i=n.sent,n.abrupt("return",{data:new Blob([i],{type:"text/plain"}),name:h.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return n.stop()}},A)}));return function(A){return q.apply(this,arguments)}}()})})]})});Ce.Z=Se},82848:function(be,Ce,e){e.d(Ce,{Z:function(){return tt}});var xe=e(15009),f=e.n(xe),Re=e(99289),S=e.n(Re),K=e(97857),c=e.n(K),ge=e(5574),T=e.n(ge),H=e(3616),b=e(24963),v=e(90098),N=e(36146),R=e(86548),G=e(33862),F=e(38345),Se=e(24739),h=e(5966),z=e(86615),ne=e(97462),ie=e(62370),Y=e(95213),re=e(11106),ce=e(92398),_=e(42075),O=e(83622),Ze=e(83062),oe=e(40411),q=e(71230),A=e(15746),l=e(40056),i=e(67294),E=e(12491),n=e(85060),qe=e(97269),Ee=e(86738),o=e(85893),$e=(0,i.forwardRef)(function(t,Ae){(0,i.useImperativeHandle)(Ae,function(){return{}});var D=(0,i.useRef)(),Be=(0,i.useState)(!1),Le=T()(Be,2),me=Le[0],ye=Le[1];return(0,o.jsx)(ie.Z,{children:(0,o.jsx)(Ee.Z,{icon:!1,title:!1,description:(0,o.jsx)(qe.A,{name:"importRemote",layout:"horizontal",submitter:!1,formRef:D,children:(0,o.jsx)(h.Z,{width:"lg",label:"Url",initialValue:t.defaultUrl,name:"url",placeholder:"https:// or http://"})}),onOpenChange:function(le){var C;(C=D.current)===null||C===void 0||C.resetFields()},onConfirm:S()(f()().mark(function we(){var le,C;return f()().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:if(C=(le=D.current)===null||le===void 0?void 0:le.getFieldValue("url"),C){se.next=3;break}return se.abrupt("return");case 3:if(ye(!0),se.t0=t.onRequest,!se.t0){se.next=8;break}return se.next=8,t.onRequest(C).finally(function(){ye(!1)});case 8:case"end":return se.stop()}},we)})),children:(0,o.jsx)(O.ZP,{loading:me,icon:(0,o.jsx)(n.Z,{}),block:!0,onClick:function(){var le;(le=D.current)===null||le===void 0||le.resetFields()},children:t.title})})})}),fe=$e,Ue=e(91058),Oe=e(79245),et=e(27166),Ne=e(82346),Ge=(0,i.forwardRef)(function(t,Ae){var D=new N.Uo("components.appCompose"),Be=(0,i.useContext)(b.Z),Le=Be.message,me=(0,i.useRef)(),ye=(0,i.useRef)(),we=(0,i.useState)(),le=T()(we,2),C=le[0],ve=le[1],se=(0,i.useState)(!1),ze=T()(se,2),nt=ze[0],Qe=ze[1],De=(0,i.useRef)(),He=(0,i.useState)(),Ye=T()(He,2),ae=Ye[0],We=Ye[1],rt=(0,i.useState)("text"),ke=T()(rt,2),Xe=ke[0],at=ke[1];(0,i.useImperativeHandle)(Ae,function(){return{edit:function(j){We(j),Qe(!0)}}}),(0,i.useEffect)(function(){t.id&&We(t.id)},[]),(0,i.useEffect)(function(){var $;if(me.current){var j=t.id||ae;if(!j){ve({yaml:"",override:""});return}($=De.current)===null||$===void 0||$.loading(),(0,v.Pn)({id:j}).finally(function(){var s;(s=De.current)===null||s===void 0||s.finish()}).then(function(s){var m,I;ve({yaml:s.data.yaml[0],override:(m=s.data.yaml[1])!==null&&m!==void 0?m:""}),(I=me.current)===null||I===void 0||I.setFieldsValue({name:s.data.detail.name,title:s.data.detail.title,type:s.data.detail.setting.type,environment:s.data.detail.setting.environment,remoteUrl:s.data.detail.setting.remoteUrl})})}},[me.current,ae]);var w=(0,o.jsx)(ce.Z,{tabBarExtraContent:(0,o.jsxs)(_.Z,{children:[(0,o.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-override",target:"_blank",children:N.FD.format("help")}),(0,o.jsx)(O.ZP,{type:"link",onClick:function(){},children:N.FD.format("listManageFullScreen")})]}),items:[{label:D.format("createYaml.yaml"),key:"yaml",children:C&&(0,o.jsx)(re.ZP,{theme:"dark",height:"600px",onChange:function(j){ve(c()(c()({},C),{yaml:j}))},onFocus:function(){Xe=="remoteUrl"&&Le.info(D.format("createYamlDisableEdit"))},onBlur:function(){var j;(j=me.current)!==null&&j!==void 0&&j.getFieldValue("environment")||C&&C.yaml&&(0,Oe.m)(C.yaml).map(function(s){var m;(m=ye.current)===null||m===void 0||m.addEnvNameValue(s.name,s.value)})},readOnly:Xe=="remoteUrl",value:C.yaml,extensions:[Y.RI.yaml()]})},{label:(0,o.jsx)(Ze.Z,{title:D.format("createYamlOverrideTip"),children:(0,o.jsx)(oe.Z,{count:(C==null?void 0:C.override)&&N.FD.format("listInUse"),offset:[15,-5],children:D.format("createYaml.override")})}),key:"yamlOverride",children:C&&(0,o.jsx)(re.ZP,{theme:"dark",height:"600px",onChange:function(j,s){ve(c()(c()({},C),{override:j}))},value:C==null?void 0:C.override,extensions:[Y.RI.yaml()]})}]},"yamlEditor");return(0,o.jsxs)(et.Z,{requestLoading:C==null&&ae!=null,drawerProps:{width:H.R_,destroyOnHidden:!0},open:nt,onOpenChange:function(j){if(Qe(j),!j){var s;ve(void 0),We(t.id),(s=me.current)===null||s===void 0||s.resetFields()}},title:D.format("yamlDrawerTitle"),formRef:me,ref:De,trigger:(0,o.jsx)(O.ZP,{type:"primary",icon:ae?(0,o.jsx)(R.Z,{}):void 0,children:N.Ob.format(ae?"compose.list.edit":"compose.list.create")}),onFinish:function(){var $=S()(f()().mark(function j(s){var m,I,Q,Z;return f()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(s.type!="remoteGit"){u.next=7;break}return(m=De.current)===null||m===void 0||m.loading(),u.next=4,(0,v.zN)({uri:s.remoteUrl,name:s.name}).finally(function(){var L;(L=De.current)===null||L===void 0||L.finish()});case 4:return I=u.sent,t.onFinish&&t.onFinish(I.data.id),u.abrupt("return",!0);case 7:return u.prev=7,Q={id:ae&&ae.toString(),type:s.type,name:s.name,title:s.title,environment:s.environment,remoteUrl:s.remoteUrl,yaml:C==null?void 0:C.yaml,yamlOverride:C==null?void 0:C.override},u.next=11,(0,v.im)(Q);case 11:return Z=u.sent,t.onFinish&&t.onFinish(Z.data.id),Le.success(N.FD.format("finish")),u.abrupt("return",!0);case 17:return u.prev=17,u.t0=u.catch(7),u.abrupt("return",!1);case 20:case"end":return u.stop()}},j,null,[[7,17]])}));return function(j){return $.apply(this,arguments)}}(),children:[(0,o.jsx)(F.Z,{ghost:!0,children:(0,o.jsxs)(Se.UW,{children:[(0,o.jsx)(h.Z,{label:D.format("createFormName"),name:"name",width:"md",required:!0,disabled:!!ae,rules:[{required:!0},{pattern:/^[a-zA-Z0-9_-]+$/,message:D.format("createFormNameRule")}],placeholder:D.format("createFormNameEmpty")}),(0,o.jsx)(h.Z,{label:D.format("createFormTitle"),name:"title",width:"md"})]})},"createForm"),(0,o.jsx)(z.Z.Group,{label:D.format("createFormType"),name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(j){var s;(s=me.current)===null||s===void 0||s.resetFields(["yaml","environment"]),at(j.target.value)}},disabled:!!ae,options:D.option("createFormTypeOption",["text","remoteUrl","remoteGit","storagePath","store","outPath"]).map(function($){return{label:$.label,value:$.value}})}),(0,o.jsx)(ne.Z,{name:["type"],children:function(j){var s=j.type;if(s=="text")return(0,o.jsxs)(q.Z,{gutter:[10,0],children:[(0,o.jsx)(A.Z,{span:12,children:(0,o.jsx)(E.Z,{title:D.format("createFormTypeTextImportFile"),onImport:function(I){return ve(c()(c()({},C),{yaml:I})),(0,Oe.m)(I).map(function(Q){var Z;(Z=ye.current)===null||Z===void 0||Z.addEnvNameValue(Q.name,Q.value)}),!0},onLoad:function(I){if(I.indexOf("services:")<0)throw new Error(N.FD.format("commonFileIncorrectFormat",{name:"yaml"}));return!0}},"importFile")}),(0,o.jsx)(A.Z,{span:12,children:(0,o.jsx)(fe,{title:D.format("createFormTypeTextImportRemote"),onRequest:function(){var m=S()(f()().mark(function I(Q){var Z;return f()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,v.MG)({uri:Q});case 2:return Z=u.sent,ve(c()(c()({},C),{yaml:Z.data.content})),(0,Oe.m)(Z.data.content).map(function(L){var k;(k=ye.current)===null||k===void 0||k.addEnvNameValue(L.name,L.value)}),u.abrupt("return");case 6:case"end":return u.stop()}},I)}));return function(I){return m.apply(this,arguments)}}()},"importRemote")})]});if(s=="remoteUrl")return(0,o.jsx)(q.Z,{gutter:[10,0],children:(0,o.jsxs)(A.Z,{span:24,children:[(0,o.jsx)(ie.Z,{shouldUpdate:!0,children:function(I){return(0,o.jsx)(fe,{defaultUrl:I.getFieldValue("remoteUrl"),title:D.format("createFormTypeRemoteImportUrl"),onRequest:function(){var Q=S()(f()().mark(function Z(M){var u,L;return f()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,(0,v.MG)({uri:M});case 2:return L=U.sent,ve(c()(c()({},C),{yaml:L.data.content})),(u=me.current)===null||u===void 0||u.setFieldValue("remoteUrl",M),(0,Oe.m)(L.data.content).map(function(Te){var ue;(ue=ye.current)===null||ue===void 0||ue.addEnvNameValue(Te.name,Te.value)}),U.abrupt("return");case 7:case"end":return U.stop()}},Z)}));return function(Z){return Q.apply(this,arguments)}}()},"importRemote1")}}),(0,o.jsx)(ie.Z,{hidden:!0,name:"remoteUrl"},"remoteUrl")]})});if(s=="remoteGit")return(0,o.jsx)(h.Z,{name:"remoteUrl",label:D.format("createFormTypeRemoteImportGit")},"importRemote2");if(s=="storagePath")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(h.Z,{name:"storagePath",required:!0,readonly:!0,initialValue:D.format("createFormTypeStoragePathTip"),addonAfter:(0,o.jsx)("a",{href:"https://dpanel.cc/manual/compose-create",target:"_blank",children:N.FD.format("help")})})});if(s=="store")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(h.Z,{readonly:!0,name:"store",required:!0,initialValue:D.format("createFormTypeStoreTip"),addonAfter:(0,o.jsx)(Ne.Link,{to:"/compose/appstore",children:N.Ob.format("compose.appstore")})})});if(s=="outPath")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(h.Z,{name:"outPath",required:!0,readonly:!0,initialValue:D.format("createFormTypeOutPathTip")})})}}),(0,o.jsx)(ne.Z,{name:["type"],children:function(j){var s=j.type;return(s=="text"||s=="remoteUrl"||ae)&&(0,o.jsxs)(F.Z,{ghost:!0,direction:"row",children:[(0,o.jsxs)(F.Z,{ghost:!0,colSpan:"50%",children:[(0,o.jsx)(l.Z,{type:"warning",message:D.format("createFormTypeTextTip"),style:{marginBottom:15}},"yamlTips"),(0,o.jsx)(l.Z,{message:(0,o.jsxs)(o.Fragment,{children:[D.format("createEnvTip1")," ","${DB_NAME}",". ",D.format("createEnvTip2")]})}),(0,o.jsx)(Ue.Z,{drawerProps:{ghost:!0,title:(0,o.jsx)(G.Z,{}),subTitle:D.format("createEnvTitle")},name:"environment",showInDrawer:!0,showImportButton:!ae,showAddButton:!0,showCodeMode:!ae,ref:ye})]}),(0,o.jsx)(F.Z,{colSpan:"50%",children:w})]},"yamlEditor")}})]},"yamlCreate")}),tt=Ge},91218:function(be,Ce,e){e.d(Ce,{Z:function(){return at}});var xe=e(97857),f=e.n(xe),Re=e(19632),S=e.n(Re),K=e(15009),c=e.n(K),ge=e(99289),T=e.n(ge),H=e(5574),b=e.n(H),v=e(67294),N=e(3616),R=e(36146),G=e(38345),F=e(97269),Se=e(86615),h=e(62370),z=e(90098),ne=e(27166),ie=e(43425),Y=e(33160),re=e(82061),ce=e(87784),_=e(74842),O=e(30159),Ze=e(25035),oe=e(95591),q=e(26522),A=e(33862),l=e(40056),i=e(42075),E=e(96074),n=e(25593),qe=e(86250),Ee=e(84567),o=e(83062),$e=e(83622),fe=e(80821),Ue=e(82346),Oe=e(79697),et=e(99861),Ne=e(1699),Ge=e(89035),tt=e(75544),t=e(85893),Ae=(0,v.forwardRef)(function(w,$){(0,v.useImperativeHandle)($,function(){return{show:function(){return T()(c()().mark(function u(){var L;return c()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return Z(!0),(L=s.current)===null||L===void 0||L.clear(),U.next=4,new Promise(function(Te){return setTimeout(function(){var ue;(ue=s.current)===null||ue===void 0||ue.fit(),Te(!0)},1e3)});case 4:case"end":return U.stop()}},u)}))()},close:function(){var u;Z(!1),(u=s.current)===null||u===void 0||u.clear()},cancel:function(){return T()(c()().mark(function u(){var L;return c()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return(L=s.current)===null||L===void 0||L.clear(),j.progress.close("compose:"+w.id),U.abrupt("return",!0);case 3:case"end":return U.stop()}},u)}))()}}});var j=(0,Ue.useModel)("subscriber"),s=(0,v.useRef)(),m=(0,v.useState)(!1),I=b()(m,2),Q=I[0],Z=I[1];return j.addDataHandler("compose:"+w.id,function(M){var u;(u=s.current)===null||u===void 0||u.write(M.data)}),(0,t.jsx)(G.Z,{hidden:!Q,ghost:!0,title:(0,t.jsx)(Ge.Z,{}),subTitle:"Console",extra:(0,t.jsx)(i.Z,{children:(0,t.jsx)(fe.Z,{action:T()(c()().mark(function M(){var u;return c()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return(u=s.current)===null||u===void 0||u.clear(),j.progress.close("compose:"+w.id),k.abrupt("return");case 3:case"end":return k.stop()}},M)})),buttonProps:{icon:(0,t.jsx)(re.Z,{}),danger:!0},children:R.FD.format("listManageKill")},"kill")}),children:(0,t.jsx)(tt.Z,{id:"create-log-".concat(w.id),height:"200px",style:{fontSize:12},ref:s})})}),D=Ae,Be=e(83002),Le=e(60940),me=e(55241),ye=e(78451),we=e(37413),le=e(94359),C=e(91806),ve=e(60433),se=e(99611),ze=e(99922),nt=e(3905),Qe=e(87662),De=e(5251),He=e(29463);function Ye(w){var $=(0,v.useState)(""),j=b()($,2),s=j[0],m=j[1],I=(0,v.useRef)(),Q=(0,v.useRef)(),Z=(0,v.useState)(),M=b()(Z,2),u=M[0],L=M[1],k=new R.Uo("components.appCompose"),U=(0,v.useRef)(),Te=(0,v.useState)(),ue=b()(Te,2),it=ue[0],Ve=ue[1],ot=(0,v.useState)(),Ke=b()(ot,2),a=Ke[0],Ie=Ke[1];return(0,v.useEffect)(function(){return(0,Qe.K3)().then(function(ee){var B;m((B=ee.data.serverUrl)!==null&&B!==void 0?B:"")}),L(!1),w.containerList&&Ve(w.containerList.filter(function(ee){return ee.status!=""}).map(function(ee){return ee.service})),Ie(w.containerList),function(){Ie([])}},[w.containerList]),(0,t.jsxs)(G.Z,{ghost:!0,title:(0,t.jsx)(C.Z,{}),subTitle:k.format("detailContainerTitle"),extra:w.enableSelectService&&(0,t.jsx)(Ee.Z,{checked:u,onChange:function(B){L(B.target.checked)},children:k.format("selectService")},"selectService"),children:[(0,t.jsx)(ze.Z,{showFileExplorer:!0,ref:I}),(0,t.jsx)(He.Z,{ref:U}),(0,t.jsx)(nt.Z,{ref:Q}),(0,t.jsx)(Le.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:R.FD.format("listName"),dataIndex:"name",width:200,render:function(B,y,pe){return(0,t.jsx)(o.Z,{title:y.service,children:(0,t.jsx)(ye.Z,{content:y.name?(0,De.fi)(y.name,"/"):y.service})})}},{title:R.FD.format("listPort"),render:function(B,y,pe){var W=[],X=[];return y.publishers&&y.publishers.map(function(de){de.publishedPort?W.push({PrivatePort:de.targetPort,Type:de.protocol,IP:de.url,PublicPort:de.publishedPort}):de.publishedPort&&X.push({PrivatePort:de.targetPort,Type:de.protocol,IP:de.url,PublicPort:de.publishedPort})}),(0,t.jsx)(we.Z,{publicPort:W,privatePort:X,domain:[],serverIp:s})}},{title:R.FD.format("listStatus"),render:function(B,y,pe){return(0,t.jsx)(le.Z,{status:"container.".concat(y.state),tip:"".concat(y.state," ").concat(y.status)},y.name)}},{title:R.FD.format("listManage"),fixed:"right",render:function(B,y,pe){return(0,t.jsxs)(i.Z,{split:(0,t.jsx)(E.Z,{type:"vertical"}),children:[y.name==""&&(0,t.jsx)(me.Z,{placement:"left",content:(0,t.jsx)(G.Z,{ghost:!0,title:R.FD.format("listManageShowContainerEnv"),children:(0,t.jsx)(i.Z,{direction:"vertical",children:y.environment&&Object.keys(y.environment).map(function(W){if(y.environment&&y.environment[W])return(0,t.jsx)(n.Z.Text,{code:!0,children:"".concat(W,"=").concat(y.environment[W])},W)})})}),children:(0,t.jsx)(ve.Z,{})}),y.name!=""&&(0,t.jsx)(n.Z.Link,{onClick:function(){var X;(X=Q.current)===null||X===void 0||X.show(y.name)},children:(0,t.jsx)(se.Z,{})},"container"),y.state=="running"&&(0,t.jsx)(n.Z.Link,{onClick:function(){var X;(X=I.current)===null||X===void 0||X.show({url:"/console/container/".concat((0,De.fi)(y.name,"/")),title:y.name})},children:(0,t.jsx)(Ge.Z,{})},"console"),y.state=="running"&&(0,t.jsx)(n.Z.Link,{onClick:function(){var X;(X=U.current)===null||X===void 0||X.showContainer((0,De.fi)(y.name,"/"))},children:(0,t.jsx)(oe.Z,{})},"file")]})}}],dataSource:a,rowSelection:u&&a?{selectedRowKeys:it,onChange:function(B,y,pe){Ve(B),w.selectServiceFinish&&w.selectServiceFinish(B)}}:void 0})]})}var ae=e(91058),We=e(82848),rt=e(2831),ke=e(36588),Xe=(0,v.forwardRef)(function(w,$){var j,s=(0,Ue.useAccess)(),m=new R.Uo("components.appCompose"),I=(0,v.useState)(0),Q=b()(I,2),Z=Q[0],M=Q[1],u=(0,v.useState)(!1),L=b()(u,2),k=L[0],U=L[1],Te=(0,v.useState)(!1),ue=b()(Te,2),it=ue[0],Ve=ue[1],ot=(0,v.useState)(),Ke=b()(ot,2),a=Ke[0],Ie=Ke[1],ee=(0,v.useRef)(),B=(0,v.useRef)(),y=(0,v.useRef)(),pe=(0,v.useRef)(),W=(0,v.useRef)(),X=(0,v.useRef)(),de=(0,v.useRef)(),ct=(0,v.useRef)(),ft=(0,v.useState)(),mt=b()(ft,2),Je=mt[0],lt=mt[1];(0,v.useImperativeHandle)($,function(){return{show:function(r){return T()(c()().mark(function d(){return c()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:lt(r),U(!0);case 2:case"end":return x.stop()}},d)}))()}}}),(0,v.useEffect)(function(){Je&&(Ve(!0),(0,z.Pn)({id:Je}).finally(T()(c()().mark(function p(){return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:Ve(!1);case 1:case"end":return d.stop()}},p)}))).then(function(p){var r=p.data.detail;r.setting.status&&r.setting.status.includes("running")&&(r.isRunning=!0),r.setting.status&&r.setting.status.includes("paused")&&(r.isPaused=!0),r.setting.status&&r.setting.status.includes("exited")&&(r.isExited=!0),r.setting.status&&r.setting.status.includes("waiting")?r.isDeploy=!1:r.isDeploy=!0,r.setting.status&&r.setting.status.includes("created")&&(r.isCreated=!0,r.isDeploy=!1);var d=p.data.project;if(d&&d.services&&(r.imageList=S()(new Set(Object.keys(d.services).map(function(J){var P;return(P=d.services[J].image)!==null&&P!==void 0?P:""}).filter(function(J){return J!=""})))),r.containerList=p.data.containerList,r.containerList||(r.containerList=[]),d!=null&&d.services&&Object.entries(d==null?void 0:d.services).forEach(function(J){var P,je=b()(J,2),Pe=je[0],he=je[1],Me=r.containerList.find(function(V){return V.service==Pe});Me||r.containerList.push({project:(P=d.name)!==null&&P!==void 0?P:"",name:"",service:Pe,publishers:he.ports?he.ports.map(function(V){var Fe;return{url:"",targetPort:V.target,publishedPort:parseInt(V.published),protocol:(Fe=V.protocol)!==null&&Fe!==void 0?Fe:""}}):[],state:"waiting",status:"",environment:he.environment})}),r.containerList){var g;(g=y.current)===null||g===void 0||g.setFieldValue("deployServiceName",p.data.detail.setting.deployServiceName)}if(Ie(f()(f()({},p.data),{detail:r})),p.data.detail.setting.environment){var x;(x=y.current)===null||x===void 0||x.setFieldValue("environment",p.data.detail.setting.environment)}}))},[Z,Je]);function vt(p){return st.apply(this,arguments)}function st(){return st=T()(c()().mark(function p(r){var d,g,x;return c()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if((d=W.current)===null||d===void 0||d.show(),!r.pullImageUseDPanel){P.next=5;break}return P.next=4,(g=ee.current)===null||g===void 0?void 0:g.start();case 4:(x=ee.current)===null||x===void 0||x.finish();case 5:return P.prev=5,P.next=8,(0,z.Oh)(r);case 8:w.onDeployFinish&&w.onDeployFinish(),P.next=14;break;case 11:P.prev=11,P.t0=P.catch(5),w.onDeployFailed&&w.onDeployFailed();case 14:M(Z+1);case 15:case"end":return P.stop()}},p,null,[[5,11]])})),st.apply(this,arguments)}return(0,t.jsxs)(ne.Z,{drawerProps:{width:N.R_,destroyOnHidden:!0},requestLoading:it,title:a?m.format("drawerTitle",{name:(j=a==null?void 0:a.detail.name)!==null&&j!==void 0?j:""}):m.format("createTitle"),open:k,onOpenChange:function(r){r||(lt(void 0),Ie(void 0),w.onClose&&w.onClose()),U(r)},submitter:!1,formRef:y,children:[a&&!(0,Oe.Z)(a.detail.imageList)&&(0,t.jsx)(et.Z,{ref:ee,image:a.detail.imageList}),(0,t.jsx)(He.Z,{ref:de}),(0,t.jsxs)(G.Z,{direction:"column",ghost:!0,gutter:[0,10],children:[a&&a.detail.setting.type=="dangling"&&(0,t.jsx)(l.Z,{type:"warning",showIcon:!0,description:(0,t.jsxs)("div",{children:[m.format("managerStatusDanglingAlert",{name:a.detail.name})," ",(0,t.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-outpath",target:"_blank",children:R.FD.format("help")})]})}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(G.Z,{title:(0,t.jsx)(ie.Z,{}),subTitle:m.format("managerContainerTitle"),ghost:!0,children:(0,t.jsxs)(i.Z,{wrap:!0,split:(0,t.jsx)(E.Z,{type:"vertical"}),children:[(0,t.jsxs)(Ne.u,{access:"canSeeComposeListManage",space:{},children:[(0,t.jsx)(fe.Z,{buttonProps:{icon:(0,t.jsx)(Y.Z,{}),type:"primary"},confirmProps:{onOpenChange:function(r,d){var g;r&&(!((g=B.current)===null||g===void 0)&&g.resetFields)&&B.current.resetFields()},description:(0,t.jsxs)(i.Z,{style:{minWidth:300},direction:"vertical",wrap:!0,children:[(0,t.jsx)(n.Z.Text,{children:m.format("managerCreateTip")}),(0,t.jsx)(F.A,{name:"createForm",formRef:B,layout:"inline",submitter:!1,children:(0,t.jsxs)(qe.Z,{vertical:!0,children:[(0,t.jsx)(Se.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},options:m.option("managerCreatePullImageUseOption",["useCommand","useDPanel"])}),(0,t.jsx)(h.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,t.jsx)(Ee.Z,{children:m.format("managerCreateCreatePath")})}),(0,t.jsx)(h.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,t.jsx)(Ee.Z,{defaultChecked:!0,children:m.format("managerCreateRemoveOrphans")})})]})})]})},action:T()(c()().mark(function p(){var r,d,g,x,J,P,je,Pe,he,Me,V,Fe,_e;return c()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.prev=0,te.next=3,(he=y.current)===null||he===void 0?void 0:he.validateFields();case 3:te.next=8;break;case 5:return te.prev=5,te.t0=te.catch(0),te.abrupt("return");case 8:return Me=a?a.detail.id||a.detail.name:(r=y.current)===null||r===void 0?void 0:r.getFieldValue("name"),V={id:Me,createPath:(d=(g=B.current)===null||g===void 0?void 0:g.getFieldValue("createPath"))!==null&&d!==void 0?d:!1,removeOrphans:(x=(J=B.current)===null||J===void 0?void 0:J.getFieldValue("removeOrphans"))!==null&&x!==void 0?x:!0},((P=B.current)===null||P===void 0?void 0:P.getFieldValue("pullImageUse"))=="useDPanel"&&(V.pullImage=!1,V.pullImageUseDPanel=!0),((je=B.current)===null||je===void 0?void 0:je.getFieldValue("pullImageUse"))=="useCommand"&&(V.pullImage=!0),Fe=((Pe=y.current)===null||Pe===void 0?void 0:Pe.getFieldsFormatValue)&&y.current.getFieldsFormatValue(!0),V.environment=Fe.environment,V.deployServiceName=Fe.deployServiceName,te.next=17,(0,z.im)({id:(a.detail.id||a.detail.name).toString(),name:a.detail.name,environment:Fe.environment,type:a.detail.setting.type});case 17:if(!(a!=null&&a.detail.isDeploy&&V.deployServiceName)){te.next=23;break}if(_e=[],a.detail.containerList.forEach(function(ut){var dt;ut.status!=""&&!((dt=V.deployServiceName)!==null&&dt!==void 0&&dt.includes(ut.service))&&_e.push(ut.service)}),(0,Oe.Z)(_e)){te.next=23;break}return te.next=23,(0,z.j6)({id:Me,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1,destroyServiceName:_e});case 23:return te.abrupt("return",vt(V));case 24:case"end":return te.stop()}},p,null,[[0,5]])})),children:m.format(a!=null&&a.detail.isDeploy?"managerUpgradeButton":"managerCreateButton")},"deploy"),(a.detail.isDeploy||a.detail.isCreated)&&(0,t.jsx)(fe.Z,{action:function(){var r;return(r=W.current)===null||r===void 0||r.show(),(0,z.j6)({id:a.detail.id||a.detail.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){M(Z+1)},buttonProps:{type:"primary",danger:!0,icon:(0,t.jsx)(re.Z,{})},confirmProps:{showCommonConfirm:!0},children:m.format("managerDeleteContainerButton")},"destroyContainer")]}),a.detail.isDeploy&&(0,t.jsxs)(Ne.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,t.jsx)(fe.Z,{buttonProps:{icon:(0,t.jsx)(Y.Z,{})},action:T()(c()().mark(function p(){var r;return c()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return(r=W.current)===null||r===void 0||r.show(),g.abrupt("return",(0,z.GG)({id:a.detail.id||a.detail.name,op:"restart"}));case 2:case"end":return g.stop()}},p)})),onSuccess:function(){M(Z+1)},children:m.format("managerRestartButton")},"restart"),(0,t.jsx)(fe.Z,{action:function(){var r;return(r=W.current)===null||r===void 0||r.show(),(0,z.GG)({id:a.detail.id||a.detail.name,op:"stop"})},buttonProps:{icon:(0,t.jsx)(ce.Z,{}),disabled:a.detail.isExited},onSuccess:function(){M(Z+1)},children:m.format("managerStopButton")},"stop"),a.detail.isPaused&&(0,t.jsx)(fe.Z,{action:function(){var r;return(r=W.current)===null||r===void 0||r.show(),(0,z.GG)({id:a.detail.id||a.detail.name,op:"unpause"})},onSuccess:function(){M(Z+1)},buttonProps:{icon:(0,t.jsx)(_.Z,{})},children:m.format("managerUnpauseButton")},"unpause"),!a.detail.isPaused&&(0,t.jsx)(fe.Z,{action:function(){var r;return(r=W.current)===null||r===void 0||r.show(),(0,z.GG)({id:a.detail.id||a.detail.name,op:"pause"})},onSuccess:function(){M(Z+1)},buttonProps:{icon:(0,t.jsx)(O.Z,{}),disabled:!a.detail.isRunning},children:m.format("managerPauseButton")},"pause"),a.detail.isDeploy&&(0,t.jsx)(Be.Z,{composeItem:a.detail,showTriggerButton:!0},"composeLog")]}),a.detail.id>0&&s.canSeeComposeListManageDelete&&(0,t.jsx)(fe.Z,{buttonProps:{type:"dashed",danger:!0,icon:(0,t.jsx)(re.Z,{})},confirmProps:{onOpenChange:function(r,d){var g;!((g=pe.current)===null||g===void 0)&&g.resetFields&&pe.current.resetFields()},description:(0,t.jsxs)(i.Z,{style:{width:280},direction:"vertical",children:[(0,t.jsx)(n.Z.Text,{children:m.format("managerDeleteTaskTip")}),(0,t.jsxs)(F.A,{formRef:pe,layout:"inline",submitter:!1,children:[(0,t.jsx)(h.Z,{initialValue:!0,name:"deleteImage",valuePropName:"checked",children:(0,t.jsx)(Ee.Z,{children:m.format("managerDeleteTaskDeleteImage")})}),(0,t.jsx)(h.Z,{addonAfter:(0,t.jsx)(o.Z,{title:m.format("managerDeleteTaskDeleteVolumeTip"),children:(0,t.jsx)(Ze.Z,{})}),initialValue:!0,name:"deleteVolume",valuePropName:"checked",children:(0,t.jsx)(Ee.Z,{children:m.format("managerDeleteTaskDeleteVolume")})}),(0,t.jsx)(h.Z,{initialValue:!0,name:"deletePath",valuePropName:"checked",children:(0,t.jsx)(Ee.Z,{children:m.format("managerDeleteTaskDeletePath")})})]})]})},action:T()(c()().mark(function p(){var r,d,g,x,J,P,je,Pe,he;return c()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return(r=W.current)===null||r===void 0||r.show(),V.next=3,(0,z.j6)({id:(d=(g=a.detail)===null||g===void 0?void 0:g.id)!==null&&d!==void 0?d:a.detail.name,deleteImage:(x=(J=pe.current)===null||J===void 0?void 0:J.getFieldValue("deleteImage"))!==null&&x!==void 0?x:!1,deleteVolume:(P=(je=pe.current)===null||je===void 0?void 0:je.getFieldValue("deleteVolume"))!==null&&P!==void 0?P:!1,deletePath:(Pe=(he=pe.current)===null||he===void 0?void 0:he.getFieldValue("deletePath"))!==null&&Pe!==void 0?Pe:!1,deleteData:!0});case 3:U(!1),Ie(void 0),w.onClose&&w.onClose();case 6:case"end":return V.stop()}},p)})),children:R.FD.format("listManageDelete")},"deleteTask"),w.showBackListButton&&(0,t.jsx)(Ue.Link,{to:"/compose/list",children:(0,t.jsx)($e.ZP,{children:R.Ob.format("compose.list")})})]})},"operator"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(G.Z,{title:(0,t.jsx)(ie.Z,{}),subTitle:m.format("managerTitle"),ghost:!0,children:(0,t.jsxs)(i.Z,{children:[s.canSeeComposeListManage&&(0,t.jsx)(We.Z,{id:Je,onFinish:function(){var p=T()(c()().mark(function r(d){return c()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:lt(d),M(Z+1);case 2:case"end":return x.stop()}},r)}));return function(r){return p.apply(this,arguments)}}()}),s.canSeeComposeListManageCreate&&(a==null?void 0:a.detail.setting.type)!="outPath"&&(0,t.jsx)($e.ZP,{icon:(0,t.jsx)(oe.Z,{}),onClick:T()(c()().mark(function p(){var r,d,g,x;return c()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,rt.aF)();case 2:d=P.sent,d.data&&(r=d.data.dpanel.containerInfo)!==null&&r!==void 0&&r.Name&&((g=de.current)===null||g===void 0||g.showContainer((x=d.data.dpanel.containerInfo)===null||x===void 0?void 0:x.Name,"/dpanel/compose/".concat(a==null?void 0:a.detail.name)));case 4:case"end":return P.stop()}},p)})),children:R.FD.format("listManageFilePath")}),(0,t.jsx)(E.Z,{type:"vertical"}),function(p){var r="";if((p=a.project)!==null&&p!==void 0&&p.networks){var d=Object.entries(a.project.networks).find(function(g){var x=b()(g,2),J=x[0],P=x[1];return P.external});d&&(r=d[1].name)}return r!=""&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ke.Z,{ref:ct},"network-create"),(0,t.jsx)($e.ZP,{onClick:function(){var x;(x=ct.current)===null||x===void 0||x.show(r)},icon:(0,t.jsx)(q.Z,{}),children:m.format("joinContainerInNetwork")},"network")]})}(),(0,t.jsx)($e.ZP,{icon:(0,t.jsx)(Y.Z,{}),onClick:function(){var r;(r=W.current)===null||r===void 0||r.close(),M(Z+1)},children:R.FD.format("listManageRefresh")})]})},"manager"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(D,{ref:W,id:(a==null?void 0:a.detail.id)||(a==null?void 0:a.detail.name)}),a&&a.containerList&&(0,t.jsx)(Ye,{containerList:a==null?void 0:a.containerList,enableSelectService:(a==null?void 0:a.detail.setting.type)!="dangling",selectServiceFinish:function(r){var d;(d=y.current)===null||d===void 0||d.setFieldValue("deployServiceName",r)}}),(0,t.jsx)(h.Z,{name:"deployServiceName",hidden:!0}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(ae.Z,{drawerProps:{ghost:!0,title:(0,t.jsx)(A.Z,{}),subTitle:"".concat(m.format("createEnvTitle"))},showDisableName:!0,showDeleteButton:!1,name:"environment",ref:X})]})]})}),at=Xe},75544:function(be,Ce,e){var xe=e(5574),f=e.n(xe),Re=e(12323),S=e(78267),K=e.n(S),c=e(75458),ge=e.n(c),T=e(67294),H=e(4244),b=e.n(H),v=e(24078),N=e(85893),R,G,F,Se=(0,T.forwardRef)(function(h,z){var ne,ie=(0,T.useState)(!0),Y=f()(ie,2),re=Y[0],ce=Y[1];return(0,T.useEffect)(function(){return R=new H.Terminal(Re.X),G=new c.SearchAddon,F=new S.FitAddon,window.addEventListener("resize",function(){h.showInModal||F.fit()}),h.style&&h.style.fontSize&&(R.options.fontSize=h.style.fontSize),R.loadAddon(F),R.loadAddon(G),R.open(document.getElementById(h.id?h.id:"terminal-container")),h.showInModal||F.fit(),function(){R.reset(),ce(!0)}},[]),(0,T.useImperativeHandle)(z,function(){return{write:function(O){re&&(F.fit(),ce(!1)),R.write(O)},clear:function(){R.clear()},getTerminal:function(){return R},findNext:function(O){G.findNext(O)},findPrev:function(O){G.findPrevious(O)},fit:function(){F.fit()},onData:function(O){return R.onData(O)}}}),(0,N.jsx)("div",{id:h.id?h.id:"terminal-container",style:{width:h.width?h.width:"100%",height:h.height?h.height:"500px",marginTop:(ne=h.style)===null||ne===void 0?void 0:ne.marginTop}})});Ce.Z=Se},90098:function(be,Ce,e){e.d(Ce,{GG:function(){return Se},MG:function(){return re},Oh:function(){return N},Pn:function(){return b},Yz:function(){return z},iE:function(){return Ze},im:function(){return c},j6:function(){return G},pm:function(){return T},tw:function(){return q},vf:function(){return ie},zN:function(){return _}});var xe=e(15009),f=e.n(xe),Re=e(99289),S=e.n(Re),K=e(82346);function c(l){return ge.apply(this,arguments)}function ge(){return ge=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/create",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),ge.apply(this,arguments)}function T(l){return H.apply(this,arguments)}function H(){return H=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-list",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),H.apply(this,arguments)}function b(l){return v.apply(this,arguments)}function v(){return v=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-task",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),v.apply(this,arguments)}function N(l){return R.apply(this,arguments)}function R(){return R=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-deploy",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),R.apply(this,arguments)}function G(l){return F.apply(this,arguments)}function F(){return F=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-destroy",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),F.apply(this,arguments)}function Se(l){return h.apply(this,arguments)}function h(){return h=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-ctrl",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),h.apply(this,arguments)}function z(l){return ne.apply(this,arguments)}function ne(){return ne=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-log",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),ne.apply(this,arguments)}function ie(l){return Y.apply(this,arguments)}function Y(){return Y=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.download=!0,i.id=String(i.id),n.next=4,(0,K.request)("/dpanel/api/app/compose/container-log",{method:"POST",data:i,responseType:"blob"});case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},l)})),Y.apply(this,arguments)}function re(l){return ce.apply(this,arguments)}function ce(){return ce=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-from-uri",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),ce.apply(this,arguments)}function _(l){return O.apply(this,arguments)}function O(){return O=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-from-git",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),O.apply(this,arguments)}function Ze(l){return oe.apply(this,arguments)}function oe(){return oe=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/common/store/deploy",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),oe.apply(this,arguments)}function q(l){return A.apply(this,arguments)}function A(){return A=S()(f()().mark(function l(i){return f()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/download",{method:"POST",data:i,responseType:"blob"}));case 2:case"end":return n.stop()}},l)})),A.apply(this,arguments)}}}]);
