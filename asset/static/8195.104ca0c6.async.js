"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{75293:function(z,L,r){r.d(L,{Z:function(){return S}});var x=r(25593),u=r(85893);function S(P){return(0,u.jsx)(x.Z.Text,{copyable:!0,style:{padding:10,display:P.block?"block":"",background:"#24292f",color:"#ffffff"},children:P.content})}},77273:function(z,L,r){var x=r(15009),u=r.n(x),S=r(99289),P=r.n(S),I=r(5574),D=r.n(I),A=r(184),m=r(5966),y=r(86615),j=r(97462),b=r(64317),h=r(52688),c=r(62370),t=r(38345),Y=r(31199),d=r(90672),R=r(71230),C=r(15746),$=r(42075),g=r(86250),w=r(40056),T=r(67294),J=r(87662),U=r(12491),Q=r(89035),F=r(36146),G=r(3616),V=r(75293),X=r(2831),e=r(85893),K=(0,T.forwardRef)(function(W,Z){var H;(0,T.useImperativeHandle)(Z,function(){return{edit:function(a){var n,l=a.address.split("://"),i=D()(l,2),p=i[0],E=i[1];(n=f.current)===null||n===void 0||n.setFieldsValue({name:a.name,title:a.title,addressType:"".concat(p=="ssh"?"tcp":p,"://"),address:E,serverUrl:a.serverUrl,enableTLS:a.enableTLS,tlsCa:a.tlsCa,tlsCert:a.tlsCert,tlsKey:a.tlsKey,enableComposePath:a.enableComposePath,enableSSH:a.enableSSH,sshServerInfo:a.sshServerInfo,remoteType:a.remoteType?a.remoteType:"docker"}),ee(!0),ne(a.name)}}}),(0,T.useEffect)(function(){(0,X.aF)().then(function(O){O.data.rsa.public&&k(O.data.rsa.public)})},[]);var N=(0,T.useState)(),B=D()(N,2),M=B[0],k=B[1],s=new F.Uo("components.dockerEnvCreate"),se=(0,T.useState)(!1),q=D()(se,2),te=q[0],ee=q[1],f=(0,T.useRef)(),ae=(0,T.useState)(""),re=D()(ae,2),oe=re[0],ne=re[1];return(0,e.jsxs)(A.a,{drawerProps:{forceRender:!0,width:G.R_},onOpenChange:function(a){if(!a){var n;ne(""),(n=f.current)===null||n===void 0||n.resetFields()}ee(a)},open:te,width:800,trigger:W.trigger,formRef:f,title:s.format((H=f.current)!==null&&H!==void 0&&H.getFieldValue&&f.current.getFieldValue("name")=="local"?"drawerTitleDefault":"drawerTitle"),onFinish:function(){var O=P()(u()().mark(function a(n){var l,i,p,E;return u()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i="",n.remoteType&&n.remoteType=="ssh"?i="ssh://":i=(p=n.addressType)!==null&&p!==void 0?p:"unix://",o.next=4,(0,J.ad)({name:n.name,title:n.title,address:"".concat(i).concat((l=n.address)!==null&&l!==void 0?l:n.sshServerInfo.address),serverUrl:n.serverUrl,enableTLS:n.enableTLS,tlsCa:n.tlsCa,tlsCert:n.tlsCert,tlsKey:n.tlsKey,enableComposePath:n.enableComposePath,composePath:n.enableComposePath?n.composePath:"",enableSSH:n.enableSSH||n.remoteType=="ssh",sshServerInfo:n.sshServerInfo,remoteType:n.remoteType});case 4:return E=o.sent,W.onFinish&&W.onFinish(),o.abrupt("return",!0);case 7:case"end":return o.stop()}},a)}));return function(a){return O.apply(this,arguments)}}(),children:[(0,e.jsx)(m.Z,{label:s.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle"}},"envTitle"),(0,e.jsx)(m.Z,{label:s.format("formName"),name:"name",required:!0,disabled:oe!="",rules:[{required:!0}],placeholder:s.format("formNameEmpty")}),(0,e.jsx)(m.Z,{tooltip:s.format("formServerUrlTip"),label:s.format("formServerUrl"),name:"serverUrl",placeholder:s.format("formServerUrlEmpty")}),(0,e.jsx)(y.Z.Group,{label:s.format("formRemoteType"),name:"remoteType",options:[{label:"DockerApi",value:"docker"},{label:"SSH",value:"ssh"}]}),(0,e.jsx)(j.Z,{name:["remoteType","name"],children:function(a){var n=a.remoteType,l=a.name;return(0,e.jsxs)(e.Fragment,{children:[n=="docker"&&(0,e.jsx)(R.Z,{children:(0,e.jsx)(C.Z,{span:24,children:(0,e.jsxs)($.Z.Compact,{children:[(0,e.jsx)(b.Z,{name:"addressType",label:s.format("formAddressType"),valueEnum:{"unix://":"unix://","tcp://":"tcp://"},initialValue:"tcp://",fieldProps:{defaultValue:"tcp://"},width:"sm",tooltip:s.format("formAddressTypeTip")}),(0,e.jsx)(m.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:s.format("formAddressEmpty")})]})})}),(0,e.jsxs)(R.Z,{gutter:[15,0],children:[n=="docker"&&(0,e.jsx)(C.Z,{children:(0,e.jsx)(h.Z,{label:s.format("formEnableTLS"),name:"enableTLS",tooltip:s.format("formEnableTLSTip")})}),l!="local"&&typeof n!="undefined"&&(0,e.jsx)(C.Z,{children:(0,e.jsx)(h.Z,{label:s.format("formEnableComposePath"),name:"enableComposePath",tooltip:s.format("formEnableComposePathTip")})}),n=="docker"&&(0,e.jsx)(C.Z,{children:(0,e.jsx)(h.Z,{label:s.format("formEnableSSH"),name:"enableSSH"})})]})]})}}),(0,e.jsx)(j.Z,{name:["enableTLS","remoteType"],children:function(a){var n=a.enableTLS,l=a.remoteType;if(n&&l=="docker"){var i,p,E;return(0,e.jsxs)(g.Z,{gap:10,justify:"start",children:[(0,e.jsx)(c.Z,{name:"tlsCa",label:s.format("formTlsCa"),children:(0,e.jsx)(U.Z,{showPaset:!0,data:(i=f.current)===null||i===void 0?void 0:i.getFieldValue("tlsCa"),title:"ca.pem",onImport:function(o){var v;return(v=f.current)===null||v===void 0||v.setFieldValue("tlsCa",o),!0},onLoad:function(o){if(o.indexOf("CERTIFICATE")<0)throw new Error(s.format("formEnableTLSMessageUploadError",{name:"ca.pem"}));return!0}})}),(0,e.jsx)(c.Z,{name:"tlsCert",label:" ",children:(0,e.jsx)(U.Z,{showPaset:!0,data:(p=f.current)===null||p===void 0?void 0:p.getFieldValue("tlsCert"),title:"cert.pem",onImport:function(o){var v;return(v=f.current)===null||v===void 0||v.setFieldValue("tlsCert",o),!0},onLoad:function(o){if(o.indexOf("CERTIFICATE")<0)throw new Error(s.format("formEnableTLSMessageUploadError",{name:"cert.pem"}));return!0}})}),(0,e.jsx)(c.Z,{label:" ",name:"tlsKey",children:(0,e.jsx)(U.Z,{showPaset:!0,data:(E=f.current)===null||E===void 0?void 0:E.getFieldValue("tlsKey"),title:"key.pem",onImport:function(o){var v;return(v=f.current)===null||v===void 0||v.setFieldValue("tlsKey",o),!0},onLoad:function(o){if(o.indexOf("PRIVATE")<0)throw new Error(s.format("formEnableTLSMessageUploadError",{name:"key.pem"}));return!0}})})]})}}}),(0,e.jsx)(j.Z,{name:["enableComposePath","name"],children:function(a){var n=a.enableComposePath,l=a.name;if(n)return(0,e.jsx)(m.Z,{label:s.format("formComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(l!=null?l:"")}})}}),(0,e.jsx)(j.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(a){var n=a.enableSSH,l=a.sshServerInfo,i=a.remoteType,p=a.address;return(n||i=="ssh")&&[(0,e.jsxs)(t.Z,{title:(0,e.jsx)(Q.Z,{}),subTitle:s.format("formEnableSSHTitle"),ghost:!0,children:[(0,e.jsxs)(e.Fragment,{children:[i=="ssh"&&(0,e.jsx)(c.Z,{children:(0,e.jsx)(w.Z,{message:(0,e.jsxs)(e.Fragment,{children:[s.format("formEnableSSHAlert")," \xA0",(0,e.jsx)("a",{href:"https://dpanel.cc/manual/system-env#ssh",target:"_blank",children:F.FD.format("help")})]})})}),(0,e.jsx)(m.Z,{label:s.format("formSshServerInfoAddress"),placeholder:s.format("formSshServerInfoAddressEmpty"),name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,e.jsxs)(R.Z,{children:[(0,e.jsx)(C.Z,{children:(0,e.jsx)(Y.Z,{initialValue:22,label:s.format("formSshServerInfoPort"),name:["sshServerInfo","port"]})}),(0,e.jsx)(C.Z,{offset:2,children:(0,e.jsx)(m.Z,{width:"lg",label:s.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]})})]}),(0,e.jsx)(y.Z.Group,{label:s.format("formSshServerInfoAuthType"),name:["sshServerInfo","authType"],options:s.option("formSshServerInfoAuthTypeOption",["basic","pem","pemDefault"]),fieldProps:{onChange:function(){var _;(_=f.current)===null||_===void 0||_.setFieldValue(["sshServerInfo","password"],"")}},required:!0,rules:[{required:!0}]}),l&&l.authType=="basic"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(m.Z.Password,{label:s.format("formSshServerInfoPassword"),name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})}),l&&l.authType=="pem"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(U.Z,{title:s.format("formSshServerInfoPrivateKeyImport"),onImport:function(_){var o;return(o=f.current)===null||o===void 0||o.setFieldValue(["sshServerInfo","privateKey"],_),!0},onLoad:function(_){if(!_.includes("PRIVATE KEY"))throw new Error(s.format("formEnableTLSMessageUploadError",{name:"private.key"}));return!0}}),(0,e.jsx)(d.Z,{name:["sshServerInfo","privateKey"],label:s.format("formSshServerInfoPrivateKey"),required:!0,rules:[{required:!0}]}),(0,e.jsx)(m.Z.Password,{name:["sshServerInfo","password"],label:s.format("formSshServerInfoPrivateKeyPassword")})]}),l&&l.authType=="pemDefault"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(j.Z,{name:["sshServerInfo"],children:function(_){var o=_.sshServerInfo;if(!(!o||!o.username))return[(0,e.jsx)(w.Z,{message:s.format("formSshServerInfoAddPublicKey",{user:o.username}),style:{marginBottom:15}},"message"),M&&(0,e.jsx)(V.Z,{content:'mkdir -p ~/.ssh && chmod 700 ~/.ssh && ! grep -q "'.concat(M.substring(M.length/2,M.length/2+18),`" ~/.ssh/authorized_keys 2>/dev/null && echo "
`).concat(M,'" >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys'),block:!0},"copycode")]}})})]},"sshSetting")]}})]})});L.Z=K},12491:function(z,L,r){r.d(L,{Z:function(){return Y}});var x=r(5574),u=r.n(x),S=r(3616),P=r(24963),I=r(36146),D=r(88484),A=r(57546),m=r(62370),y=r(11106),j=r(42075),b=r(83622),h=r(85576),c=r(67294),t=r(85893);function Y(d){var R=(0,c.useContext)(P.Z),C=R.message,$=R.notice,g=(0,c.useRef)(null),w=(0,c.useState)(!1),T=u()(w,2),J=T[0],U=T[1],Q=(0,c.useState)(""),F=u()(Q,2),G=F[0],V=F[1];(0,c.useEffect)(function(){d.data&&V(d.data)},[d.data]);var X=function(){g.current&&(g.current.click(),g.current.onchange=function(K){if(!K||!K.target)return"";var W=new FileReader;W.onload=function(N){var B,M,k=(B=N.target)===null||B===void 0?void 0:B.result;if(d.onLoad)try{d.onLoad&&d.onLoad(k)}catch(s){$.error(s);return}V(k),typeof d.onImport=="function"&&(C.success(I.FD.format("finish")),d.onImport(k)),(M=g.current)!==null&&M!==void 0&&M.value&&(g.current.value="")};var Z=K.target;if(Z.files&&Z.files[0]){var H=Z.files[0];try{W.readAsText(H)}catch(N){$.error(I.FD.format("commonContentIncorrectFormat",{name:Z.files[0].name}))}}})};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Z,{children:(0,t.jsxs)(j.Z.Compact,{block:!0,children:[(0,t.jsx)(b.ZP,{icon:(0,t.jsx)(D.Z,{}),block:!0,onClick:X,children:d.title}),d.showPaset&&(0,t.jsx)(b.ZP,{icon:(0,t.jsx)(A.Z,{}),onClick:function(){U(!0)}})]})}),(0,t.jsx)("input",{style:{display:"none"},type:"file",ref:g,name:"importFileInput"}),(0,t.jsx)(h.Z,{width:S.ob,open:J,onCancel:function(){U(!1)},onOk:function(){typeof d.onImport=="function"&&(C.success(I.FD.format("finish")),d.onImport(G)),U(!1)},children:(0,t.jsx)(y.ZP,{height:S.Ed,theme:"dark",value:G,onChange:function(K){V(K)}})})]})}},2831:function(z,L,r){r.d(L,{Ll:function(){return j},aF:function(){return D},u5:function(){return m}});var x=r(15009),u=r.n(x),S=r(99289),P=r.n(S),I=r(82346);function D(){return A.apply(this,arguments)}function A(){return A=P()(u()().mark(function h(){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,I.request)("/dpanel/api/common/home/info",{method:"POST"});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},h)})),A.apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return y=P()(u()().mark(function h(){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,I.request)("/dpanel/api/common/home/check-new-version",{method:"POST"});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},h)})),y.apply(this,arguments)}function j(){return b.apply(this,arguments)}function b(){return b=P()(u()().mark(function h(){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,I.request)("/dpanel/api/common/home/usage",{method:"POST"});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},h)})),b.apply(this,arguments)}}}]);
