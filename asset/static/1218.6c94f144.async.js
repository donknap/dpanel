"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1218],{83002:function(Qe,Ze,e){var Te=e(5574),d=e.n(Te),Ee=e(15009),P=e.n(Ee),W=e(99289),s=e.n(W),je=e(83622),L=e(85265),z=e(67294),V=e(81146),c=e(1883),N=e(90098),y=e(3616),b=e(36146),E=e(85893),Fe=(0,z.forwardRef)(function(m,G){(0,z.useImperativeHandle)(G,function(){return{show:function(U){return s()(P()().mark(function l(){return P()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:Le(U),te(!0);case 2:case"end":return R.stop()}},l)}))()}}});var ee=(0,z.useState)(!1),oe=d()(ee,2),Y=oe[0],te=oe[1],de=(0,z.useState)(),X=d()(de,2),F=X[0],Le=X[1],le=(0,z.useRef)();return(0,E.jsxs)(E.Fragment,{children:[m.showTriggerButton&&(0,E.jsx)(je.ZP,{onClick:s()(P()().mark(function J(){return P()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:Le(m.composeItem),te(!0);case 2:case"end":return l.stop()}},J)})),icon:(0,E.jsx)(c.Z,{}),children:b.FD.format("listManageLog")},"log"),(0,E.jsx)(L.Z,{title:b.FD.format("listLog"),open:Y,forceRender:!0,onClose:function(){te(!1)},afterOpenChange:function(U){if(U)setTimeout(function(){var i,R;(i=le.current)===null||i===void 0||i.start(),(R=le.current)===null||R===void 0||R.fit()},1e3);else{var l;(l=le.current)===null||l===void 0||l.close()}},width:y.FK,children:F&&Y&&(0,E.jsx)(V.Z,{ref:le,showInDrawer:!0,id:"compose:log:".concat(String(F.id||F.name)),request:function(){var J=s()(P()().mark(function U(l){var i;return P()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.Yz)({id:F.id||F.name,lineTotal:l.lineTotal,download:(i=l.download)!==null&&i!==void 0?i:!1,showTime:l.showTime});case 2:case"end":return n.stop()}},U)}));return function(U){return J.apply(this,arguments)}}(),download:function(){var J=s()(P()().mark(function U(l){var i;return P()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.vf)({id:F.id||F.name,lineTotal:l.lineTotal,showTime:l.showTime,download:!0});case 2:return i=n.sent,n.abrupt("return",{data:new Blob([i],{type:"text/plain"}),name:m.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return n.stop()}},U)}));return function(U){return J.apply(this,arguments)}}()})})]})});Ze.Z=Fe},82848:function(Qe,Ze,e){e.d(Ze,{Z:function(){return rt}});var Te=e(15009),d=e.n(Te),Ee=e(99289),P=e.n(Ee),W=e(97857),s=e.n(W),je=e(5574),L=e.n(je),z=e(3616),V=e(24963),c=e(90098),N=e(36146),y=e(86548),b=e(33862),E=e(38345),Fe=e(24739),m=e(5966),G=e(86615),ee=e(97462),oe=e(62370),Y=e(95213),te=e(11106),de=e(92398),X=e(42075),F=e(83622),Le=e(83062),le=e(40411),J=e(71230),U=e(15746),l=e(40056),i=e(67294),R=e(12491),n=e(85060),tt=e(97269),we=e(86738),o=e(85893),Ue=(0,i.forwardRef)(function(t,M){(0,i.useImperativeHandle)(M,function(){return{}});var Pe=(0,i.useRef)(),T=(0,i.useState)(!1),Be=L()(T,2),be=Be[0],ne=Be[1];return(0,o.jsx)(oe.Z,{children:(0,o.jsx)(we.Z,{icon:!1,title:!1,description:(0,o.jsx)(tt.A,{name:"importRemote",layout:"horizontal",submitter:!1,formRef:Pe,children:(0,o.jsx)(m.Z,{width:"lg",label:"Url",initialValue:t.defaultUrl,name:"url",placeholder:"https:// or http://"})}),onOpenChange:function(ce){var me;(me=Pe.current)===null||me===void 0||me.resetFields()},onConfirm:P()(d()().mark(function Ce(){var ce,me;return d()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(me=(ce=Pe.current)===null||ce===void 0?void 0:ce.getFieldValue("url"),me){A.next=3;break}return A.abrupt("return");case 3:if(ne(!0),A.t0=t.onRequest,!A.t0){A.next=8;break}return A.next=8,t.onRequest(me).finally(function(){ne(!1)});case 8:case"end":return A.stop()}},Ce)})),children:(0,o.jsx)(F.ZP,{loading:be,icon:(0,o.jsx)(n.Z,{}),block:!0,onClick:function(){var ce;(ce=Pe.current)===null||ce===void 0||ce.resetFields()},children:t.title})})})}),pe=Ue,Ve=e(91058),Ae=e(79245),nt=e(27166),ze=e(82346),Ye=function(M){var Pe,T=new N.Uo("components.appCompose"),Be=(0,i.useContext)(V.Z),be=Be.message,ne=(0,i.useRef)(),Ce=(0,i.useRef)(),ce=(0,i.useState)(),me=L()(ce,2),w=me[0],A=me[1],at=(0,i.useState)(!1),He=L()(at,2),it=He[0],Ge=He[1],We=(0,i.useRef)();(0,i.useEffect)(function(){if(ne.current){if(!M.id){A({yaml:"",override:""});return}(0,c.Pn)({id:M.id}).then(function(I){var D,x;A({yaml:I.data.yaml[0],override:(D=I.data.yaml[1])!==null&&D!==void 0?D:""}),(x=ne.current)===null||x===void 0||x.setFieldsValue({name:I.data.detail.name,title:I.data.detail.title,type:I.data.detail.setting.type,environment:I.data.detail.setting.environment,remoteUrl:I.data.detail.setting.remoteUrl})})}},[ne.current,M.id]);var ot=(0,o.jsx)(de.Z,{tabBarExtraContent:(0,o.jsxs)(X.Z,{children:[(0,o.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-override",target:"_blank",children:N.FD.format("help")}),(0,o.jsx)(F.ZP,{type:"link",onClick:function(){},children:N.FD.format("listManageFullScreen")})]}),items:[{label:T.format("createYaml.yaml"),key:"yaml",children:w&&(0,o.jsx)(te.ZP,{theme:"dark",height:"600px",onChange:function(D){A(s()(s()({},w),{yaml:D}))},onFocus:function(){var D;((D=ne.current)===null||D===void 0?void 0:D.getFieldValue("type"))=="remoteUrl"&&be.info(T.format("createYamlDisableEdit"))},readOnly:((Pe=ne.current)===null||Pe===void 0?void 0:Pe.getFieldValue("type"))=="remoteUrl",value:w.yaml,extensions:[Y.RI.yaml()]})},{label:(0,o.jsx)(Le.Z,{title:T.format("createYamlOverrideTip"),children:(0,o.jsx)(le.Z,{count:(w==null?void 0:w.override)&&N.FD.format("listInUse"),offset:[15,-5],children:T.format("createYaml.override")})}),key:"yamlOverride",children:w&&(0,o.jsx)(te.ZP,{theme:"dark",height:"600px",onChange:function(D,x){A(s()(s()({},w),{override:D}))},value:w==null?void 0:w.override,extensions:[Y.RI.yaml()]})}]},"yamlEditor");return(0,o.jsxs)(nt.Z,{requestLoading:w==null&&M.id!=null,drawerProps:{width:z.R_,destroyOnHidden:!0},open:it,onOpenChange:function(D){if(Ge(D),!D){var x;A(void 0),(x=ne.current)===null||x===void 0||x.resetFields()}},title:T.format("yamlDrawerTitle"),formRef:ne,ref:We,trigger:(0,o.jsx)(F.ZP,{type:"primary",icon:M.id?(0,o.jsx)(y.Z,{}):void 0,children:N.Ob.format(M.id?"compose.list.edit":"compose.list.create")}),onFinish:function(){var I=P()(d()().mark(function D(x){var xe,re,he,p;return d()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(x.type!="remoteGit"){f.next=7;break}return(xe=We.current)===null||xe===void 0||xe.loading(),f.next=4,(0,c.zN)({uri:x.remoteUrl,name:x.name}).finally(function(){var O;(O=We.current)===null||O===void 0||O.finish()});case 4:return re=f.sent,M.onFinish&&M.onFinish(re.data.id),f.abrupt("return",!0);case 7:return f.prev=7,he={id:M.id&&M.id.toString(),type:x.type,name:x.name,title:x.title,environment:x.environment,remoteUrl:x.remoteUrl,yaml:w==null?void 0:w.yaml,yamlOverride:w==null?void 0:w.override},f.next=11,(0,c.im)(he);case 11:return p=f.sent,M.onFinish&&M.onFinish(p.data.id),f.abrupt("return",!0);case 16:return f.prev=16,f.t0=f.catch(7),f.abrupt("return",!1);case 19:case"end":return f.stop()}},D,null,[[7,16]])}));return function(D){return I.apply(this,arguments)}}(),children:[(0,o.jsx)(E.Z,{ghost:!0,children:(0,o.jsxs)(Fe.UW,{children:[(0,o.jsx)(m.Z,{label:T.format("createFormName"),name:"name",width:"md",required:!0,disabled:!!M.id,rules:[{required:!0},{pattern:/^[a-zA-Z0-9_-]+$/,message:T.format("createFormNameRule")}],placeholder:T.format("createFormNameEmpty")}),(0,o.jsx)(m.Z,{label:T.format("createFormTitle"),name:"title",width:"md"})]})},"createForm"),(0,o.jsx)(G.Z.Group,{label:T.format("createFormType"),name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(){var D;(D=ne.current)===null||D===void 0||D.resetFields(["yaml","environment"])}},disabled:!!M.id,options:T.option("createFormTypeOption",["text","remoteUrl","remoteGit","storagePath","store","outPath"]).map(function(I){return{label:I.label,value:I.value}})}),(0,o.jsx)(ee.Z,{name:["type"],children:function(D){var x=D.type;if(x=="text")return(0,o.jsxs)(J.Z,{gutter:[10,0],children:[(0,o.jsx)(U.Z,{span:12,children:(0,o.jsx)(R.Z,{title:T.format("createFormTypeTextImportFile"),onImport:function(re){return A(s()(s()({},w),{yaml:re})),(0,Ae.m)(re).map(function(he){var p;(p=Ce.current)===null||p===void 0||p.addEnvItem(he.name,he.value)}),!0},onLoad:function(re){if(re.indexOf("services:")<0)throw new Error(N.FD.format("commonFileIncorrectFormat",{name:"yaml"}));return!0}},"importFile")}),(0,o.jsx)(U.Z,{span:12,children:(0,o.jsx)(pe,{title:T.format("createFormTypeTextImportRemote"),onRequest:function(){var xe=P()(d()().mark(function re(he){var p;return d()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,c.MG)({uri:he});case 2:return p=f.sent,A(s()(s()({},w),{yaml:p.data.content})),(0,Ae.m)(p.data.content).map(function(O){var C;(C=Ce.current)===null||C===void 0||C.addEnvItem(O.name,O.value)}),f.abrupt("return");case 6:case"end":return f.stop()}},re)}));return function(re){return xe.apply(this,arguments)}}()},"importRemote")})]});if(x=="remoteUrl")return(0,o.jsx)(J.Z,{gutter:[10,0],children:(0,o.jsxs)(U.Z,{span:24,children:[(0,o.jsx)(oe.Z,{shouldUpdate:!0,children:function(re){return(0,o.jsx)(pe,{defaultUrl:re.getFieldValue("remoteUrl"),title:T.format("createFormTypeRemoteImportUrl"),onRequest:function(){var he=P()(d()().mark(function p(Re){var f,O;return d()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return ae.next=2,(0,c.MG)({uri:Re});case 2:return O=ae.sent,A(s()(s()({},w),{yaml:O.data.content})),(f=ne.current)===null||f===void 0||f.setFieldValue("remoteUrl",Re),(0,Ae.m)(O.data.content).map(function(Oe){var ge;(ge=Ce.current)===null||ge===void 0||ge.addEnvItem(Oe.name,Oe.value)}),ae.abrupt("return");case 7:case"end":return ae.stop()}},p)}));return function(p){return he.apply(this,arguments)}}()},"importRemote1")}}),(0,o.jsx)(oe.Z,{hidden:!0,name:"remoteUrl"},"remoteUrl")]})});if(x=="remoteGit")return(0,o.jsx)(m.Z,{name:"remoteUrl",label:T.format("createFormTypeRemoteImportGit")},"importRemote2");if(x=="storagePath")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(m.Z,{name:"storagePath",required:!0,readonly:!0,initialValue:T.format("createFormTypeStoragePathTip"),addonAfter:(0,o.jsx)("a",{href:"https://dpanel.cc/manual/compose-create",target:"_blank",children:N.FD.format("help")})})});if(x=="store")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(m.Z,{readonly:!0,name:"store",required:!0,initialValue:T.format("createFormTypeStoreTip"),addonAfter:(0,o.jsx)(ze.Link,{to:"/compose/appstore",children:N.Ob.format("compose.appstore")})})});if(x=="outPath")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(m.Z,{name:"outPath",required:!0,readonly:!0,initialValue:T.format("createFormTypeOutPathTip")})})}}),(0,o.jsx)(ee.Z,{name:["type"],children:function(D){var x=D.type;return(x=="text"||x=="remoteUrl"||M.id)&&(0,o.jsxs)(E.Z,{ghost:!0,direction:"row",children:[(0,o.jsxs)(E.Z,{ghost:!0,colSpan:"50%",children:[(0,o.jsx)(l.Z,{type:"warning",message:T.format("createFormTypeTextTip"),style:{marginBottom:15}},"yamlTips"),(0,o.jsx)(l.Z,{message:(0,o.jsxs)(o.Fragment,{children:[T.format("createEnvTip1")," ","${DB_NAME}",". ",T.format("createEnvTip2")]})}),(0,o.jsx)(Ve.Z,{drawerProps:{ghost:!0,title:(0,o.jsx)(b.Z,{}),subTitle:T.format("createEnvTitle")},name:"environment",showInDrawer:!0,showImportButton:!M.id,showAddButton:!0,showCodeMode:!M.id,ref:Ce})]}),(0,o.jsx)(E.Z,{colSpan:"50%",children:ot})]},"yamlEditor")}})]},"yamlCreate")},rt=Ye},91218:function(Qe,Ze,e){e.d(Ze,{Z:function(){return he}});var Te=e(97857),d=e.n(Te),Ee=e(19632),P=e.n(Ee),W=e(15009),s=e.n(W),je=e(99289),L=e.n(je),z=e(5574),V=e.n(z),c=e(67294),N=e(3616),y=e(36146),b=e(38345),E=e(97269),Fe=e(86615),m=e(62370),G=e(90098),ee=e(27166),oe=e(43425),Y=e(33160),te=e(82061),de=e(87784),X=e(74842),F=e(30159),Le=e(25035),le=e(95591),J=e(26522),U=e(33862),l=e(40056),i=e(42075),R=e(96074),n=e(25593),tt=e(86250),we=e(84567),o=e(83062),Ue=e(83622),pe=e(80821),Ve=e(82346),Ae=e(79697),nt=e(99861),ze=e(1699),Ye=e(89035),rt=e(75544),t=e(85893),M=(0,c.forwardRef)(function(p,Re){(0,c.useImperativeHandle)(Re,function(){return{show:function(){return L()(s()().mark(function S(){var se;return s()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ge(!0),(se=O.current)===null||se===void 0||se.clear(),ie.next=4,new Promise(function(Me){return setTimeout(function(){var $e;($e=O.current)===null||$e===void 0||$e.fit(),Me(!0)},1e3)});case 4:case"end":return ie.stop()}},S)}))()},close:function(){var S;ge(!1),(S=O.current)===null||S===void 0||S.clear()},cancel:function(){return L()(s()().mark(function S(){var se;return s()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return(se=O.current)===null||se===void 0||se.clear(),f.progress.close("compose:"+p.id),ie.abrupt("return",!0);case 3:case"end":return ie.stop()}},S)}))()}}});var f=(0,Ve.useModel)("subscriber"),O=(0,c.useRef)(),C=(0,c.useState)(!1),ae=V()(C,2),Oe=ae[0],ge=ae[1];return f.addDataHandler("compose:"+p.id,function(K){var S;(S=O.current)===null||S===void 0||S.write(K.data)}),(0,t.jsx)(b.Z,{hidden:!Oe,ghost:!0,title:(0,t.jsx)(Ye.Z,{}),subTitle:"Console",extra:(0,t.jsx)(i.Z,{children:(0,t.jsx)(pe.Z,{action:L()(s()().mark(function K(){var S;return s()().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return(S=O.current)===null||S===void 0||S.clear(),f.progress.close("compose:"+p.id),fe.abrupt("return");case 3:case"end":return fe.stop()}},K)})),buttonProps:{icon:(0,t.jsx)(te.Z,{}),danger:!0},children:y.FD.format("listManageKill")},"kill")}),children:(0,t.jsx)(rt.Z,{id:"create-log-".concat(p.id),height:"200px",style:{fontSize:12},ref:O})})}),Pe=M,T=e(83002),Be=e(60940),be=e(55241),ne=e(78451),Ce=e(37413),ce=e(94359),me=e(91806),w=e(60433),A=e(99611),at=e(99922),He=e(3905),it=e(87662),Ge=e(5251),We=e(29463);function ot(p){var Re=(0,c.useState)(""),f=V()(Re,2),O=f[0],C=f[1],ae=(0,c.useRef)(),Oe=(0,c.useRef)(),ge=(0,c.useState)(),K=V()(ge,2),S=K[0],se=K[1],fe=new y.Uo("components.appCompose"),ie=(0,c.useRef)(),Me=(0,c.useState)(),$e=V()(Me,2),Xe=$e[0],Je=$e[1],ke=(0,c.useState)(),_e=V()(ke,2),Ne=_e[0],a=_e[1];return(0,c.useEffect)(function(){return(0,it.K3)().then(function(k){var H;C((H=k.data.serverUrl)!==null&&H!==void 0?H:"")}),se(!1),p.containerList&&Je(p.containerList.filter(function(k){return k.status!=""}).map(function(k){return k.service})),a(p.containerList),function(){a([])}},[p.containerList]),(0,t.jsxs)(b.Z,{ghost:!0,title:(0,t.jsx)(me.Z,{}),subTitle:fe.format("detailContainerTitle"),extra:p.enableSelectService&&(0,t.jsx)(we.Z,{checked:S,onChange:function(H){se(H.target.checked)},children:fe.format("selectService")},"selectService"),children:[(0,t.jsx)(at.Z,{showFileExplorer:!0,ref:ae}),(0,t.jsx)(We.Z,{ref:ie}),(0,t.jsx)(He.Z,{ref:Oe}),(0,t.jsx)(Be.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:y.FD.format("listName"),dataIndex:"name",width:200,render:function(H,h,ue){return(0,t.jsx)(o.Z,{title:h.service,children:(0,t.jsx)(ne.Z,{content:h.name?(0,Ge.fi)(h.name,"/"):h.service})})}},{title:y.FD.format("listPort"),render:function(H,h,ue){var Q=[],$=[];return h.publishers&&h.publishers.map(function(ve){ve.publishedPort?Q.push({PrivatePort:ve.targetPort,Type:ve.protocol,IP:ve.url,PublicPort:ve.publishedPort}):ve.publishedPort&&$.push({PrivatePort:ve.targetPort,Type:ve.protocol,IP:ve.url,PublicPort:ve.publishedPort})}),(0,t.jsx)(Ce.Z,{publicPort:Q,privatePort:$,domain:[],serverIp:O})}},{title:y.FD.format("listStatus"),render:function(H,h,ue){return(0,t.jsx)(ce.Z,{status:"container.".concat(h.state),tip:"".concat(h.state," ").concat(h.status)},h.name)}},{title:y.FD.format("listManage"),fixed:"right",render:function(H,h,ue){return(0,t.jsxs)(i.Z,{split:(0,t.jsx)(R.Z,{type:"vertical"}),children:[h.name==""&&(0,t.jsx)(be.Z,{placement:"left",content:(0,t.jsx)(b.Z,{ghost:!0,title:y.FD.format("listManageShowContainerEnv"),children:(0,t.jsx)(i.Z,{direction:"vertical",children:h.environment&&Object.keys(h.environment).map(function(Q){if(h.environment&&h.environment[Q])return(0,t.jsx)(n.Z.Text,{code:!0,children:"".concat(Q,"=").concat(h.environment[Q])},Q)})})}),children:(0,t.jsx)(w.Z,{})}),h.name!=""&&(0,t.jsx)(n.Z.Link,{onClick:function(){var $;($=Oe.current)===null||$===void 0||$.show(h.name)},children:(0,t.jsx)(A.Z,{})},"container"),h.state=="running"&&(0,t.jsx)(n.Z.Link,{onClick:function(){var $;($=ae.current)===null||$===void 0||$.show({url:"/console/container/".concat((0,Ge.fi)(h.name,"/")),title:h.name})},children:(0,t.jsx)(Ye.Z,{})},"console"),h.state=="running"&&(0,t.jsx)(n.Z.Link,{onClick:function(){var $;($=ie.current)===null||$===void 0||$.showContainer((0,Ge.fi)(h.name,"/"))},children:(0,t.jsx)(le.Z,{})},"file")]})}}],dataSource:Ne,rowSelection:S&&Ne?{selectedRowKeys:Xe,onChange:function(H,h,ue){Je(H),p.selectServiceFinish&&p.selectServiceFinish(H)}}:void 0})]})}var I=e(91058),D=e(82848),x=e(2831),xe=e(16970),re=(0,c.forwardRef)(function(p,Re){var f,O=(0,Ve.useAccess)(),C=new y.Uo("components.appCompose"),ae=new y.Uo("components.network"),Oe=(0,c.useState)(0),ge=V()(Oe,2),K=ge[0],S=ge[1],se=(0,c.useState)(!1),fe=V()(se,2),ie=fe[0],Me=fe[1],$e=(0,c.useState)(!1),Xe=V()($e,2),Je=Xe[0],ke=Xe[1],_e=(0,c.useState)(),Ne=V()(_e,2),a=Ne[0],k=Ne[1],H=(0,c.useRef)(),h=(0,c.useRef)(),ue=(0,c.useRef)(),Q=(0,c.useRef)(),$=(0,c.useRef)(),ve=(0,c.useRef)(),ct=(0,c.useRef)(),ft=(0,c.useState)(),mt=V()(ft,2),qe=mt[0],lt=mt[1];(0,c.useImperativeHandle)(Re,function(){return{show:function(r){return L()(s()().mark(function u(){return s()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:lt(r),Me(!0);case 2:case"end":return Z.stop()}},u)}))()}}}),(0,c.useEffect)(function(){qe&&(ke(!0),(0,G.Pn)({id:qe}).finally(L()(s()().mark(function v(){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:ke(!1);case 1:case"end":return u.stop()}},v)}))).then(function(v){var r=v.data.detail;r.setting.status&&r.setting.status.includes("running")&&(r.isRunning=!0),r.setting.status&&r.setting.status.includes("paused")&&(r.isPaused=!0),r.setting.status&&r.setting.status.includes("exited")&&(r.isExited=!0),r.setting.status&&r.setting.status.includes("waiting")?r.isDeploy=!1:r.isDeploy=!0,r.setting.status&&r.setting.status.includes("created")&&(r.isCreated=!0,r.isDeploy=!1);var u=v.data.project;if(u&&u.services&&(r.imageList=P()(new Set(Object.keys(u.services).map(function(_){var j;return(j=u.services[_].image)!==null&&j!==void 0?j:""}).filter(function(_){return _!=""})))),r.containerList=v.data.containerList,r.containerList||(r.containerList=[]),u!=null&&u.services&&Object.entries(u==null?void 0:u.services).forEach(function(_){var j,De=V()(_,2),Se=De[0],ye=De[1],Ke=r.containerList.find(function(B){return B.service==Se});Ke||r.containerList.push({project:(j=u.name)!==null&&j!==void 0?j:"",name:"",service:Se,publishers:ye.ports?ye.ports.map(function(B){var Ie;return{url:"",targetPort:B.target,publishedPort:parseInt(B.published),protocol:(Ie=B.protocol)!==null&&Ie!==void 0?Ie:""}}):[],state:"waiting",status:"",environment:ye.environment})}),r.containerList){var g;(g=ue.current)===null||g===void 0||g.setFieldValue("deployServiceName",v.data.detail.setting.deployServiceName)}if(k(d()(d()({},v.data),{detail:r})),v.data.detail.setting.environment){var Z;(Z=ue.current)===null||Z===void 0||Z.setFieldValue("environment",v.data.detail.setting.environment)}}))},[K,qe]);function vt(v){return st.apply(this,arguments)}function st(){return st=L()(s()().mark(function v(r){var u,g,Z;return s()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if((u=$.current)===null||u===void 0||u.show(),!r.pullImageUseDPanel){j.next=5;break}return j.next=4,(g=H.current)===null||g===void 0?void 0:g.start();case 4:(Z=H.current)===null||Z===void 0||Z.finish();case 5:return j.prev=5,j.next=8,(0,G.Oh)(r);case 8:p.onDeployFinish&&p.onDeployFinish(),j.next=14;break;case 11:j.prev=11,j.t0=j.catch(5),p.onDeployFailed&&p.onDeployFailed();case 14:S(K+1);case 15:case"end":return j.stop()}},v,null,[[5,11]])})),st.apply(this,arguments)}return(0,t.jsxs)(ee.Z,{drawerProps:{width:N.R_,destroyOnHidden:!0},requestLoading:Je,title:a?C.format("drawerTitle",{name:(f=a==null?void 0:a.detail.name)!==null&&f!==void 0?f:""}):C.format("createTitle"),open:ie,onOpenChange:function(r){r||(lt(void 0),k(void 0),p.onClose&&p.onClose()),Me(r)},submitter:!1,formRef:ue,children:[a&&!(0,Ae.Z)(a.detail.imageList)&&(0,t.jsx)(nt.Z,{ref:H,image:a.detail.imageList}),(0,t.jsx)(We.Z,{ref:ct}),(0,t.jsxs)(b.Z,{direction:"column",ghost:!0,gutter:[0,10],children:[a&&a.detail.setting.type=="dangling"&&(0,t.jsx)(l.Z,{type:"warning",showIcon:!0,description:(0,t.jsxs)("div",{children:[C.format("managerStatusDanglingAlert",{name:a.detail.name})," ",(0,t.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-outpath",target:"_blank",children:y.FD.format("help")})]})}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(b.Z,{title:(0,t.jsx)(oe.Z,{}),subTitle:C.format("managerContainerTitle"),ghost:!0,children:(0,t.jsxs)(i.Z,{wrap:!0,split:(0,t.jsx)(R.Z,{type:"vertical"}),children:[(0,t.jsxs)(ze.u,{access:"canSeeComposeListManage",space:{},children:[(0,t.jsx)(pe.Z,{buttonProps:{icon:(0,t.jsx)(Y.Z,{}),type:"primary"},confirmProps:{onOpenChange:function(r,u){var g;r&&(!((g=h.current)===null||g===void 0)&&g.resetFields)&&h.current.resetFields()},description:(0,t.jsxs)(i.Z,{style:{minWidth:300},direction:"vertical",wrap:!0,children:[(0,t.jsx)(n.Z.Text,{children:C.format("managerCreateTip")}),(0,t.jsx)(E.A,{name:"createForm",formRef:h,layout:"inline",submitter:!1,children:(0,t.jsxs)(tt.Z,{vertical:!0,children:[(0,t.jsx)(Fe.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},options:C.option("managerCreatePullImageUseOption",["useCommand","useDPanel"])}),(0,t.jsx)(m.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,t.jsx)(we.Z,{children:C.format("managerCreateCreatePath")})}),(0,t.jsx)(m.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,t.jsx)(we.Z,{defaultChecked:!0,children:C.format("managerCreateRemoveOrphans")})})]})})]})},action:L()(s()().mark(function v(){var r,u,g,Z,_,j,De,Se,ye,Ke,B,Ie,et;return s()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.prev=0,q.next=3,(ye=ue.current)===null||ye===void 0?void 0:ye.validateFields();case 3:q.next=8;break;case 5:return q.prev=5,q.t0=q.catch(0),q.abrupt("return");case 8:return Ke=a?a.detail.id||a.detail.name:(r=ue.current)===null||r===void 0?void 0:r.getFieldValue("name"),B={id:Ke,createPath:(u=(g=h.current)===null||g===void 0?void 0:g.getFieldValue("createPath"))!==null&&u!==void 0?u:!1,removeOrphans:(Z=(_=h.current)===null||_===void 0?void 0:_.getFieldValue("removeOrphans"))!==null&&Z!==void 0?Z:!0},((j=h.current)===null||j===void 0?void 0:j.getFieldValue("pullImageUse"))=="useDPanel"&&(B.pullImage=!1,B.pullImageUseDPanel=!0),((De=h.current)===null||De===void 0?void 0:De.getFieldValue("pullImageUse"))=="useCommand"&&(B.pullImage=!0),Ie=((Se=ue.current)===null||Se===void 0?void 0:Se.getFieldsFormatValue)&&ue.current.getFieldsFormatValue(!0),B.environment=Ie.environment,B.deployServiceName=Ie.deployServiceName,q.next=17,(0,G.im)({id:(a.detail.id||a.detail.name).toString(),name:a.detail.name,environment:Ie.environment,type:a.detail.setting.type});case 17:if(!(a!=null&&a.detail.isDeploy&&B.deployServiceName)){q.next=23;break}if(et=[],a.detail.containerList.forEach(function(ut){var dt;ut.status!=""&&!((dt=B.deployServiceName)!==null&&dt!==void 0&&dt.includes(ut.service))&&et.push(ut.service)}),(0,Ae.Z)(et)){q.next=23;break}return q.next=23,(0,G.j6)({id:Ke,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1,destroyServiceName:et});case 23:return q.abrupt("return",vt(B));case 24:case"end":return q.stop()}},v,null,[[0,5]])})),children:C.format(a!=null&&a.detail.isDeploy?"managerUpgradeButton":"managerCreateButton")},"deploy"),(a.detail.isDeploy||a.detail.isCreated)&&(0,t.jsx)(pe.Z,{action:function(){var r;return(r=$.current)===null||r===void 0||r.show(),(0,G.j6)({id:a.detail.id||a.detail.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){S(K+1)},buttonProps:{type:"primary",danger:!0,icon:(0,t.jsx)(te.Z,{})},confirmProps:{showCommonConfirm:!0},children:C.format("managerDeleteContainerButton")},"destroyContainer")]}),a.detail.isDeploy&&(0,t.jsxs)(ze.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,t.jsx)(pe.Z,{buttonProps:{icon:(0,t.jsx)(Y.Z,{})},action:L()(s()().mark(function v(){var r;return s()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return(r=$.current)===null||r===void 0||r.show(),g.abrupt("return",(0,G.GG)({id:a.detail.id||a.detail.name,op:"restart"}));case 2:case"end":return g.stop()}},v)})),onSuccess:function(){S(K+1)},children:C.format("managerRestartButton")},"restart"),(0,t.jsx)(pe.Z,{action:function(){var r;return(r=$.current)===null||r===void 0||r.show(),(0,G.GG)({id:a.detail.id||a.detail.name,op:"stop"})},buttonProps:{icon:(0,t.jsx)(de.Z,{}),disabled:a.detail.isExited},onSuccess:function(){S(K+1)},children:C.format("managerStopButton")},"stop"),a.detail.isPaused&&(0,t.jsx)(pe.Z,{action:function(){var r;return(r=$.current)===null||r===void 0||r.show(),(0,G.GG)({id:a.detail.id||a.detail.name,op:"unpause"})},onSuccess:function(){S(K+1)},buttonProps:{icon:(0,t.jsx)(X.Z,{})},children:C.format("managerUnpauseButton")},"unpause"),!a.detail.isPaused&&(0,t.jsx)(pe.Z,{action:function(){var r;return(r=$.current)===null||r===void 0||r.show(),(0,G.GG)({id:a.detail.id||a.detail.name,op:"pause"})},onSuccess:function(){S(K+1)},buttonProps:{icon:(0,t.jsx)(F.Z,{}),disabled:!a.detail.isRunning},children:C.format("managerPauseButton")},"pause"),a.detail.isDeploy&&(0,t.jsx)(T.Z,{composeItem:a.detail,showTriggerButton:!0},"composeLog")]}),a.detail.id>0&&O.canSeeComposeListManageDelete&&(0,t.jsx)(pe.Z,{buttonProps:{type:"dashed",danger:!0,icon:(0,t.jsx)(te.Z,{})},confirmProps:{onOpenChange:function(r,u){var g;!((g=Q.current)===null||g===void 0)&&g.resetFields&&Q.current.resetFields()},description:(0,t.jsxs)(i.Z,{style:{width:280},direction:"vertical",children:[(0,t.jsx)(n.Z.Text,{children:C.format("managerDeleteTaskTip")}),(0,t.jsxs)(E.A,{formRef:Q,layout:"inline",submitter:!1,children:[(0,t.jsx)(m.Z,{initialValue:!0,name:"deleteImage",valuePropName:"checked",children:(0,t.jsx)(we.Z,{children:C.format("managerDeleteTaskDeleteImage")})}),(0,t.jsx)(m.Z,{addonAfter:(0,t.jsx)(o.Z,{title:C.format("managerDeleteTaskDeleteVolumeTip"),children:(0,t.jsx)(Le.Z,{})}),initialValue:!0,name:"deleteVolume",valuePropName:"checked",children:(0,t.jsx)(we.Z,{children:C.format("managerDeleteTaskDeleteVolume")})}),(0,t.jsx)(m.Z,{initialValue:!0,name:"deletePath",valuePropName:"checked",children:(0,t.jsx)(we.Z,{children:C.format("managerDeleteTaskDeletePath")})})]})]})},action:L()(s()().mark(function v(){var r,u,g,Z,_,j,De,Se,ye;return s()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return(r=$.current)===null||r===void 0||r.show(),B.next=3,(0,G.j6)({id:(u=(g=a.detail)===null||g===void 0?void 0:g.id)!==null&&u!==void 0?u:a.detail.name,deleteImage:(Z=(_=Q.current)===null||_===void 0?void 0:_.getFieldValue("deleteImage"))!==null&&Z!==void 0?Z:!1,deleteVolume:(j=(De=Q.current)===null||De===void 0?void 0:De.getFieldValue("deleteVolume"))!==null&&j!==void 0?j:!1,deletePath:(Se=(ye=Q.current)===null||ye===void 0?void 0:ye.getFieldValue("deletePath"))!==null&&Se!==void 0?Se:!1,deleteData:!0});case 3:Me(!1),k(void 0),p.onClose&&p.onClose();case 6:case"end":return B.stop()}},v)})),children:y.FD.format("listManageDelete")},"deleteTask"),p.showBackListButton&&(0,t.jsx)(Ve.Link,{to:"/compose/list",children:(0,t.jsx)(Ue.ZP,{children:y.Ob.format("compose.list")})})]})},"operator"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(b.Z,{title:(0,t.jsx)(oe.Z,{}),subTitle:C.format("managerTitle"),ghost:!0,children:(0,t.jsxs)(i.Z,{children:[O.canSeeComposeListManage&&(0,t.jsx)(D.Z,{id:qe,onFinish:function(){var v=L()(s()().mark(function r(u){return s()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:lt(u),S(K+1);case 2:case"end":return Z.stop()}},r)}));return function(r){return v.apply(this,arguments)}}()}),O.canSeeComposeListManageCreate&&(a==null?void 0:a.detail.setting.type)!="outPath"&&(0,t.jsx)(Ue.ZP,{icon:(0,t.jsx)(le.Z,{}),onClick:L()(s()().mark(function v(){var r,u,g,Z;return s()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,x.aF)();case 2:u=j.sent,u.data&&(r=u.data.dpanel.containerInfo)!==null&&r!==void 0&&r.Name&&((g=ct.current)===null||g===void 0||g.showContainer((Z=u.data.dpanel.containerInfo)===null||Z===void 0?void 0:Z.Name,"/dpanel/compose/".concat(a==null?void 0:a.detail.name)));case 4:case"end":return j.stop()}},v)})),children:y.FD.format("listManageFilePath")}),(0,t.jsx)(R.Z,{type:"vertical"}),O.canSeeComposeListManage&&(0,t.jsx)(xe.Z,{trigger:(0,t.jsx)(Ue.ZP,{icon:(0,t.jsx)(J.Z,{}),children:ae.format("createTitle")},"network")},"network-create"),(0,t.jsx)(Ue.ZP,{icon:(0,t.jsx)(Y.Z,{}),onClick:function(){var r;(r=$.current)===null||r===void 0||r.close(),S(K+1)},children:y.FD.format("listManageRefresh")})]})},"manager"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(Pe,{ref:$,id:(a==null?void 0:a.detail.id)||(a==null?void 0:a.detail.name)}),a&&a.containerList&&(0,t.jsx)(ot,{containerList:a==null?void 0:a.containerList,enableSelectService:(a==null?void 0:a.detail.setting.type)!="dangling",selectServiceFinish:function(r){var u;(u=ue.current)===null||u===void 0||u.setFieldValue("deployServiceName",r)}}),(0,t.jsx)(m.Z,{name:"deployServiceName",hidden:!0}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(I.Z,{drawerProps:{ghost:!0,title:(0,t.jsx)(U.Z,{}),subTitle:"".concat(C.format("createEnvTitle"))},showDisableName:!0,showDeleteButton:!1,name:"environment",ref:ve})]})]})}),he=re},75544:function(Qe,Ze,e){var Te=e(5574),d=e.n(Te),Ee=e(12323),P=e(78267),W=e.n(P),s=e(75458),je=e.n(s),L=e(67294),z=e(4244),V=e.n(z),c=e(24078),N=e(85893),y,b,E,Fe=(0,L.forwardRef)(function(m,G){var ee,oe=(0,L.useState)(!0),Y=d()(oe,2),te=Y[0],de=Y[1];return(0,L.useEffect)(function(){return y=new z.Terminal(Ee.X),b=new s.SearchAddon,E=new P.FitAddon,window.addEventListener("resize",function(){m.showInModal||E.fit()}),m.style&&m.style.fontSize&&(y.options.fontSize=m.style.fontSize),y.loadAddon(E),y.loadAddon(b),y.open(document.getElementById(m.id?m.id:"terminal-container")),m.showInModal||E.fit(),function(){y.reset(),de(!0)}},[]),(0,L.useImperativeHandle)(G,function(){return{write:function(F){te&&(E.fit(),de(!1)),y.write(F)},clear:function(){y.clear()},getTerminal:function(){return y},findNext:function(F){b.findNext(F)},findPrev:function(F){b.findPrevious(F)},fit:function(){E.fit()},onData:function(F){return y.onData(F)}}}),(0,N.jsx)("div",{id:m.id?m.id:"terminal-container",style:{width:m.width?m.width:"100%",height:m.height?m.height:"500px",marginTop:(ee=m.style)===null||ee===void 0?void 0:ee.marginTop}})});Ze.Z=Fe},90098:function(Qe,Ze,e){e.d(Ze,{GG:function(){return Fe},MG:function(){return te},Oh:function(){return N},Pn:function(){return V},Yz:function(){return G},iE:function(){return Le},im:function(){return s},j6:function(){return b},pm:function(){return L},tw:function(){return J},vf:function(){return oe},zN:function(){return X}});var Te=e(15009),d=e.n(Te),Ee=e(99289),P=e.n(Ee),W=e(82346);function s(l){return je.apply(this,arguments)}function je(){return je=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,W.request)("/api/app/compose/create",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),je.apply(this,arguments)}function L(l){return z.apply(this,arguments)}function z(){return z=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,W.request)("/api/app/compose/get-list",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),z.apply(this,arguments)}function V(l){return c.apply(this,arguments)}function c(){return c=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,W.request)("/api/app/compose/get-task",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),c.apply(this,arguments)}function N(l){return y.apply(this,arguments)}function y(){return y=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,W.request)("/api/app/compose/container-deploy",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),y.apply(this,arguments)}function b(l){return E.apply(this,arguments)}function E(){return E=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,W.request)("/api/app/compose/container-destroy",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),E.apply(this,arguments)}function Fe(l){return m.apply(this,arguments)}function m(){return m=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,W.request)("/api/app/compose/container-ctrl",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),m.apply(this,arguments)}function G(l){return ee.apply(this,arguments)}function ee(){return ee=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,W.request)("/api/app/compose/container-log",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),ee.apply(this,arguments)}function oe(l){return Y.apply(this,arguments)}function Y(){return Y=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.download=!0,i.id=String(i.id),n.next=4,(0,W.request)("/api/app/compose/container-log",{method:"POST",data:i,responseType:"blob"});case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},l)})),Y.apply(this,arguments)}function te(l){return de.apply(this,arguments)}function de(){return de=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,W.request)("/api/app/compose/get-from-uri",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),de.apply(this,arguments)}function X(l){return F.apply(this,arguments)}function F(){return F=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,W.request)("/api/app/compose/get-from-git",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),F.apply(this,arguments)}function Le(l){return le.apply(this,arguments)}function le(){return le=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,W.request)("/api/common/store/deploy",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),le.apply(this,arguments)}function J(l){return U.apply(this,arguments)}function U(){return U=P()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,W.request)("/api/app/compose/download",{method:"POST",data:i,responseType:"blob"}));case 2:case"end":return n.stop()}},l)})),U.apply(this,arguments)}}}]);
