"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1218],{83002:function(ze,Re,e){var De=e(5574),c=e.n(De),Se=e(15009),x=e.n(Se),K=e(99289),d=e.n(K),ye=e(83622),T=e(85265),Y=e(67294),V=e(81146),m=e(1883),Q=e(90098),C=e(3616),G=e(36146),F=e(85893),Ze=(0,Y.forwardRef)(function(p,N){(0,Y.useImperativeHandle)(N,function(){return{show:function(M){return d()(x()().mark(function s(){return x()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:Te(M),ie(!0);case 2:case"end":return D.stop()}},s)}))()}}});var ae=(0,Y.useState)(!1),se=c()(ae,2),k=se[0],ie=se[1],ce=(0,Y.useState)(),q=c()(ce,2),O=q[0],Te=q[1],ue=(0,Y.useRef)();return(0,F.jsxs)(F.Fragment,{children:[p.showTriggerButton&&(0,F.jsx)(ye.ZP,{onClick:d()(x()().mark(function ee(){return x()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:Te(p.composeItem),ie(!0);case 2:case"end":return s.stop()}},ee)})),icon:(0,F.jsx)(m.Z,{}),children:G.FD.format("listManageLog")},"log"),(0,F.jsx)(T.Z,{title:G.FD.format("listLog"),open:k,forceRender:!0,onClose:function(){ie(!1)},afterOpenChange:function(M){if(M)setTimeout(function(){var i,D;(i=ue.current)===null||i===void 0||i.start(),(D=ue.current)===null||D===void 0||D.fit()},1e3);else{var s;(s=ue.current)===null||s===void 0||s.close()}},width:C.FK,children:O&&k&&(0,F.jsx)(V.Z,{ref:ue,showInDrawer:!0,id:"compose:log:".concat(String(O.id||O.name)),request:function(){var ee=d()(x()().mark(function M(s){var i;return x()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,Q.Yz)({id:O.id||O.name,lineTotal:s.lineTotal,download:(i=s.download)!==null&&i!==void 0?i:!1,showTime:s.showTime});case 2:case"end":return n.stop()}},M)}));return function(M){return ee.apply(this,arguments)}}(),download:function(){var ee=d()(x()().mark(function M(s){var i;return x()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,Q.vf)({id:O.id||O.name,lineTotal:s.lineTotal,showTime:s.showTime,download:!0});case 2:return i=n.sent,n.abrupt("return",{data:new Blob([i],{type:"text/plain"}),name:p.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return n.stop()}},M)}));return function(M){return ee.apply(this,arguments)}}()})})]})});Re.Z=Ze},82848:function(ze,Re,e){e.d(Re,{Z:function(){return et}});var De=e(15009),c=e.n(De),Se=e(99289),x=e.n(Se),K=e(97857),d=e.n(K),ye=e(5574),T=e.n(ye),Y=e(3616),V=e(24963),m=e(90098),Q=e(36146),C=e(86548),G=e(33862),F=e(38345),Ze=e(24739),p=e(5966),N=e(86615),ae=e(97462),se=e(62370),k=e(95213),ie=e(11106),ce=e(92398),q=e(42075),O=e(83622),Te=e(83062),ue=e(40411),ee=e(71230),M=e(15746),s=e(40056),i=e(67294),D=e(12491),n=e(85060),_e=e(97269),Fe=e(86738),o=e(85893),we=(0,i.forwardRef)(function(t,We){(0,i.useImperativeHandle)(We,function(){return{}});var je=(0,i.useRef)(),E=(0,i.useState)(!1),$e=T()(E,2),Ke=$e[0],oe=$e[1];return(0,o.jsx)(se.Z,{children:(0,o.jsx)(Fe.Z,{icon:!1,title:!1,description:(0,o.jsx)(_e.A,{name:"importRemote",layout:"horizontal",submitter:!1,formRef:je,children:(0,o.jsx)(p.Z,{width:"lg",label:"Url",initialValue:t.defaultUrl,name:"url",placeholder:"https:// or http://"})}),onOpenChange:function(me){var fe;(fe=je.current)===null||fe===void 0||fe.resetFields()},onConfirm:x()(c()().mark(function Pe(){var me,fe;return c()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(fe=(me=je.current)===null||me===void 0?void 0:me.getFieldValue("url"),fe){U.next=3;break}return U.abrupt("return");case 3:if(oe(!0),U.t0=t.onRequest,!U.t0){U.next=8;break}return U.next=8,t.onRequest(fe).finally(function(){oe(!1)});case 8:case"end":return U.stop()}},Pe)})),children:(0,o.jsx)(O.ZP,{loading:Ke,icon:(0,o.jsx)(n.Z,{}),block:!0,onClick:function(){var me;(me=je.current)===null||me===void 0||me.resetFields()},children:t.title})})})}),pe=we,Be=e(91058),Ie=e(79245),qe=e(27166),Qe=e(82346),He=(0,i.forwardRef)(function(t,We){var je,E=new Q.Uo("components.appCompose"),$e=(0,i.useContext)(V.Z),Ke=$e.message,oe=(0,i.useRef)(),Pe=(0,i.useRef)(),me=(0,i.useState)(),fe=T()(me,2),w=fe[0],U=fe[1],tt=(0,i.useState)(!1),Ye=T()(tt,2),nt=Ye[0],Me=Ye[1],Oe=(0,i.useRef)(),rt=(0,i.useState)(),ke=T()(rt,2),le=ke[0],Ve=ke[1];(0,i.useImperativeHandle)(We,function(){return{edit:function(R){Ve(R),Me(!0)}}}),(0,i.useEffect)(function(){t.id&&Ve(t.id)},[]),(0,i.useEffect)(function(){var b;if(oe.current){var R=t.id||le;if(!R){U({yaml:"",override:""});return}(b=Oe.current)===null||b===void 0||b.loading(),(0,m.Pn)({id:R}).finally(function(){var l;(l=Oe.current)===null||l===void 0||l.finish()}).then(function(l){var z,S;U({yaml:l.data.yaml[0],override:(z=l.data.yaml[1])!==null&&z!==void 0?z:""}),(S=oe.current)===null||S===void 0||S.setFieldsValue({name:l.data.detail.name,title:l.data.detail.title,type:l.data.detail.setting.type,environment:l.data.detail.setting.environment,remoteUrl:l.data.detail.setting.remoteUrl})})}},[oe.current,le]);var at=(0,o.jsx)(ce.Z,{tabBarExtraContent:(0,o.jsxs)(q.Z,{children:[(0,o.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-override",target:"_blank",children:Q.FD.format("help")}),(0,o.jsx)(O.ZP,{type:"link",onClick:function(){},children:Q.FD.format("listManageFullScreen")})]}),items:[{label:E.format("createYaml.yaml"),key:"yaml",children:w&&(0,o.jsx)(ie.ZP,{theme:"dark",height:"600px",onChange:function(R){U(d()(d()({},w),{yaml:R}))},onFocus:function(){var R;((R=oe.current)===null||R===void 0?void 0:R.getFieldValue("type"))=="remoteUrl"&&Ke.info(E.format("createYamlDisableEdit"))},readOnly:((je=oe.current)===null||je===void 0?void 0:je.getFieldValue("type"))=="remoteUrl",value:w.yaml,extensions:[k.RI.yaml()]})},{label:(0,o.jsx)(Te.Z,{title:E.format("createYamlOverrideTip"),children:(0,o.jsx)(ue.Z,{count:(w==null?void 0:w.override)&&Q.FD.format("listInUse"),offset:[15,-5],children:E.format("createYaml.override")})}),key:"yamlOverride",children:w&&(0,o.jsx)(ie.ZP,{theme:"dark",height:"600px",onChange:function(R,l){U(d()(d()({},w),{override:R}))},value:w==null?void 0:w.override,extensions:[k.RI.yaml()]})}]},"yamlEditor");return(0,o.jsxs)(qe.Z,{requestLoading:w==null&&le!=null,drawerProps:{width:Y.R_,destroyOnHidden:!0},open:nt,onOpenChange:function(R){if(Me(R),!R){var l;U(void 0),Ve(t.id),(l=oe.current)===null||l===void 0||l.resetFields()}},title:E.format("yamlDrawerTitle"),formRef:oe,ref:Oe,trigger:(0,o.jsx)(O.ZP,{type:"primary",icon:le?(0,o.jsx)(C.Z,{}):void 0,children:Q.Ob.format(le?"compose.list.edit":"compose.list.create")}),onFinish:function(){var b=x()(c()().mark(function R(l){var z,S,I,v;return c()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(l.type!="remoteGit"){j.next=7;break}return(z=Oe.current)===null||z===void 0||z.loading(),j.next=4,(0,m.zN)({uri:l.remoteUrl,name:l.name}).finally(function(){var L;(L=Oe.current)===null||L===void 0||L.finish()});case 4:return S=j.sent,t.onFinish&&t.onFinish(S.data.id),j.abrupt("return",!0);case 7:return j.prev=7,I={id:le&&le.toString(),type:l.type,name:l.name,title:l.title,environment:l.environment,remoteUrl:l.remoteUrl,yaml:w==null?void 0:w.yaml,yamlOverride:w==null?void 0:w.override},j.next=11,(0,m.im)(I);case 11:return v=j.sent,t.onFinish&&t.onFinish(v.data.id),j.abrupt("return",!0);case 16:return j.prev=16,j.t0=j.catch(7),j.abrupt("return",!1);case 19:case"end":return j.stop()}},R,null,[[7,16]])}));return function(R){return b.apply(this,arguments)}}(),children:[(0,o.jsx)(F.Z,{ghost:!0,children:(0,o.jsxs)(Ze.UW,{children:[(0,o.jsx)(p.Z,{label:E.format("createFormName"),name:"name",width:"md",required:!0,disabled:!!le,rules:[{required:!0},{pattern:/^[a-zA-Z0-9_-]+$/,message:E.format("createFormNameRule")}],placeholder:E.format("createFormNameEmpty")}),(0,o.jsx)(p.Z,{label:E.format("createFormTitle"),name:"title",width:"md"})]})},"createForm"),(0,o.jsx)(N.Z.Group,{label:E.format("createFormType"),name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(){var R;(R=oe.current)===null||R===void 0||R.resetFields(["yaml","environment"])}},disabled:!!le,options:E.option("createFormTypeOption",["text","remoteUrl","remoteGit","storagePath","store","outPath"]).map(function(b){return{label:b.label,value:b.value}})}),(0,o.jsx)(ae.Z,{name:["type"],children:function(R){var l=R.type;if(l=="text")return(0,o.jsxs)(ee.Z,{gutter:[10,0],children:[(0,o.jsx)(M.Z,{span:12,children:(0,o.jsx)(D.Z,{title:E.format("createFormTypeTextImportFile"),onImport:function(S){return U(d()(d()({},w),{yaml:S})),(0,Ie.m)(S).map(function(I){var v;(v=Pe.current)===null||v===void 0||v.addEnvItem(I.name,I.value)}),!0},onLoad:function(S){if(S.indexOf("services:")<0)throw new Error(Q.FD.format("commonFileIncorrectFormat",{name:"yaml"}));return!0}},"importFile")}),(0,o.jsx)(M.Z,{span:12,children:(0,o.jsx)(pe,{title:E.format("createFormTypeTextImportRemote"),onRequest:function(){var z=x()(c()().mark(function S(I){var v;return c()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,m.MG)({uri:I});case 2:return v=j.sent,U(d()(d()({},w),{yaml:v.data.content})),(0,Ie.m)(v.data.content).map(function(L){var $;($=Pe.current)===null||$===void 0||$.addEnvItem(L.name,L.value)}),j.abrupt("return");case 6:case"end":return j.stop()}},S)}));return function(S){return z.apply(this,arguments)}}()},"importRemote")})]});if(l=="remoteUrl")return(0,o.jsx)(ee.Z,{gutter:[10,0],children:(0,o.jsxs)(M.Z,{span:24,children:[(0,o.jsx)(se.Z,{shouldUpdate:!0,children:function(S){return(0,o.jsx)(pe,{defaultUrl:S.getFieldValue("remoteUrl"),title:E.format("createFormTypeRemoteImportUrl"),onRequest:function(){var I=x()(c()().mark(function v(ve){var j,L;return c()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,(0,m.MG)({uri:ve});case 2:return L=Z.sent,U(d()(d()({},w),{yaml:L.data.content})),(j=oe.current)===null||j===void 0||j.setFieldValue("remoteUrl",ve),(0,Ie.m)(L.data.content).map(function(H){var te;(te=Pe.current)===null||te===void 0||te.addEnvItem(H.name,H.value)}),Z.abrupt("return");case 7:case"end":return Z.stop()}},v)}));return function(v){return I.apply(this,arguments)}}()},"importRemote1")}}),(0,o.jsx)(se.Z,{hidden:!0,name:"remoteUrl"},"remoteUrl")]})});if(l=="remoteGit")return(0,o.jsx)(p.Z,{name:"remoteUrl",label:E.format("createFormTypeRemoteImportGit")},"importRemote2");if(l=="storagePath")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(p.Z,{name:"storagePath",required:!0,readonly:!0,initialValue:E.format("createFormTypeStoragePathTip"),addonAfter:(0,o.jsx)("a",{href:"https://dpanel.cc/manual/compose-create",target:"_blank",children:Q.FD.format("help")})})});if(l=="store")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(p.Z,{readonly:!0,name:"store",required:!0,initialValue:E.format("createFormTypeStoreTip"),addonAfter:(0,o.jsx)(Qe.Link,{to:"/compose/appstore",children:Q.Ob.format("compose.appstore")})})});if(l=="outPath")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(p.Z,{name:"outPath",required:!0,readonly:!0,initialValue:E.format("createFormTypeOutPathTip")})})}}),(0,o.jsx)(ae.Z,{name:["type"],children:function(R){var l=R.type;return(l=="text"||l=="remoteUrl"||le)&&(0,o.jsxs)(F.Z,{ghost:!0,direction:"row",children:[(0,o.jsxs)(F.Z,{ghost:!0,colSpan:"50%",children:[(0,o.jsx)(s.Z,{type:"warning",message:E.format("createFormTypeTextTip"),style:{marginBottom:15}},"yamlTips"),(0,o.jsx)(s.Z,{message:(0,o.jsxs)(o.Fragment,{children:[E.format("createEnvTip1")," ","${DB_NAME}",". ",E.format("createEnvTip2")]})}),(0,o.jsx)(Be.Z,{drawerProps:{ghost:!0,title:(0,o.jsx)(G.Z,{}),subTitle:E.format("createEnvTitle")},name:"environment",showInDrawer:!0,showImportButton:!le,showAddButton:!0,showCodeMode:!le,ref:Pe})]}),(0,o.jsx)(F.Z,{colSpan:"50%",children:at})]},"yamlEditor")}})]},"yamlCreate")}),et=He},91218:function(ze,Re,e){e.d(Re,{Z:function(){return R}});var De=e(97857),c=e.n(De),Se=e(19632),x=e.n(Se),K=e(15009),d=e.n(K),ye=e(99289),T=e.n(ye),Y=e(5574),V=e.n(Y),m=e(67294),Q=e(3616),C=e(36146),G=e(38345),F=e(97269),Ze=e(86615),p=e(62370),N=e(90098),ae=e(27166),se=e(43425),k=e(33160),ie=e(82061),ce=e(87784),q=e(74842),O=e(30159),Te=e(25035),ue=e(95591),ee=e(26522),M=e(33862),s=e(40056),i=e(42075),D=e(96074),n=e(25593),_e=e(86250),Fe=e(84567),o=e(83062),we=e(83622),pe=e(80821),Be=e(82346),Ie=e(79697),qe=e(99861),Qe=e(1699),He=e(89035),et=e(75544),t=e(85893),We=(0,m.forwardRef)(function(l,z){(0,m.useImperativeHandle)(z,function(){return{show:function(){return T()(d()().mark(function Z(){var H;return d()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return L(!0),(H=I.current)===null||H===void 0||H.clear(),X.next=4,new Promise(function(be){return setTimeout(function(){var Ee;(Ee=I.current)===null||Ee===void 0||Ee.fit(),be(!0)},1e3)});case 4:case"end":return X.stop()}},Z)}))()},close:function(){var Z;L(!1),(Z=I.current)===null||Z===void 0||Z.clear()},cancel:function(){return T()(d()().mark(function Z(){var H;return d()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return(H=I.current)===null||H===void 0||H.clear(),S.progress.close("compose:"+l.id),X.abrupt("return",!0);case 3:case"end":return X.stop()}},Z)}))()}}});var S=(0,Be.useModel)("subscriber"),I=(0,m.useRef)(),v=(0,m.useState)(!1),ve=V()(v,2),j=ve[0],L=ve[1];return S.addDataHandler("compose:"+l.id,function($){var Z;(Z=I.current)===null||Z===void 0||Z.write($.data)}),(0,t.jsx)(G.Z,{hidden:!j,ghost:!0,title:(0,t.jsx)(He.Z,{}),subTitle:"Console",extra:(0,t.jsx)(i.Z,{children:(0,t.jsx)(pe.Z,{action:T()(d()().mark(function $(){var Z;return d()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return(Z=I.current)===null||Z===void 0||Z.clear(),S.progress.close("compose:"+l.id),te.abrupt("return");case 3:case"end":return te.stop()}},$)})),buttonProps:{icon:(0,t.jsx)(ie.Z,{}),danger:!0},children:C.FD.format("listManageKill")},"kill")}),children:(0,t.jsx)(et.Z,{id:"create-log-".concat(l.id),height:"200px",style:{fontSize:12},ref:I})})}),je=We,E=e(83002),$e=e(60940),Ke=e(55241),oe=e(78451),Pe=e(37413),me=e(94359),fe=e(91806),w=e(60433),U=e(99611),tt=e(99922),Ye=e(3905),nt=e(87662),Me=e(5251),Oe=e(29463);function rt(l){var z=(0,m.useState)(""),S=V()(z,2),I=S[0],v=S[1],ve=(0,m.useRef)(),j=(0,m.useRef)(),L=(0,m.useState)(),$=V()(L,2),Z=$[0],H=$[1],te=new C.Uo("components.appCompose"),X=(0,m.useRef)(),be=(0,m.useState)(),Ee=V()(be,2),it=Ee[0],Ge=Ee[1],ot=(0,m.useState)(),Ne=V()(ot,2),a=Ne[0],Ue=Ne[1];return(0,m.useEffect)(function(){return(0,nt.K3)().then(function(ne){var A;v((A=ne.data.serverUrl)!==null&&A!==void 0?A:"")}),H(!1),l.containerList&&Ge(l.containerList.filter(function(ne){return ne.status!=""}).map(function(ne){return ne.service})),Ue(l.containerList),function(){Ue([])}},[l.containerList]),(0,t.jsxs)(G.Z,{ghost:!0,title:(0,t.jsx)(fe.Z,{}),subTitle:te.format("detailContainerTitle"),extra:l.enableSelectService&&(0,t.jsx)(Fe.Z,{checked:Z,onChange:function(A){H(A.target.checked)},children:te.format("selectService")},"selectService"),children:[(0,t.jsx)(tt.Z,{showFileExplorer:!0,ref:ve}),(0,t.jsx)(Oe.Z,{ref:X}),(0,t.jsx)(Ye.Z,{ref:j}),(0,t.jsx)($e.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:C.FD.format("listName"),dataIndex:"name",width:200,render:function(A,g,he){return(0,t.jsx)(o.Z,{title:g.service,children:(0,t.jsx)(oe.Z,{content:g.name?(0,Me.fi)(g.name,"/"):g.service})})}},{title:C.FD.format("listPort"),render:function(A,g,he){var B=[],J=[];return g.publishers&&g.publishers.map(function(de){de.publishedPort?B.push({PrivatePort:de.targetPort,Type:de.protocol,IP:de.url,PublicPort:de.publishedPort}):de.publishedPort&&J.push({PrivatePort:de.targetPort,Type:de.protocol,IP:de.url,PublicPort:de.publishedPort})}),(0,t.jsx)(Pe.Z,{publicPort:B,privatePort:J,domain:[],serverIp:I})}},{title:C.FD.format("listStatus"),render:function(A,g,he){return(0,t.jsx)(me.Z,{status:"container.".concat(g.state),tip:"".concat(g.state," ").concat(g.status)},g.name)}},{title:C.FD.format("listManage"),fixed:"right",render:function(A,g,he){return(0,t.jsxs)(i.Z,{split:(0,t.jsx)(D.Z,{type:"vertical"}),children:[g.name==""&&(0,t.jsx)(Ke.Z,{placement:"left",content:(0,t.jsx)(G.Z,{ghost:!0,title:C.FD.format("listManageShowContainerEnv"),children:(0,t.jsx)(i.Z,{direction:"vertical",children:g.environment&&Object.keys(g.environment).map(function(B){if(g.environment&&g.environment[B])return(0,t.jsx)(n.Z.Text,{code:!0,children:"".concat(B,"=").concat(g.environment[B])},B)})})}),children:(0,t.jsx)(w.Z,{})}),g.name!=""&&(0,t.jsx)(n.Z.Link,{onClick:function(){var J;(J=j.current)===null||J===void 0||J.show(g.name)},children:(0,t.jsx)(U.Z,{})},"container"),g.state=="running"&&(0,t.jsx)(n.Z.Link,{onClick:function(){var J;(J=ve.current)===null||J===void 0||J.show({url:"/console/container/".concat((0,Me.fi)(g.name,"/")),title:g.name})},children:(0,t.jsx)(He.Z,{})},"console"),g.state=="running"&&(0,t.jsx)(n.Z.Link,{onClick:function(){var J;(J=X.current)===null||J===void 0||J.showContainer((0,Me.fi)(g.name,"/"))},children:(0,t.jsx)(ue.Z,{})},"file")]})}}],dataSource:a,rowSelection:Z&&a?{selectedRowKeys:it,onChange:function(A,g,he){Ge(A),l.selectServiceFinish&&l.selectServiceFinish(A)}}:void 0})]})}var ke=e(91058),le=e(82848),Ve=e(2831),at=e(36588),b=(0,m.forwardRef)(function(l,z){var S,I=(0,Be.useAccess)(),v=new C.Uo("components.appCompose"),ve=(0,m.useState)(0),j=V()(ve,2),L=j[0],$=j[1],Z=(0,m.useState)(!1),H=V()(Z,2),te=H[0],X=H[1],be=(0,m.useState)(!1),Ee=V()(be,2),it=Ee[0],Ge=Ee[1],ot=(0,m.useState)(),Ne=V()(ot,2),a=Ne[0],Ue=Ne[1],ne=(0,m.useRef)(),A=(0,m.useRef)(),g=(0,m.useRef)(),he=(0,m.useRef)(),B=(0,m.useRef)(),J=(0,m.useRef)(),de=(0,m.useRef)(),ct=(0,m.useRef)(),ft=(0,m.useState)(),mt=V()(ft,2),Xe=mt[0],lt=mt[1];(0,m.useImperativeHandle)(z,function(){return{show:function(r){return T()(d()().mark(function u(){return d()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:lt(r),X(!0);case 2:case"end":return P.stop()}},u)}))()}}}),(0,m.useEffect)(function(){Xe&&(Ge(!0),(0,N.Pn)({id:Xe}).finally(T()(d()().mark(function f(){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:Ge(!1);case 1:case"end":return u.stop()}},f)}))).then(function(f){var r=f.data.detail;r.setting.status&&r.setting.status.includes("running")&&(r.isRunning=!0),r.setting.status&&r.setting.status.includes("paused")&&(r.isPaused=!0),r.setting.status&&r.setting.status.includes("exited")&&(r.isExited=!0),r.setting.status&&r.setting.status.includes("waiting")?r.isDeploy=!1:r.isDeploy=!0,r.setting.status&&r.setting.status.includes("created")&&(r.isCreated=!0,r.isDeploy=!1);var u=f.data.project;if(u&&u.services&&(r.imageList=x()(new Set(Object.keys(u.services).map(function(_){var y;return(y=u.services[_].image)!==null&&y!==void 0?y:""}).filter(function(_){return _!=""})))),r.containerList=f.data.containerList,r.containerList||(r.containerList=[]),u!=null&&u.services&&Object.entries(u==null?void 0:u.services).forEach(function(_){var y,Ce=V()(_,2),xe=Ce[0],ge=Ce[1],Ae=r.containerList.find(function(W){return W.service==xe});Ae||r.containerList.push({project:(y=u.name)!==null&&y!==void 0?y:"",name:"",service:xe,publishers:ge.ports?ge.ports.map(function(W){var Le;return{url:"",targetPort:W.target,publishedPort:parseInt(W.published),protocol:(Le=W.protocol)!==null&&Le!==void 0?Le:""}}):[],state:"waiting",status:"",environment:ge.environment})}),r.containerList){var h;(h=g.current)===null||h===void 0||h.setFieldValue("deployServiceName",f.data.detail.setting.deployServiceName)}if(Ue(c()(c()({},f.data),{detail:r})),f.data.detail.setting.environment){var P;(P=g.current)===null||P===void 0||P.setFieldValue("environment",f.data.detail.setting.environment)}}))},[L,Xe]);function vt(f){return st.apply(this,arguments)}function st(){return st=T()(d()().mark(function f(r){var u,h,P;return d()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if((u=B.current)===null||u===void 0||u.show(),!r.pullImageUseDPanel){y.next=5;break}return y.next=4,(h=ne.current)===null||h===void 0?void 0:h.start();case 4:(P=ne.current)===null||P===void 0||P.finish();case 5:return y.prev=5,y.next=8,(0,N.Oh)(r);case 8:l.onDeployFinish&&l.onDeployFinish(),y.next=14;break;case 11:y.prev=11,y.t0=y.catch(5),l.onDeployFailed&&l.onDeployFailed();case 14:$(L+1);case 15:case"end":return y.stop()}},f,null,[[5,11]])})),st.apply(this,arguments)}return(0,t.jsxs)(ae.Z,{drawerProps:{width:Q.R_,destroyOnHidden:!0},requestLoading:it,title:a?v.format("drawerTitle",{name:(S=a==null?void 0:a.detail.name)!==null&&S!==void 0?S:""}):v.format("createTitle"),open:te,onOpenChange:function(r){r||(lt(void 0),Ue(void 0),l.onClose&&l.onClose()),X(r)},submitter:!1,formRef:g,children:[a&&!(0,Ie.Z)(a.detail.imageList)&&(0,t.jsx)(qe.Z,{ref:ne,image:a.detail.imageList}),(0,t.jsx)(Oe.Z,{ref:de}),(0,t.jsxs)(G.Z,{direction:"column",ghost:!0,gutter:[0,10],children:[a&&a.detail.setting.type=="dangling"&&(0,t.jsx)(s.Z,{type:"warning",showIcon:!0,description:(0,t.jsxs)("div",{children:[v.format("managerStatusDanglingAlert",{name:a.detail.name})," ",(0,t.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-outpath",target:"_blank",children:C.FD.format("help")})]})}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(G.Z,{title:(0,t.jsx)(se.Z,{}),subTitle:v.format("managerContainerTitle"),ghost:!0,children:(0,t.jsxs)(i.Z,{wrap:!0,split:(0,t.jsx)(D.Z,{type:"vertical"}),children:[(0,t.jsxs)(Qe.u,{access:"canSeeComposeListManage",space:{},children:[(0,t.jsx)(pe.Z,{buttonProps:{icon:(0,t.jsx)(k.Z,{}),type:"primary"},confirmProps:{onOpenChange:function(r,u){var h;r&&(!((h=A.current)===null||h===void 0)&&h.resetFields)&&A.current.resetFields()},description:(0,t.jsxs)(i.Z,{style:{minWidth:300},direction:"vertical",wrap:!0,children:[(0,t.jsx)(n.Z.Text,{children:v.format("managerCreateTip")}),(0,t.jsx)(F.A,{name:"createForm",formRef:A,layout:"inline",submitter:!1,children:(0,t.jsxs)(_e.Z,{vertical:!0,children:[(0,t.jsx)(Ze.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},options:v.option("managerCreatePullImageUseOption",["useCommand","useDPanel"])}),(0,t.jsx)(p.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,t.jsx)(Fe.Z,{children:v.format("managerCreateCreatePath")})}),(0,t.jsx)(p.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,t.jsx)(Fe.Z,{defaultChecked:!0,children:v.format("managerCreateRemoveOrphans")})})]})})]})},action:T()(d()().mark(function f(){var r,u,h,P,_,y,Ce,xe,ge,Ae,W,Le,Je;return d()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.prev=0,re.next=3,(ge=g.current)===null||ge===void 0?void 0:ge.validateFields();case 3:re.next=8;break;case 5:return re.prev=5,re.t0=re.catch(0),re.abrupt("return");case 8:return Ae=a?a.detail.id||a.detail.name:(r=g.current)===null||r===void 0?void 0:r.getFieldValue("name"),W={id:Ae,createPath:(u=(h=A.current)===null||h===void 0?void 0:h.getFieldValue("createPath"))!==null&&u!==void 0?u:!1,removeOrphans:(P=(_=A.current)===null||_===void 0?void 0:_.getFieldValue("removeOrphans"))!==null&&P!==void 0?P:!0},((y=A.current)===null||y===void 0?void 0:y.getFieldValue("pullImageUse"))=="useDPanel"&&(W.pullImage=!1,W.pullImageUseDPanel=!0),((Ce=A.current)===null||Ce===void 0?void 0:Ce.getFieldValue("pullImageUse"))=="useCommand"&&(W.pullImage=!0),Le=((xe=g.current)===null||xe===void 0?void 0:xe.getFieldsFormatValue)&&g.current.getFieldsFormatValue(!0),W.environment=Le.environment,W.deployServiceName=Le.deployServiceName,re.next=17,(0,N.im)({id:(a.detail.id||a.detail.name).toString(),name:a.detail.name,environment:Le.environment,type:a.detail.setting.type});case 17:if(!(a!=null&&a.detail.isDeploy&&W.deployServiceName)){re.next=23;break}if(Je=[],a.detail.containerList.forEach(function(ut){var dt;ut.status!=""&&!((dt=W.deployServiceName)!==null&&dt!==void 0&&dt.includes(ut.service))&&Je.push(ut.service)}),(0,Ie.Z)(Je)){re.next=23;break}return re.next=23,(0,N.j6)({id:Ae,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1,destroyServiceName:Je});case 23:return re.abrupt("return",vt(W));case 24:case"end":return re.stop()}},f,null,[[0,5]])})),children:v.format(a!=null&&a.detail.isDeploy?"managerUpgradeButton":"managerCreateButton")},"deploy"),(a.detail.isDeploy||a.detail.isCreated)&&(0,t.jsx)(pe.Z,{action:function(){var r;return(r=B.current)===null||r===void 0||r.show(),(0,N.j6)({id:a.detail.id||a.detail.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){$(L+1)},buttonProps:{type:"primary",danger:!0,icon:(0,t.jsx)(ie.Z,{})},confirmProps:{showCommonConfirm:!0},children:v.format("managerDeleteContainerButton")},"destroyContainer")]}),a.detail.isDeploy&&(0,t.jsxs)(Qe.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,t.jsx)(pe.Z,{buttonProps:{icon:(0,t.jsx)(k.Z,{})},action:T()(d()().mark(function f(){var r;return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return(r=B.current)===null||r===void 0||r.show(),h.abrupt("return",(0,N.GG)({id:a.detail.id||a.detail.name,op:"restart"}));case 2:case"end":return h.stop()}},f)})),onSuccess:function(){$(L+1)},children:v.format("managerRestartButton")},"restart"),(0,t.jsx)(pe.Z,{action:function(){var r;return(r=B.current)===null||r===void 0||r.show(),(0,N.GG)({id:a.detail.id||a.detail.name,op:"stop"})},buttonProps:{icon:(0,t.jsx)(ce.Z,{}),disabled:a.detail.isExited},onSuccess:function(){$(L+1)},children:v.format("managerStopButton")},"stop"),a.detail.isPaused&&(0,t.jsx)(pe.Z,{action:function(){var r;return(r=B.current)===null||r===void 0||r.show(),(0,N.GG)({id:a.detail.id||a.detail.name,op:"unpause"})},onSuccess:function(){$(L+1)},buttonProps:{icon:(0,t.jsx)(q.Z,{})},children:v.format("managerUnpauseButton")},"unpause"),!a.detail.isPaused&&(0,t.jsx)(pe.Z,{action:function(){var r;return(r=B.current)===null||r===void 0||r.show(),(0,N.GG)({id:a.detail.id||a.detail.name,op:"pause"})},onSuccess:function(){$(L+1)},buttonProps:{icon:(0,t.jsx)(O.Z,{}),disabled:!a.detail.isRunning},children:v.format("managerPauseButton")},"pause"),a.detail.isDeploy&&(0,t.jsx)(E.Z,{composeItem:a.detail,showTriggerButton:!0},"composeLog")]}),a.detail.id>0&&I.canSeeComposeListManageDelete&&(0,t.jsx)(pe.Z,{buttonProps:{type:"dashed",danger:!0,icon:(0,t.jsx)(ie.Z,{})},confirmProps:{onOpenChange:function(r,u){var h;!((h=he.current)===null||h===void 0)&&h.resetFields&&he.current.resetFields()},description:(0,t.jsxs)(i.Z,{style:{width:280},direction:"vertical",children:[(0,t.jsx)(n.Z.Text,{children:v.format("managerDeleteTaskTip")}),(0,t.jsxs)(F.A,{formRef:he,layout:"inline",submitter:!1,children:[(0,t.jsx)(p.Z,{initialValue:!0,name:"deleteImage",valuePropName:"checked",children:(0,t.jsx)(Fe.Z,{children:v.format("managerDeleteTaskDeleteImage")})}),(0,t.jsx)(p.Z,{addonAfter:(0,t.jsx)(o.Z,{title:v.format("managerDeleteTaskDeleteVolumeTip"),children:(0,t.jsx)(Te.Z,{})}),initialValue:!0,name:"deleteVolume",valuePropName:"checked",children:(0,t.jsx)(Fe.Z,{children:v.format("managerDeleteTaskDeleteVolume")})}),(0,t.jsx)(p.Z,{initialValue:!0,name:"deletePath",valuePropName:"checked",children:(0,t.jsx)(Fe.Z,{children:v.format("managerDeleteTaskDeletePath")})})]})]})},action:T()(d()().mark(function f(){var r,u,h,P,_,y,Ce,xe,ge;return d()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return(r=B.current)===null||r===void 0||r.show(),W.next=3,(0,N.j6)({id:(u=(h=a.detail)===null||h===void 0?void 0:h.id)!==null&&u!==void 0?u:a.detail.name,deleteImage:(P=(_=he.current)===null||_===void 0?void 0:_.getFieldValue("deleteImage"))!==null&&P!==void 0?P:!1,deleteVolume:(y=(Ce=he.current)===null||Ce===void 0?void 0:Ce.getFieldValue("deleteVolume"))!==null&&y!==void 0?y:!1,deletePath:(xe=(ge=he.current)===null||ge===void 0?void 0:ge.getFieldValue("deletePath"))!==null&&xe!==void 0?xe:!1,deleteData:!0});case 3:X(!1),Ue(void 0),l.onClose&&l.onClose();case 6:case"end":return W.stop()}},f)})),children:C.FD.format("listManageDelete")},"deleteTask"),l.showBackListButton&&(0,t.jsx)(Be.Link,{to:"/compose/list",children:(0,t.jsx)(we.ZP,{children:C.Ob.format("compose.list")})})]})},"operator"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(G.Z,{title:(0,t.jsx)(se.Z,{}),subTitle:v.format("managerTitle"),ghost:!0,children:(0,t.jsxs)(i.Z,{children:[I.canSeeComposeListManage&&(0,t.jsx)(le.Z,{id:Xe,onFinish:function(){var f=T()(d()().mark(function r(u){return d()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:lt(u),$(L+1);case 2:case"end":return P.stop()}},r)}));return function(r){return f.apply(this,arguments)}}()}),I.canSeeComposeListManageCreate&&(a==null?void 0:a.detail.setting.type)!="outPath"&&(0,t.jsx)(we.ZP,{icon:(0,t.jsx)(ue.Z,{}),onClick:T()(d()().mark(function f(){var r,u,h,P;return d()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,Ve.aF)();case 2:u=y.sent,u.data&&(r=u.data.dpanel.containerInfo)!==null&&r!==void 0&&r.Name&&((h=de.current)===null||h===void 0||h.showContainer((P=u.data.dpanel.containerInfo)===null||P===void 0?void 0:P.Name,"/dpanel/compose/".concat(a==null?void 0:a.detail.name)));case 4:case"end":return y.stop()}},f)})),children:C.FD.format("listManageFilePath")}),(0,t.jsx)(D.Z,{type:"vertical"}),function(f){var r="";if((f=a.project)!==null&&f!==void 0&&f.networks){var u=Object.entries(a.project.networks).find(function(h){var P=V()(h,2),_=P[0],y=P[1];return y.external});u&&(r=u[1].name)}return r!=""&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(at.Z,{ref:ct},"network-create"),(0,t.jsx)(we.ZP,{onClick:function(){var P;(P=ct.current)===null||P===void 0||P.show(r)},icon:(0,t.jsx)(ee.Z,{}),children:v.format("joinContainerInNetwork")},"network")]})}(),(0,t.jsx)(we.ZP,{icon:(0,t.jsx)(k.Z,{}),onClick:function(){var r;(r=B.current)===null||r===void 0||r.close(),$(L+1)},children:C.FD.format("listManageRefresh")})]})},"manager"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(je,{ref:B,id:(a==null?void 0:a.detail.id)||(a==null?void 0:a.detail.name)}),a&&a.containerList&&(0,t.jsx)(rt,{containerList:a==null?void 0:a.containerList,enableSelectService:(a==null?void 0:a.detail.setting.type)!="dangling",selectServiceFinish:function(r){var u;(u=g.current)===null||u===void 0||u.setFieldValue("deployServiceName",r)}}),(0,t.jsx)(p.Z,{name:"deployServiceName",hidden:!0}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(ke.Z,{drawerProps:{ghost:!0,title:(0,t.jsx)(M.Z,{}),subTitle:"".concat(v.format("createEnvTitle"))},showDisableName:!0,showDeleteButton:!1,name:"environment",ref:J})]})]})}),R=b},75544:function(ze,Re,e){var De=e(5574),c=e.n(De),Se=e(12323),x=e(78267),K=e.n(x),d=e(75458),ye=e.n(d),T=e(67294),Y=e(4244),V=e.n(Y),m=e(24078),Q=e(85893),C,G,F,Ze=(0,T.forwardRef)(function(p,N){var ae,se=(0,T.useState)(!0),k=c()(se,2),ie=k[0],ce=k[1];return(0,T.useEffect)(function(){return C=new Y.Terminal(Se.X),G=new d.SearchAddon,F=new x.FitAddon,window.addEventListener("resize",function(){p.showInModal||F.fit()}),p.style&&p.style.fontSize&&(C.options.fontSize=p.style.fontSize),C.loadAddon(F),C.loadAddon(G),C.open(document.getElementById(p.id?p.id:"terminal-container")),p.showInModal||F.fit(),function(){C.reset(),ce(!0)}},[]),(0,T.useImperativeHandle)(N,function(){return{write:function(O){ie&&(F.fit(),ce(!1)),C.write(O)},clear:function(){C.clear()},getTerminal:function(){return C},findNext:function(O){G.findNext(O)},findPrev:function(O){G.findPrevious(O)},fit:function(){F.fit()},onData:function(O){return C.onData(O)}}}),(0,Q.jsx)("div",{id:p.id?p.id:"terminal-container",style:{width:p.width?p.width:"100%",height:p.height?p.height:"500px",marginTop:(ae=p.style)===null||ae===void 0?void 0:ae.marginTop}})});Re.Z=Ze},90098:function(ze,Re,e){e.d(Re,{GG:function(){return Ze},MG:function(){return ie},Oh:function(){return Q},Pn:function(){return V},Yz:function(){return N},iE:function(){return Te},im:function(){return d},j6:function(){return G},pm:function(){return T},tw:function(){return ee},vf:function(){return se},zN:function(){return q}});var De=e(15009),c=e.n(De),Se=e(99289),x=e.n(Se),K=e(82346);function d(s){return ye.apply(this,arguments)}function ye(){return ye=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/create",{method:"POST",data:i}));case 1:case"end":return n.stop()}},s)})),ye.apply(this,arguments)}function T(s){return Y.apply(this,arguments)}function Y(){return Y=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-list",{method:"POST",data:i}));case 1:case"end":return n.stop()}},s)})),Y.apply(this,arguments)}function V(s){return m.apply(this,arguments)}function m(){return m=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-task",{method:"POST",data:i}));case 2:case"end":return n.stop()}},s)})),m.apply(this,arguments)}function Q(s){return C.apply(this,arguments)}function C(){return C=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-deploy",{method:"POST",data:i}));case 2:case"end":return n.stop()}},s)})),C.apply(this,arguments)}function G(s){return F.apply(this,arguments)}function F(){return F=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-destroy",{method:"POST",data:i}));case 2:case"end":return n.stop()}},s)})),F.apply(this,arguments)}function Ze(s){return p.apply(this,arguments)}function p(){return p=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-ctrl",{method:"POST",data:i}));case 2:case"end":return n.stop()}},s)})),p.apply(this,arguments)}function N(s){return ae.apply(this,arguments)}function ae(){return ae=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-log",{method:"POST",data:i}));case 2:case"end":return n.stop()}},s)})),ae.apply(this,arguments)}function se(s){return k.apply(this,arguments)}function k(){return k=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.download=!0,i.id=String(i.id),n.next=4,(0,K.request)("/dpanel/api/app/compose/container-log",{method:"POST",data:i,responseType:"blob"});case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},s)})),k.apply(this,arguments)}function ie(s){return ce.apply(this,arguments)}function ce(){return ce=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-from-uri",{method:"POST",data:i}));case 1:case"end":return n.stop()}},s)})),ce.apply(this,arguments)}function q(s){return O.apply(this,arguments)}function O(){return O=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-from-git",{method:"POST",data:i}));case 1:case"end":return n.stop()}},s)})),O.apply(this,arguments)}function Te(s){return ue.apply(this,arguments)}function ue(){return ue=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/common/store/deploy",{method:"POST",data:i}));case 1:case"end":return n.stop()}},s)})),ue.apply(this,arguments)}function ee(s){return M.apply(this,arguments)}function M(){return M=x()(c()().mark(function s(i){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/download",{method:"POST",data:i,responseType:"blob"}));case 2:case"end":return n.stop()}},s)})),M.apply(this,arguments)}}}]);
