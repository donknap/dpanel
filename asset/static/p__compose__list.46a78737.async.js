"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{96781:function($,g,a){var R=a(67294),u=(0,R.createContext)({});g.Z=u},92922:function($,g,a){a.r(g),a.d(g,{default:function(){return pe}});var R=a(15009),u=a.n(R),x=a(99289),f=a.n(x),b=a(5574),F=a.n(b),P=a(90098),Z=a(30159),S=a(33160),Q=a(87784),k=a(99611),G=a(86548),N=a(16596),z=a(1883),V=a(95591),Y=a(23430),H=a(74453),C=a(63713),I=a(83062),J=a(25593),X=a(66309),q=a(23345),E=a(67294),ee=a(10781),v=a(67255),te=a(96781),ne=a(91218),ae=a(1699),se=a(83403),p=a(36146),h=a(55375),L=a(96486),De=a.n(L),re=a(89638),oe=a(87662),ie=a(5251),T=a(93162),ve=a.n(T),le=a(42013),ce=a(55681),ue=a(83002),_e=a(69033),de=a(2831),_=a(85893);function pe(){var A=(0,E.useContext)(te.Z),M=A.listTableRef,w=A.reload,O=(0,E.useRef)(),fe=(0,C.useAccess)(),U=(0,C.useLocation)(),K=new p.Uo("compose"),me=(0,E.useState)(""),B=F()(me,2),Ee=B[0],Pe=B[1],W=(0,E.useRef)(),j=(0,E.useRef)(),y=(0,E.useRef)();return(0,E.useEffect)(function(){(0,oe.K3)().then(function(c){var e;Pe((e=c.data.serverUrl)!==null&&e!==void 0?e:"")})},[]),(0,E.useEffect)(function(){var c;U.state&&!((c=M.current)===null||c===void 0)&&c.setPageInfo&&M.current.setPageInfo({current:(0,v.G$)(h.q9,M.current.pageInfo)})},[U.state,M.current]),(0,_.jsxs)(H._z,{header:{extra:[(0,_.jsx)(ae.u,{access:"canSeeComposeListManageCreate",children:(0,_.jsx)(le.Z,{onFinish:function(e){var n,t;!((n=O.current)===null||n===void 0)&&n.show&&((t=O.current)===null||t===void 0||t.show(e)),w()},ref:y})},"create")]},children:[(0,_.jsx)(ue.Z,{ref:W},"composeLog"),(0,_.jsx)(ne.Z,{ref:O,onClose:function(){w()}}),(0,_.jsx)(_e.Z,{ref:j}),(0,_.jsx)(ce.Co,{tableKey:h.q9,request:function(){var c=f()(u()().mark(function e(n){var t;return u()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,P.pm)({title:n.title,name:n.name});case 2:return t=o.sent,o.abrupt("return",{data:t.data.list.map(function(s){var i=t.data.containerList.filter(function(r){return r.project==s.name});return i&&(s.containerList=i),s}),success:!0,total:t.data.list.length});case 4:case"end":return o.stop()}},e)}));return function(e){return c.apply(this,arguments)}}(),rowKey:function(e){return e.id>0?e.id:e.name},columns:[{key:"name",title:p.FD.format("listName"),dataIndex:"name",width:300,render:function(e,n,t,l,o){return(0,_.jsx)(I.Z,{title:"".concat(n.title),placement:"right",children:(0,_.jsx)(J.Z.Link,{onClick:function(){var i;(i=O.current)===null||i===void 0||i.show(n.id||n.name)},children:n.name})})},sorter:function(e,n){return e.name.localeCompare(n.name)},defaultSortOrder:(0,v.rj)(h.q9,"name"),sortDirections:v.h5},{key:"title",title:p.FD.format("listTitle"),dataIndex:"title",width:200},{key:"ports",title:p.FD.format("listAccess"),tooltip:p.FD.format("listAccessTip"),width:150,dataIndex:"ports",search:!1,render:function(e,n,t,l){if((0,L.isEmpty)(n.containerList))return null;var o=[],s=[];return n.containerList&&n.containerList.forEach(function(i){i.publishers.forEach(function(r){r.publishedPort?o.push({PrivatePort:r.targetPort,Type:r.protocol,IP:r.url,PublicPort:r.publishedPort}):r.publishedPort&&s.push({PrivatePort:r.targetPort,Type:r.protocol,IP:r.url,PublicPort:r.publishedPort})})}),(0,_.jsx)(re.Z,{publicPort:o,privatePort:s,domain:[],serverIp:Ee})}},{title:p.FD.format("listType"),width:150,search:!1,render:function(e,n,t,l,o){var s,i=n.setting&&n.setting.type?n.setting.type:"default";return(0,_.jsx)(I.Z,{placement:"right",title:((s=n.setting.uri)!==null&&s!==void 0?s:[]).join(", "),children:(0,_.jsx)(X.Z,{color:K.format("listTypeColorOption.".concat(i)),children:K.format("listTypeOption.".concat(i))})})}},{title:p.FD.format("listStatus"),dataIndex:"status",search:!1,key:"status",render:function(e,n,t,l,o){return(0,_.jsx)(q.Z,{children:n.setting.status.split(", ").map(function(s,i){var r,d="running",m=s.indexOf("(");return m>-1?d=s.slice(0,m):d=s,(0,_.jsx)(ee.Z,{status:"compose.".concat(d),statusValue:{count:s.slice(m+1,s.length-1)},tip:"".concat(s," ").concat((r=n.setting.message)!==null&&r!==void 0?r:"")},i)})})},sorter:function(e,n){return e.setting.status.localeCompare(n.setting.status)},defaultSortOrder:(0,v.rj)(h.q9,"status")},{title:p.FD.format("listUpdatedAt"),dataIndex:"",search:!1,width:180,render:function(e,n,t,l,o){return(0,ie.NF)(n.setting.updatedAt)},sorter:function(e,n){var t,l;return new Date((t=e.setting.updatedAt)!==null&&t!==void 0?t:"").toLocaleString().localeCompare(new Date((l=n.setting.updatedAt)!==null&&l!==void 0?l:"").toLocaleString())},key:"updated",defaultSortOrder:(0,v.rj)(h.q9,"updated")}],rowSelection:fe.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(e){return{disabled:e.setting.type=="dangling"||e.setting.type=="outPath"}}}:void 0,actionRef:M,actions:[{key:"pause",label:"".concat(p.FD.format("listManagePause")," & ").concat(p.FD.format("listManageUnpause")),icon:(0,_.jsx)(Z.Z,{}),isMultiple:!0,showInContext:"operator",action:function(e){return f()(u()().mark(function n(){var t,l,o,s;return u()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.loading,l=e.selectedRows,o=e.finish,t(),s=l.some(function(d){return d.setting.status.includes("paused")}),r.abrupt("return",Promise.all(l.map(function(d){return(0,P.GG)({id:d.id||d.name,op:s?"unpause":"pause"})})).finally(function(){o(!0)}));case 4:case"end":return r.stop()}},n)}))()}},{key:"restart",label:"".concat(p.FD.format("listManageStart")," & ").concat(p.FD.format("listManageRestart")),icon:(0,_.jsx)(S.Z,{}),isMultiple:!0,showInContext:"operator",action:function(e){return f()(u()().mark(function n(){var t,l,o;return u()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.loading,l=e.selectedRows,o=e.finish,t(),i.abrupt("return",Promise.all(l.map(function(r){return(0,P.GG)({id:r.id||r.name,op:"restart"})})).finally(function(){o(!0)}));case 3:case"end":return i.stop()}},n)}))()}},{key:"stop",label:p.FD.format("listManageStop"),icon:(0,_.jsx)(Q.Z,{}),isMultiple:!0,showInContext:"operator",action:function(e){return f()(u()().mark(function n(){var t,l,o;return u()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.loading,l=e.finish,o=e.selectedRows,t(),i.abrupt("return",Promise.all(o.map(function(r){return(0,P.GG)({id:r.id||r.name,op:"stop"})})).finally(function(){l(!0)}));case 3:case"end":return i.stop()}},n)}))()}},{key:"view",label:p.FD.format("listManageView"),icon:(0,_.jsx)(k.Z,{}),showInContext:"manage",action:function(e){return f()(u()().mark(function n(){var t,l,o,s;return u()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:o=e.finish,s=e.selectedRow,o(!0),s&&((t=O.current)===null||t===void 0||t.show((l=s.id)!==null&&l!==void 0?l:s.name));case 3:case"end":return r.stop()}},n)}))()}},{key:"edit",label:p.FD.format("listManageEdit"),icon:(0,_.jsx)(G.Z,{}),showInContext:"manage",action:function(e){return f()(u()().mark(function n(){var t,l,o,s;return u()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:o=e.finish,s=e.selectedRow,o(!0),s&&((t=y.current)===null||t===void 0||t.edit((l=s.id)!==null&&l!==void 0?l:s.name));case 3:case"end":return r.stop()}},n)}))()}},{key:"update",label:p.FD.format("listManageUpgrade"),showInContext:"manage",showInOperator:!0,icon:(0,_.jsx)(N.Z,{}),action:function(e){return f()(u()().mark(function n(){var t,l,o,s;return u()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return l=e.finish,o=e.loading,s=e.selectedRow,o(),r.abrupt("return",(0,P.Oh)({id:(t=s.id)!==null&&t!==void 0?t:s.name,pullImage:!0}).finally(function(){l(!0)}));case 3:case"end":return r.stop()}},n)}))()}},{key:"log",label:p.FD.format("listManageLog"),icon:(0,_.jsx)(z.Z,{}),showInContext:"manage",showInOperator:!0,action:function(e){return f()(u()().mark(function n(){var t,l,o;return u()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:l=e.finish,o=e.selectedRow,(t=W.current)===null||t===void 0||t.show(o),l(!0);case 3:case"end":return i.stop()}},n)}))()}},{key:"file",label:p.FD.format("listManageFilePath"),icon:(0,_.jsx)(V.Z,{}),showInContext:"manage",showInOperator:!0,action:function(e){return f()(u()().mark(function n(){var t,l,o,s,i,r;return u()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return l=e.finish,o=e.selectedRow,m.next=3,(0,de.aF)();case 3:s=m.sent,s.data&&(t=s.data.dpanel.containerInfo)!==null&&t!==void 0&&t.Name&&((i=j.current)===null||i===void 0||i.showContainer((r=s.data.dpanel.containerInfo)===null||r===void 0?void 0:r.Name,"/dpanel/compose/".concat(o.name))),l(!0);case 6:case"end":return m.stop()}},n)}))()}},{key:"download",label:p.FD.format("listManageDownload"),icon:(0,_.jsx)(Y.Z,{}),showInContext:"manage",action:function(e){return f()(u()().mark(function n(){var t,l,o,s,i;return u()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(t=e.loading,l=e.finish,o=e.selectedRow,t(),o){d.next=4;break}return d.abrupt("return");case 4:return d.next=6,(0,P.tw)({id:o.id||o.name}).finally(function(){l(!0)});case 6:s=d.sent,i=new Blob([s],{type:"application/zip"}),(0,T.saveAs)(i,"compose-"+o.name+".zip");case 9:case"end":return d.stop()}},n)}))()}},{key:"dataPermission",label:se.W6.COMPOSE},{key:"delete",action:function(e){return f()(u()().mark(function n(){var t,l,o;return u()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=e.loading,l=e.finish,o=e.selectedRows,t(),i.abrupt("return",Promise.all(o.map(function(){var r=f()(u()().mark(function d(m){return u()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,(0,P.j6)({id:m.id||m.name,deleteData:!0,deletePath:!0});case 2:return D.abrupt("return",D.sent);case 3:case"end":return D.stop()}},d)}));return function(d){return r.apply(this,arguments)}}())).finally(function(){l(!0)}));case 3:case"end":return i.stop()}},n)}))()}}]},"table")]})}}}]);
