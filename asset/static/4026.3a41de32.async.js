!(function(){var oe=Object.defineProperty,le=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var ee=(U,C,t)=>C in U?oe(U,C,{enumerable:!0,configurable:!0,writable:!0,value:t}):U[C]=t,te=(U,C)=>{for(var t in C||(C={}))ue.call(C,t)&&ee(U,t,C[t]);if(q)for(var t of q(C))ce.call(C,t)&&ee(U,t,C[t]);return U},re=(U,C)=>le(U,_e(C));(self.webpackChunk=self.webpackChunk||[]).push([[4026],{52688:function(U,C,t){"use strict";var S=t(1413),m=t(45987),b=t(67294),c=t(40284),h=t(85893),d=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],D=b.forwardRef(function(T,e){var r=T.fieldProps,o=T.unCheckedChildren,n=T.checkedChildren,s=T.proFieldProps,i=(0,m.Z)(T,d);return(0,h.jsx)(c.Z,(0,S.Z)({valueType:"switch",fieldProps:(0,S.Z)({unCheckedChildren:o,checkedChildren:n},r),ref:e,valuePropName:"checked",proFieldProps:s,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},i))});C.Z=D},90672:function(U,C,t){"use strict";var S=t(1413),m=t(45987),b=t(67294),c=t(40284),h=t(85893),d=["fieldProps","proFieldProps"],D=function(e,r){var o=e.fieldProps,n=e.proFieldProps,s=(0,m.Z)(e,d);return(0,h.jsx)(c.Z,(0,S.Z)({ref:r,valueType:"textarea",fieldProps:o,proFieldProps:n},s))};C.Z=b.forwardRef(D)},74026:function(U,C,t){"use strict";var S=t(15009),m=t.n(S),b=t(99289),c=t.n(b),h=t(5574),d=t.n(h),D=t(66554),T=t(184),e=t(86615),r=t(97462),o=t(90672),n=t(64317),s=t(5966),i=t(62370),l=t(52688),u=t(83622),f=t(42075),g=t(71230),v=t(15746),O=t(67294),w=t(12491),Z=t(75544),y=t(77865),B=t(82346),P=t(3616),A=t(36146),E=t(85893),z=(0,O.forwardRef)(function(R,K){var L=(0,O.useState)(!1),_=d()(L,2),p=_[0],M=_[1],a=(0,O.useRef)(),V=(0,O.useRef)(),$=(0,O.useState)([]),x=d()($,2),Y=x[0],X=x[1],ne=(0,B.useModel)("subscriber"),se=(0,O.useState)(),Q=d()(se,2),ie=Q[0],J=Q[1],W=new A.Uo("components.appDomain");return ne.addDataHandler("domain:apply",function(H){var j;(j=V.current)===null||j===void 0||j.write(H.data)}),(0,O.useImperativeHandle)(K,function(){return{edit:function(j){var I,N;J(j),(I=a.current)===null||I===void 0||I.resetFields(),(N=a.current)===null||N===void 0||N.setFieldsValue({type:j.CA=="import"?"upload":"apply",domain:j.domain,dnsApi:j.dnsApi,sslKeyContent:j.sslKeyContent,sslCrtContent:j.sslCrtContent}),M(!0)}}}),(0,O.useEffect)(function(){(0,D.q2)().then(function(H){X(H.data.setting.map(function(j){return{label:j.title,value:j.serverName}}))})},[]),(0,E.jsx)(E.Fragment,{children:(0,E.jsxs)(T.a,{title:W.format("certTitle"),drawerProps:{forceRender:!0,width:P.R_},trigger:(0,E.jsx)(u.ZP,{type:"primary",children:W.format("certTitle")}),formRef:a,onFinish:function(){var H=c()(m()().mark(function j(I){var N,k,F,ae;return m()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if((N=V.current)===null||N===void 0||N.clear(),I.type!="upload"){G.next=7;break}return G.next=4,(0,D.ui)({type:I.type,sslKeyContent:I.sslKeyContent,sslCrtContent:I.sslCrtContent});case 4:k=G.sent,G.next=11;break;case 7:return localStorage.setItem("email",(F=I.email)!==null&&F!==void 0?F:""),G.next=10,(0,D.Pf)({type:I.type,domain:I.domain,email:I.email,certServer:I.certServer,autoUpgrade:I.autoUpgrade,renew:I.renew,debug:I.debug,dnsApi:I.dnsApi});case 10:ae=G.sent;case 11:return R.onFinish&&R.onFinish(),G.abrupt("return",!0);case 13:case"end":return G.stop()}},j)}));return function(j){return H.apply(this,arguments)}}(),onOpenChange:function(j){var I,N;if(!j){var k;J(void 0),(k=a.current)===null||k===void 0||k.resetFields()}if(R.domain&&R.domain.length>0){var F;(F=a.current)===null||F===void 0||F.setFieldValue("domain",R.domain)}(I=a.current)===null||I===void 0||I.setFieldsValue({email:(N=localStorage.getItem("email"))!==null&&N!==void 0?N:""}),M(j)},open:p,children:[(0,E.jsx)(e.Z.Group,{label:W.format("certFormType"),name:"type",initialValue:"apply",disabled:!!ie,options:W.option("certFormTypeOption",["upload","apply"])}),(0,E.jsx)(r.Z,{name:["type"],children:function(j){var I=j.type;return I=="upload"?[(0,E.jsx)(o.Z,{fieldProps:{rows:10},label:W.format("certFormSslCrtContent"),name:"sslCrtContent",tooltip:W.format("certFormSslCrtContentTip"),placeholder:"-----BEGIN CERTIFICATE-----",required:!0},"sslCrt"),(0,E.jsx)(w.Z,{title:W.format("certFormImportCrt"),onImport:function(k){var F;return(F=a.current)===null||F===void 0||F.setFieldValue("sslCrtContent",k),!0},onLoad:function(k){if(k.indexOf("BEGIN CERTIFICATE")<0)throw new Error(A.FD.format("commonFileIncorrectFormat",{name:".crt"}));return!0}},"importCrt"),(0,E.jsx)(o.Z,{fieldProps:{rows:10},label:W.format("certFormSslKeyContent"),name:"sslKeyContent",tooltip:W.format("certFormSslKeyContentTip"),placeholder:"-----BEGIN PRIVATE KEY-----",required:!0},"sslKey"),(0,E.jsx)(w.Z,{title:W.format("certFormImportKey"),onImport:function(k){var F;return(F=a.current)===null||F===void 0||F.setFieldValue("sslKeyContent",k),!0},onLoad:function(k){if(k.indexOf("PRIVATE KEY")<0)throw new Error(A.FD.format("commonFileIncorrectFormat",{name:".key"}));return!0}},"importKey")]:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(n.Z,{mode:"tags",name:"domain",label:W.format("certFormDomain"),placeholder:W.format("certFormDomainEmpty"),required:!0,rules:[{required:!0}]},"domain"),(0,E.jsx)(s.Z,{label:W.format("certFormEmail"),name:"email",required:!0,rules:[{required:!0}]}),(0,E.jsxs)(f.Z.Compact,{children:[(0,E.jsx)(n.Z,{label:W.format("certFormDnsApi"),tooltip:W.format("certFormDnsApiTip"),name:"dnsApi",width:"lg",required:!0,rules:[{required:!0}],options:Y}),(0,E.jsx)(i.Z,{label:" ",children:(0,E.jsx)(y.Z,{onFinish:function(k){X(k.map(function(F){return{label:F.title,value:F.serverName}}))}},"dns")})]}),(0,E.jsx)(n.Z,{label:W.format("certFormCertServer"),name:"certServer",tooltip:W.format("certFormCertServerTip"),initialValue:"letsencrypt",options:[{value:"letsencrypt",label:"Let's Encrypt"},{value:"zerossl",label:"ZeroSSL"}]}),(0,E.jsxs)(g.Z,{gutter:[20,10],children:[(0,E.jsx)(v.Z,{children:(0,E.jsx)(l.Z,{label:W.format("certFormAutoUpgrade"),name:"autoUpgrade",initialValue:!0})}),(0,E.jsx)(v.Z,{children:(0,E.jsx)(l.Z,{tooltip:W.format("certFormRenewTip"),label:W.format("certFormRenew"),name:"renew",initialValue:!1})}),(0,E.jsx)(v.Z,{children:(0,E.jsx)(l.Z,{tooltip:W.format("certFormDebugTip"),label:"Debug",name:"debug",initialValue:!1})}),(0,E.jsx)(v.Z,{})]}),(0,E.jsx)(Z.Z,{height:"200px",style:{fontSize:12},ref:V})]})}})]})})});C.Z=z},77865:function(U,C,t){"use strict";var S=t(15009),m=t.n(S),b=t(99289),c=t.n(b),h=t(5574),d=t.n(h),D=t(184),T=t(86615),e=t(97462),r=t(5966),o=t(83622),n=t(67294),s=t(44349),i=t(52255),l=t(66554),u=t(3616),f=t(36146),g=t(85893),v=new f.Uo("components.appDomain"),O=[{value:"dns_cf",label:"CloudFlare",fields:[{name:"CF_Token"}],help:"https://dash.cloudflare.com/profile/api-tokens"},{value:"dns_dp",label:"DNSPod",fields:[{name:"DP_Id"},{name:"DP_Key"}],help:"https://console.dnspod.cn/account/token/token"},{value:"dns_tencent",label:v.format("dnsApiOption.dns_tencent"),fields:[{name:"Tencent_SecretId"},{name:"Tencent_SecretKey"}],help:"https://console.cloud.tencent.com/cam/capi"},{label:v.format("dnsApiOption.dns_ali"),value:"dns_ali",fields:[{name:"Ali_Key"},{name:"Ali_Secret"}],help:"https://ram.console.aliyun.com/users"},{label:v.format("dnsApiOption.dns_huaweicloud"),value:"dns_huaweicloud",fields:[{name:"HUAWEICLOUD_Username"},{name:"HUAWEICLOUD_Password"},{name:"HUAWEICLOUD_DomainName"}],help:"https://support.huaweicloud.com/api-iam/iam_01_0006.html"},{label:"GoDaddy",value:"dns_gd",fields:[{name:"GD_Key"},{name:"GD_Secret"}],help:"https://developer.godaddy.com/keys/"},{label:v.format("dnsApiOption.user"),value:"user",help:"https://github.com/acmesh-official/acme.sh/wiki/dnsapi"}],w=(0,n.forwardRef)(function(Z,y){(0,n.useImperativeHandle)(y,function(){return{show:function(){E(!0)}}});var B=(0,n.useState)(!1),P=d()(B,2),A=P[0],E=P[1],z=(0,n.useRef)();return(0,g.jsxs)(D.a,{drawerProps:{width:u.R_},title:v.format("dnsApiTitle"),trigger:(0,g.jsx)(o.ZP,{children:v.format("dnsApiTitle")}),formRef:z,open:A,onFinish:function(){var R=c()(m()().mark(function K(L){var _,p;return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,l.q2)({account:Object.keys((_=L.account)!==null&&_!==void 0?_:{}).map(function(V){var $;return{title:($=O.find(function(x){return x.value==V}))===null||$===void 0?void 0:$.label,serverName:V,env:Object.keys(L.account[V]).map(function(x){return{name:x,value:L.account[V][x]}})}}),user:L.user});case 2:return p=a.sent,Z.onFinish&&Z.onFinish(p.data.setting),a.abrupt("return",!0);case 5:case"end":return a.stop()}},K)}));return function(K){return R.apply(this,arguments)}}(),onOpenChange:function(){var R=c()(m()().mark(function K(L){var _,p,M,a;return m()().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(E(L),!L){$.next=9;break}return(_=z.current)===null||_===void 0||_.resetFields(),$.next=5,(0,l.q2)();case 5:M=$.sent,a=[],M.data.setting&&M.data.setting.map(function(x){O.find(function(Y){return Y.value==x.serverName})?x.env&&x.env.map(function(Y){var X;(X=z.current)===null||X===void 0||X.setFieldValue(["account",x.serverName,Y.name],Y.value)}):x.env&&a.push(x)}),(p=z.current)===null||p===void 0||p.setFieldValue("user",a);case 9:case"end":return $.stop()}},K)}));return function(K){return R.apply(this,arguments)}}(),children:[(0,g.jsx)(T.Z.Group,{label:v.format("dnsApiServerNameSelect"),name:"serverNameSelect",radioType:"button",initialValue:"dns_dp",options:O.map(function(R){return{label:R.label,value:R.value}})}),(0,g.jsx)(e.Z,{name:["serverNameSelect"],children:function(K){var L,_=K.serverNameSelect,p=(L=O.find(function(M){return M.value===_}))===null||L===void 0?void 0:L.help;return(0,g.jsxs)("div",{style:{marginBottom:20},children:[v.format("dnsApiServerNameTip"),": ",(0,g.jsx)("a",{href:p,target:"_blank",children:p})]})}}),(0,g.jsx)(e.Z,{name:["serverNameSelect"],children:function(K){var L=K.serverNameSelect;return(0,g.jsxs)(g.Fragment,{children:[O.map(function(_){if(_.fields)return(0,g.jsx)(i.Z,{show:L==_.value,children:_.fields.map(function(p,M){return(0,g.jsx)(r.Z,{label:p.name,name:["account",_.value,p.name]},"".concat(_.value,"-").concat(M,"-").concat(p.name))})},_.value)}),(0,g.jsx)(i.Z,{show:L=="user",children:(0,g.jsx)(s.Z,{gap:20,name:"user",label:v.format("dnsApiUser"),showAddButton:!0,hideCopyButton:!0,items:[{name:"serverName",label:v.format("dnsApiUserServerName")},{name:"env",render:function(p,M,a){return(0,g.jsx)(s.Z,{gap:20,name:"env",label:v.format("dnsApiUserEnv"),showAddButton:!0,hideCopyButton:!0,items:[{name:"name",label:v.format("dnsApiUserEnvName")},{name:"value",label:v.format("dnsApiUserEnvValue")}]},"env")}}]})},"user")]})}})]})});C.Z=w},52255:function(U,C,t){"use strict";t.d(C,{Z:function(){return b}});var S=t(67294),m=t(85893);function b(c){return(0,m.jsx)("div",{style:{display:c.show?"block":"none"},children:c.children})}},75544:function(U,C,t){"use strict";var S=t(5574),m=t.n(S),b=t(12323),c=t(78267),h=t.n(c),d=t(75458),D=t.n(d),T=t(67294),e=t(4244),r=t.n(e),o=t(24078),n=t(85893),s,i,l,u=(0,T.forwardRef)(function(f,g){var v,O=(0,T.useState)(!0),w=m()(O,2),Z=w[0],y=w[1];return(0,T.useEffect)(function(){return s=new e.Terminal(b.X),i=new d.SearchAddon,l=new c.FitAddon,window.addEventListener("resize",function(){f.showInModal||l.fit()}),f.style&&f.style.fontSize&&(s.options.fontSize=f.style.fontSize),s.loadAddon(l),s.loadAddon(i),s.open(document.getElementById(f.id?f.id:"terminal-container")),f.showInModal||l.fit(),function(){s.reset(),y(!0)}},[]),(0,T.useImperativeHandle)(g,function(){return{write:function(P){Z&&(l.fit(),y(!1)),s.write(P)},clear:function(){s.clear()},getTerminal:function(){return s},findNext:function(P){i.findNext(P)},findPrev:function(P){i.findPrevious(P)},fit:function(){l.fit()},onData:function(P){return s.onData(P)}}}),(0,n.jsx)("div",{id:f.id?f.id:"terminal-container",style:{width:f.width?f.width:"100%",height:f.height?f.height:"500px",marginTop:(v=f.style)===null||v===void 0?void 0:v.marginTop}})});C.Z=u},12491:function(U,C,t){"use strict";t.d(C,{Z:function(){return l}});var S=t(5574),m=t.n(S),b=t(3616),c=t(24963),h=t(36146),d=t(88484),D=t(57546),T=t(62370),e=t(11106),r=t(42075),o=t(83622),n=t(85576),s=t(67294),i=t(85893);function l(u){var f=(0,s.useContext)(c.Z),g=f.message,v=f.notice,O=(0,s.useRef)(null),w=(0,s.useState)(!1),Z=m()(w,2),y=Z[0],B=Z[1],P=(0,s.useState)(""),A=m()(P,2),E=A[0],z=A[1];(0,s.useEffect)(function(){u.data&&z(u.data)},[u.data]);var R=function(){O.current&&(O.current.click(),O.current.onchange=function(L){if(!L||!L.target)return"";var _=new FileReader;_.onload=function(a){var V,$,x=(V=a.target)===null||V===void 0?void 0:V.result;if(u.onLoad)try{u.onLoad&&u.onLoad(x)}catch(Y){v.error(Y);return}z(x),typeof u.onImport=="function"&&(g.success(h.FD.format("finish")),u.onImport(x)),($=O.current)!==null&&$!==void 0&&$.value&&(O.current.value="")};var p=L.target;if(p.files&&p.files[0]){var M=p.files[0];try{_.readAsText(M)}catch(a){v.error(h.FD.format("commonContentIncorrectFormat",{name:p.files[0].name}))}}})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T.Z,{children:(0,i.jsxs)(r.Z.Compact,{block:!0,children:[(0,i.jsx)(o.ZP,{icon:(0,i.jsx)(d.Z,{}),block:!0,onClick:R,children:u.title}),u.showPaset&&(0,i.jsx)(o.ZP,{icon:(0,i.jsx)(D.Z,{}),onClick:function(){B(!0)}})]})}),(0,i.jsx)("input",{style:{display:"none"},type:"file",ref:O,name:"importFileInput"}),(0,i.jsx)(n.Z,{width:b.ob,open:y,onCancel:function(){B(!1)},onOk:function(){typeof u.onImport=="function"&&(g.success(h.FD.format("finish")),u.onImport(E)),B(!1)},children:(0,i.jsx)(e.ZP,{height:b.Ed,theme:"dark",value:E,onChange:function(L){z(L)}})})]})}},12323:function(U,C,t){"use strict";t.d(C,{X:function(){return S},n:function(){return m}});var S={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},m=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"]},66554:function(U,C,t){"use strict";t.d(C,{Fj:function(){return T},KK:function(){return z},Pf:function(){return u},Ss:function(){return Z},dZ:function(){return A},dj:function(){return n},hZ:function(){return O},i7:function(){return d},lQ:function(){return i},ll:function(){return K},q2:function(){return B},ui:function(){return g}});var S=t(15009),m=t.n(S),b=t(99289),c=t.n(b),h=t(82346);function d(_){return D.apply(this,arguments)}function D(){return D=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/get-list",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),D.apply(this,arguments)}function T(_){return e.apply(this,arguments)}function e(){return e=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/create",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),e.apply(this,arguments)}function r(_){return o.apply(this,arguments)}function o(){return o=_asyncToGenerator(_regeneratorRuntime().mark(function _(p){return _regeneratorRuntime().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",request("/dpanel/api/app/site-domain/update",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),o.apply(this,arguments)}function n(_){return s.apply(this,arguments)}function s(){return s=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/delete",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),s.apply(this,arguments)}function i(_){return l.apply(this,arguments)}function l(){return l=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/get-detail",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),l.apply(this,arguments)}function u(_){return f.apply(this,arguments)}function f(){return f=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/apply",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),f.apply(this,arguments)}function g(_){return v.apply(this,arguments)}function v(){return v=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/import",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),v.apply(this,arguments)}function O(){return w.apply(this,arguments)}function w(){return w=c()(m()().mark(function _(){return m()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/restart-nginx",{method:"POST"}));case 1:case"end":return M.stop()}},_)})),w.apply(this,arguments)}function Z(_){return y.apply(this,arguments)}function y(){return y=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-domain/update-vhost",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),y.apply(this,arguments)}function B(_){return P.apply(this,arguments)}function P(){return P=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/dns-api",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),P.apply(this,arguments)}function A(_){return E.apply(this,arguments)}function E(){return E=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/get-list",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),E.apply(this,arguments)}function z(_){return R.apply(this,arguments)}function R(){return R=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/delete",{method:"POST",data:p}));case 1:case"end":return a.stop()}},_)})),R.apply(this,arguments)}function K(_){return L.apply(this,arguments)}function L(){return L=c()(m()().mark(function _(p){return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/dpanel/api/app/site-cert/download",{method:"POST",data:p,responseType:"blob"}));case 1:case"end":return a.stop()}},_)})),L.apply(this,arguments)}},75458:function(U){(function(C,t){U.exports=t()})(self,()=>(()=>{"use strict";var C={345:(b,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.runAndSubscribe=c.forwardEvent=c.EventEmitter=void 0,c.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=h=>(this._listeners.push(h),{dispose:()=>{if(!this._disposed){for(let d=0;d<this._listeners.length;d++)if(this._listeners[d]===h)return void this._listeners.splice(d,1)}}})),this._event}fire(h,d){const D=[];for(let T=0;T<this._listeners.length;T++)D.push(this._listeners[T]);for(let T=0;T<D.length;T++)D[T].call(void 0,h,d)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},c.forwardEvent=function(h,d){return h(D=>d.fire(D))},c.runAndSubscribe=function(h,d){return d(void 0),h(D=>d(D))}},859:(b,c)=>{function h(d){for(const D of d)D.dispose();d.length=0}Object.defineProperty(c,"__esModule",{value:!0}),c.getDisposeArrayDisposable=c.disposeArray=c.toDisposable=c.MutableDisposable=c.Disposable=void 0,c.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const d of this._disposables)d.dispose();this._disposables.length=0}register(d){return this._disposables.push(d),d}unregister(d){const D=this._disposables.indexOf(d);D!==-1&&this._disposables.splice(D,1)}},c.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(d){var D;this._isDisposed||d===this._value||((D=this._value)==null||D.dispose(),this._value=d)}clear(){this.value=void 0}dispose(){var d;this._isDisposed=!0,(d=this._value)==null||d.dispose(),this._value=void 0}},c.toDisposable=function(d){return{dispose:d}},c.disposeArray=h,c.getDisposeArrayDisposable=function(d){return{dispose:()=>h(d)}}}},t={};function S(b){var c=t[b];if(c!==void 0)return c.exports;var h=t[b]={exports:{}};return C[b](h,h.exports,S),h.exports}var m={};return(()=>{var b=m;Object.defineProperty(b,"__esModule",{value:!0}),b.SearchAddon=void 0;const c=S(345),h=S(859),d=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class D extends h.Disposable{constructor(e){var r;super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new h.MutableDisposable),this._linesCacheTimeoutId=0,this._linesCacheDisposables=new h.MutableDisposable,this._onDidChangeResults=this.register(new c.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=(r=e==null?void 0:e.highlightLimit)!=null?r:1e3}activate(e){this._terminal=e,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,h.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){var e;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&((e=this._lastSearchOptions)!=null&&e.decorations)&&(this._highlightTimeout=setTimeout(()=>{const r=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(r,re(te({},this._lastSearchOptions),{incremental:!0,noScroll:!0}))},200))}clearDecorations(e){this._selectedDecoration.clear(),(0,h.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),e||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){this._selectedDecoration.clear()}findNext(e,r){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const o=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,r);this._lastSearchOptions=r,r!=null&&r.decorations&&(this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||o)&&this._highlightAllMatches(e,r);const n=this._findNextAndSelect(e,r);return this._fireResults(r),this._cachedSearchTerm=e,n}_highlightAllMatches(e,r){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||e.length===0)return void this.clearDecorations();r=r||{},this.clearDecorations(!0);const o=[];let n,s=this._find(e,0,0,r);for(;s&&((n==null?void 0:n.row)!==s.row||(n==null?void 0:n.col)!==s.col)&&!(o.length>=this._highlightLimit);)n=s,o.push(n),s=this._find(e,n.col+n.term.length>=this._terminal.cols?n.row+1:n.row,n.col+n.term.length>=this._terminal.cols?0:n.col+1,r);for(const i of o){const l=this._createResultDecoration(i,r.decorations);l&&(this._highlightedLines.add(l.marker.line),this._highlightDecorations.push({decoration:l,match:i,dispose(){l.dispose()}}))}}_find(e,r,o,n){var l;if(!this._terminal||!e||e.length===0)return(l=this._terminal)==null||l.clearSelection(),void this.clearDecorations();if(o>this._terminal.cols)throw new Error(`Invalid col: ${o} to search in terminal of ${this._terminal.cols} cols`);let s;this._initLinesCache();const i={startRow:r,startCol:o};if(s=this._findInLine(e,i,n),!s)for(let u=r+1;u<this._terminal.buffer.active.baseY+this._terminal.rows&&(i.startRow=u,i.startCol=0,s=this._findInLine(e,i,n),!s);u++);return s}_findNextAndSelect(e,r){var u;if(!this._terminal||!e||e.length===0)return(u=this._terminal)==null||u.clearSelection(),this.clearDecorations(),!1;const o=this._terminal.getSelectionPosition();this._terminal.clearSelection();let n=0,s=0;o&&(this._cachedSearchTerm===e?(n=o.end.x,s=o.end.y):(n=o.start.x,s=o.start.y)),this._initLinesCache();const i={startRow:s,startCol:n};let l=this._findInLine(e,i,r);if(!l)for(let f=s+1;f<this._terminal.buffer.active.baseY+this._terminal.rows&&(i.startRow=f,i.startCol=0,l=this._findInLine(e,i,r),!l);f++);if(!l&&s!==0)for(let f=0;f<s&&(i.startRow=f,i.startCol=0,l=this._findInLine(e,i,r),!l);f++);return!l&&o&&(i.startRow=o.start.y,i.startCol=0,l=this._findInLine(e,i,r)),this._selectResult(l,r==null?void 0:r.decorations,r==null?void 0:r.noScroll)}findPrevious(e,r){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const o=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,r);this._lastSearchOptions=r,r!=null&&r.decorations&&(this._cachedSearchTerm===void 0||e!==this._cachedSearchTerm||o)&&this._highlightAllMatches(e,r);const n=this._findPreviousAndSelect(e,r);return this._fireResults(r),this._cachedSearchTerm=e,n}_didOptionsChange(e,r){return!!r&&(e.caseSensitive!==r.caseSensitive||e.regex!==r.regex||e.wholeWord!==r.wholeWord)}_fireResults(e){if(e!=null&&e.decorations){let r=-1;if(this._selectedDecoration.value){const o=this._selectedDecoration.value.match;for(let n=0;n<this._highlightDecorations.length;n++){const s=this._highlightDecorations[n].match;if(s.row===o.row&&s.col===o.col&&s.size===o.size){r=n;break}}}this._onDidChangeResults.fire({resultIndex:r,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(e,r){var f;if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!e||e.length===0)return(f=this._terminal)==null||f.clearSelection(),this.clearDecorations(),!1;const o=this._terminal.getSelectionPosition();this._terminal.clearSelection();let n=this._terminal.buffer.active.baseY+this._terminal.rows-1,s=this._terminal.cols;const i=!0;this._initLinesCache();const l={startRow:n,startCol:s};let u;if(o&&(l.startRow=n=o.start.y,l.startCol=s=o.start.x,this._cachedSearchTerm!==e&&(u=this._findInLine(e,l,r,!1),u||(l.startRow=n=o.end.y,l.startCol=s=o.end.x))),u||(u=this._findInLine(e,l,r,i)),!u){l.startCol=Math.max(l.startCol,this._terminal.cols);for(let g=n-1;g>=0&&(l.startRow=g,u=this._findInLine(e,l,r,i),!u);g--);}if(!u&&n!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let g=this._terminal.buffer.active.baseY+this._terminal.rows-1;g>=n&&(l.startRow=g,u=this._findInLine(e,l,r,i),!u);g--);return this._selectResult(u,r==null?void 0:r.decorations,r==null?void 0:r.noScroll)}_initLinesCache(){const e=this._terminal;this._linesCache||(this._linesCache=new Array(e.buffer.active.length),this._linesCacheDisposables.value=(0,h.getDisposeArrayDisposable)([e.onLineFeed(()=>this._destroyLinesCache()),e.onCursorMove(()=>this._destroyLinesCache()),e.onResize(()=>this._destroyLinesCache())])),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(e,r,o){return(e===0||d.includes(r[e-1]))&&(e+o.length===r.length||d.includes(r[e+o.length]))}_findInLine(e,r,o={},n=!1){var B;const s=this._terminal,i=r.startRow,l=r.startCol,u=s.buffer.active.getLine(i);if(u!=null&&u.isWrapped)return n?void(r.startCol+=s.cols):(r.startRow--,r.startCol+=s.cols,this._findInLine(e,r,o));let f=(B=this._linesCache)==null?void 0:B[i];f||(f=this._translateBufferLineToStringWithWrap(i,!0),this._linesCache&&(this._linesCache[i]=f));const[g,v]=f,O=this._bufferColsToStringOffset(i,l),w=o.caseSensitive?e:e.toLowerCase(),Z=o.caseSensitive?g:g.toLowerCase();let y=-1;if(o.regex){const P=RegExp(w,"g");let A;if(n)for(;A=P.exec(Z.slice(0,O));)y=P.lastIndex-A[0].length,e=A[0],P.lastIndex-=e.length-1;else A=P.exec(Z.slice(O)),A&&A[0].length>0&&(y=O+(P.lastIndex-A[0].length),e=A[0])}else n?O-w.length>=0&&(y=Z.lastIndexOf(w,O-w.length)):y=Z.indexOf(w,O);if(y>=0){if(o.wholeWord&&!this._isWholeWord(y,Z,e))return;let P=0;for(;P<v.length-1&&y>=v[P+1];)P++;let A=P;for(;A<v.length-1&&y+e.length>=v[A+1];)A++;const E=y-v[P],z=y+e.length-v[A],R=this._stringLengthToBufferSize(i+P,E);return{term:e,col:R,row:i+P,size:this._stringLengthToBufferSize(i+A,z)-R+s.cols*(A-P)}}}_stringLengthToBufferSize(e,r){const o=this._terminal.buffer.active.getLine(e);if(!o)return 0;for(let n=0;n<r;n++){const s=o.getCell(n);if(!s)break;const i=s.getChars();i.length>1&&(r-=i.length-1);const l=o.getCell(n+1);l&&l.getWidth()===0&&r++}return r}_bufferColsToStringOffset(e,r){const o=this._terminal;let n=e,s=0,i=o.buffer.active.getLine(n);for(;r>0&&i;){for(let l=0;l<r&&l<o.cols;l++){const u=i.getCell(l);if(!u)break;u.getWidth()&&(s+=u.getCode()===0?1:u.getChars().length)}if(n++,i=o.buffer.active.getLine(n),i&&!i.isWrapped)break;r-=o.cols}return s}_translateBufferLineToStringWithWrap(e,r){var l;const o=this._terminal,n=[],s=[0];let i=o.buffer.active.getLine(e);for(;i;){const u=o.buffer.active.getLine(e+1),f=!!u&&u.isWrapped;let g=i.translateToString(!f&&r);if(f&&u){const v=i.getCell(i.length-1);v&&v.getCode()===0&&v.getWidth()===1&&((l=u.getCell(0))==null?void 0:l.getWidth())===2&&(g=g.slice(0,-1))}if(n.push(g),!f)break;s.push(s[s.length-1]+g.length),e++,i=u}return[n.join(""),s]}_selectResult(e,r,o){const n=this._terminal;if(this._selectedDecoration.clear(),!e)return n.clearSelection(),!1;if(n.select(e.col,e.row,e.size),r){const s=n.registerMarker(-n.buffer.active.baseY-n.buffer.active.cursorY+e.row);if(s){const i=n.registerDecoration({marker:s,x:e.col,width:e.size,backgroundColor:r.activeMatchBackground,layer:"top",overviewRulerOptions:{color:r.activeMatchColorOverviewRuler}});if(i){const l=[];l.push(s),l.push(i.onRender(u=>this._applyStyles(u,r.activeMatchBorder,!0))),l.push(i.onDispose(()=>(0,h.disposeArray)(l))),this._selectedDecoration.value={decoration:i,match:e,dispose(){i.dispose()}}}}}if(!o&&(e.row>=n.buffer.active.viewportY+n.rows||e.row<n.buffer.active.viewportY)){let s=e.row-n.buffer.active.viewportY;s-=Math.floor(n.rows/2),n.scrollLines(s)}return!0}_applyStyles(e,r,o){e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),r&&(e.style.outline=`1px solid ${r}`)),o&&e.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(e,r){const o=this._terminal,n=o.registerMarker(-o.buffer.active.baseY-o.buffer.active.cursorY+e.row);if(!n)return;const s=o.registerDecoration({marker:n,x:e.col,width:e.size,backgroundColor:r.matchBackground,overviewRulerOptions:this._highlightedLines.has(n.line)?void 0:{color:r.matchOverviewRuler,position:"center"}});if(s){const i=[];i.push(n),i.push(s.onRender(l=>this._applyStyles(l,r.matchBorder,!1))),i.push(s.onDispose(()=>(0,h.disposeArray)(i)))}return s}}b.SearchAddon=D})(),m})())}}]);
}());