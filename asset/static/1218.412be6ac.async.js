"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1218],{83002:function(Ye,Ee,e){var Te=e(5574),d=e.n(Te),Fe=e(15009),C=e.n(Fe),K=e(99289),u=e.n(K),je=e(83622),F=e(85265),Y=e(67294),V=e(81146),c=e(1883),z=e(90098),P=e(3616),b=e(36146),E=e(85893),Oe=(0,Y.forwardRef)(function(f,G){(0,Y.useImperativeHandle)(G,function(){return{show:function(I){return u()(C()().mark(function l(){return C()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:we(I),re(!0);case 2:case"end":return D.stop()}},l)}))()}}});var ne=(0,Y.useState)(!1),se=d()(ne,2),H=se[0],re=se[1],ce=(0,Y.useState)(),_=d()(ce,2),T=_[0],we=_[1],ue=(0,Y.useRef)();return(0,E.jsxs)(E.Fragment,{children:[f.showTriggerButton&&(0,E.jsx)(je.ZP,{onClick:u()(C()().mark(function q(){return C()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:we(f.composeItem),re(!0);case 2:case"end":return l.stop()}},q)})),icon:(0,E.jsx)(c.Z,{}),children:b.FD.format("listManageLog")},"log"),(0,E.jsx)(F.Z,{title:b.FD.format("listLog"),open:H,forceRender:!0,onClose:function(){re(!1)},afterOpenChange:function(I){if(I)setTimeout(function(){var i,D;(i=ue.current)===null||i===void 0||i.start(),(D=ue.current)===null||D===void 0||D.fit()},1e3);else{var l;(l=ue.current)===null||l===void 0||l.close()}},width:P.FK,children:T&&H&&(0,E.jsx)(V.Z,{ref:ue,showInDrawer:!0,id:"compose:log:".concat(String(T.id||T.name)),request:function(){var q=u()(C()().mark(function I(l){var i;return C()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,z.Yz)({id:T.id||T.name,lineTotal:l.lineTotal,download:(i=l.download)!==null&&i!==void 0?i:!1,showTime:l.showTime});case 2:case"end":return n.stop()}},I)}));return function(I){return q.apply(this,arguments)}}(),download:function(){var q=u()(C()().mark(function I(l){var i;return C()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,z.vf)({id:T.id||T.name,lineTotal:l.lineTotal,showTime:l.showTime,download:!0});case 2:return i=n.sent,n.abrupt("return",{data:new Blob([i],{type:"text/plain"}),name:f.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return n.stop()}},I)}));return function(I){return q.apply(this,arguments)}}()})})]})});Ee.Z=Oe},82848:function(Ye,Ee,e){e.d(Ee,{Z:function(){return tt}});var Te=e(15009),d=e.n(Te),Fe=e(99289),C=e.n(Fe),K=e(97857),u=e.n(K),je=e(5574),F=e.n(je),Y=e(3616),V=e(24963),c=e(90098),z=e(36146),P=e(86548),b=e(33862),E=e(38345),Oe=e(24739),f=e(5966),G=e(86615),ne=e(97462),se=e(62370),H=e(95213),re=e(11106),ce=e(92398),_=e(42075),T=e(83622),we=e(83062),ue=e(40411),q=e(71230),I=e(15746),l=e(40056),i=e(67294),D=e(12491),n=e(85060),qe=e(97269),$e=e(86738),o=e(85893),Me=(0,i.forwardRef)(function(t,$){(0,i.useImperativeHandle)($,function(){return{}});var Pe=(0,i.useRef)(),Z=(0,i.useState)(!1),Ae=F()(Z,2),be=Ae[0],ae=Ae[1];return(0,o.jsx)(se.Z,{children:(0,o.jsx)($e.Z,{icon:!1,title:!1,description:(0,o.jsx)(qe.A,{name:"importRemote",layout:"horizontal",submitter:!1,formRef:Pe,children:(0,o.jsx)(f.Z,{width:"lg",label:"Url",initialValue:t.defaultUrl,name:"url",placeholder:"https:// or http://"})}),onOpenChange:function(me){var fe;(fe=Pe.current)===null||fe===void 0||fe.resetFields()},onConfirm:C()(d()().mark(function Ce(){var me,fe;return d()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(fe=(me=Pe.current)===null||me===void 0?void 0:me.getFieldValue("url"),fe){M.next=3;break}return M.abrupt("return");case 3:if(ae(!0),M.t0=t.onRequest,!M.t0){M.next=8;break}return M.next=8,t.onRequest(fe).finally(function(){ae(!1)});case 8:case"end":return M.stop()}},Ce)})),children:(0,o.jsx)(T.ZP,{loading:be,icon:(0,o.jsx)(n.Z,{}),block:!0,onClick:function(){var me;(me=Pe.current)===null||me===void 0||me.resetFields()},children:t.title})})})}),ve=Me,Ve=e(91058),Ue=e(79245),et=e(27166),He=e(82346),ke=function($){var Pe,Z=new z.Uo("components.appCompose"),Ae=(0,i.useContext)(V.Z),be=Ae.message,ae=(0,i.useRef)(),Ce=(0,i.useRef)(),me=(0,i.useState)(),fe=F()(me,2),O=fe[0],M=fe[1],nt=(0,i.useState)(!1),Xe=F()(nt,2),rt=Xe[0],Ge=Xe[1],Be=(0,i.useRef)();(0,i.useEffect)(function(){if(ae.current){if(!$.id){M({yaml:"",override:""});return}(0,c.Pn)({id:$.id}).then(function(w){var S,R;M({yaml:w.data.yaml[0],override:(S=w.data.yaml[1])!==null&&S!==void 0?S:""}),(R=ae.current)===null||R===void 0||R.setFieldsValue({name:w.data.detail.name,title:w.data.detail.title,type:w.data.detail.setting.type,environment:w.data.detail.setting.environment,remoteUrl:w.data.detail.setting.remoteUrl})})}},[ae.current,$.id]);var at=(0,o.jsx)(ce.Z,{tabBarExtraContent:(0,o.jsxs)(_.Z,{children:[(0,o.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-override",target:"_blank",children:z.FD.format("help")}),(0,o.jsx)(T.ZP,{type:"link",onClick:function(){},children:z.FD.format("listManageFullScreen")})]}),items:[{label:Z.format("createYaml.yaml"),key:"yaml",children:O&&(0,o.jsx)(re.ZP,{theme:"dark",height:"600px",onChange:function(S){M(u()(u()({},O),{yaml:S}))},onFocus:function(){var S;((S=ae.current)===null||S===void 0?void 0:S.getFieldValue("type"))=="remoteUrl"&&be.info(Z.format("createYamlDisableEdit"))},readOnly:((Pe=ae.current)===null||Pe===void 0?void 0:Pe.getFieldValue("type"))=="remoteUrl",value:O.yaml,extensions:[H.RI.yaml()]})},{label:(0,o.jsx)(we.Z,{title:Z.format("createYamlOverrideTip"),children:(0,o.jsx)(ue.Z,{count:(O==null?void 0:O.override)&&z.FD.format("listInUse"),offset:[15,-5],children:Z.format("createYaml.override")})}),key:"yamlOverride",children:O&&(0,o.jsx)(re.ZP,{theme:"dark",height:"600px",onChange:function(S,R){M(u()(u()({},O),{override:S}))},value:O==null?void 0:O.override,extensions:[H.RI.yaml()]})}]},"yamlEditor");return(0,o.jsxs)(et.Z,{requestLoading:O==null&&$.id!=null,drawerProps:{width:Y.R_,destroyOnHidden:!0},open:rt,onOpenChange:function(S){if(Ge(S),!S){var R;M(void 0),(R=ae.current)===null||R===void 0||R.resetFields()}},title:Z.format("yamlDrawerTitle"),formRef:ae,ref:Be,trigger:(0,o.jsx)(T.ZP,{type:"primary",icon:$.id?(0,o.jsx)(P.Z,{}):void 0,children:z.Ob.format($.id?"compose.list.edit":"compose.list.create")}),onFinish:function(){var w=C()(d()().mark(function S(R){var xe,ie,pe,h;return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(R.type!="remoteGit"){v.next=7;break}return(xe=Be.current)===null||xe===void 0||xe.loading(),v.next=4,(0,c.zN)({uri:R.remoteUrl,name:R.name}).finally(function(){var L;(L=Be.current)===null||L===void 0||L.finish()});case 4:return ie=v.sent,$.onFinish&&$.onFinish(ie.data.id),v.abrupt("return",!0);case 7:return v.prev=7,pe={id:$.id&&$.id.toString(),type:R.type,name:R.name,title:R.title,environment:R.environment,remoteUrl:R.remoteUrl,yaml:O==null?void 0:O.yaml,yamlOverride:O==null?void 0:O.override},v.next=11,(0,c.im)(pe);case 11:return h=v.sent,$.onFinish&&$.onFinish(h.data.id),v.abrupt("return",!0);case 16:return v.prev=16,v.t0=v.catch(7),v.abrupt("return",!1);case 19:case"end":return v.stop()}},S,null,[[7,16]])}));return function(S){return w.apply(this,arguments)}}(),children:[(0,o.jsx)(E.Z,{ghost:!0,children:(0,o.jsxs)(Oe.UW,{children:[(0,o.jsx)(f.Z,{label:Z.format("createFormName"),name:"name",width:"md",required:!0,disabled:!!$.id,rules:[{required:!0},{pattern:/^[a-zA-Z0-9_-]+$/,message:Z.format("createFormNameRule")}],placeholder:Z.format("createFormNameEmpty")}),(0,o.jsx)(f.Z,{label:Z.format("createFormTitle"),name:"title",width:"md"})]})},"createForm"),(0,o.jsx)(G.Z.Group,{label:Z.format("createFormType"),name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(){var S;(S=ae.current)===null||S===void 0||S.resetFields(["yaml","environment"])}},disabled:!!$.id,options:Z.option("createFormTypeOption",["text","remoteUrl","remoteGit","storagePath","store","outPath"]).map(function(w){return{label:w.label,value:w.value}})}),(0,o.jsx)(ne.Z,{name:["type"],children:function(S){var R=S.type;if(R=="text")return(0,o.jsxs)(q.Z,{gutter:[10,0],children:[(0,o.jsx)(I.Z,{span:12,children:(0,o.jsx)(D.Z,{title:Z.format("createFormTypeTextImportFile"),onImport:function(ie){return M(u()(u()({},O),{yaml:ie})),(0,Ue.m)(ie).map(function(pe){var h;(h=Ce.current)===null||h===void 0||h.addEnvItem(pe.name,pe.value)}),!0},onLoad:function(ie){if(ie.indexOf("services:")<0)throw new Error(z.FD.format("commonFileIncorrectFormat",{name:"yaml"}));return!0}},"importFile")}),(0,o.jsx)(I.Z,{span:12,children:(0,o.jsx)(ve,{title:Z.format("createFormTypeTextImportRemote"),onRequest:function(){var xe=C()(d()().mark(function ie(pe){var h;return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,(0,c.MG)({uri:pe});case 2:return h=v.sent,M(u()(u()({},O),{yaml:h.data.content})),(0,Ue.m)(h.data.content).map(function(L){var x;(x=Ce.current)===null||x===void 0||x.addEnvItem(L.name,L.value)}),v.abrupt("return");case 6:case"end":return v.stop()}},ie)}));return function(ie){return xe.apply(this,arguments)}}()},"importRemote")})]});if(R=="remoteUrl")return(0,o.jsx)(q.Z,{gutter:[10,0],children:(0,o.jsxs)(I.Z,{span:24,children:[(0,o.jsx)(se.Z,{shouldUpdate:!0,children:function(ie){return(0,o.jsx)(ve,{defaultUrl:ie.getFieldValue("remoteUrl"),title:Z.format("createFormTypeRemoteImportUrl"),onRequest:function(){var pe=C()(d()().mark(function h(Re){var v,L;return d()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.next=2,(0,c.MG)({uri:Re});case 2:return L=oe.sent,M(u()(u()({},O),{yaml:L.data.content})),(v=ae.current)===null||v===void 0||v.setFieldValue("remoteUrl",Re),(0,Ue.m)(L.data.content).map(function(De){var N;(N=Ce.current)===null||N===void 0||N.addEnvItem(De.name,De.value)}),oe.abrupt("return");case 7:case"end":return oe.stop()}},h)}));return function(h){return pe.apply(this,arguments)}}()},"importRemote1")}}),(0,o.jsx)(se.Z,{hidden:!0,name:"remoteUrl"},"remoteUrl")]})});if(R=="remoteGit")return(0,o.jsx)(f.Z,{name:"remoteUrl",label:Z.format("createFormTypeRemoteImportGit")},"importRemote2");if(R=="storagePath")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(f.Z,{name:"storagePath",required:!0,readonly:!0,initialValue:Z.format("createFormTypeStoragePathTip"),addonAfter:(0,o.jsx)("a",{href:"https://dpanel.cc/manual/compose-create",target:"_blank",children:z.FD.format("help")})})});if(R=="store")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(f.Z,{readonly:!0,name:"store",required:!0,initialValue:Z.format("createFormTypeStoreTip"),addonAfter:(0,o.jsx)(He.Link,{to:"/compose/appstore",children:z.Ob.format("compose.appstore")})})});if(R=="outPath")return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(f.Z,{name:"outPath",required:!0,readonly:!0,initialValue:Z.format("createFormTypeOutPathTip")})})}}),(0,o.jsx)(ne.Z,{name:["type"],children:function(S){var R=S.type;return(R=="text"||R=="remoteUrl"||$.id)&&(0,o.jsxs)(E.Z,{ghost:!0,direction:"row",children:[(0,o.jsxs)(E.Z,{ghost:!0,colSpan:"50%",children:[(0,o.jsx)(l.Z,{type:"warning",message:Z.format("createFormTypeTextTip"),style:{marginBottom:15}},"yamlTips"),(0,o.jsx)(l.Z,{message:(0,o.jsxs)(o.Fragment,{children:[Z.format("createEnvTip1")," ","${DB_NAME}",". ",Z.format("createEnvTip2")]})}),(0,o.jsx)(Ve.Z,{drawerProps:{ghost:!0,title:(0,o.jsx)(b.Z,{}),subTitle:Z.format("createEnvTitle")},name:"environment",showInDrawer:!0,showImportButton:!$.id,showAddButton:!0,showCodeMode:!$.id,ref:Ce})]}),(0,o.jsx)(E.Z,{colSpan:"50%",children:at})]},"yamlEditor")}})]},"yamlCreate")},tt=ke},91218:function(Ye,Ee,e){e.d(Ee,{Z:function(){return pe}});var Te=e(97857),d=e.n(Te),Fe=e(19632),C=e.n(Fe),K=e(15009),u=e.n(K),je=e(99289),F=e.n(je),Y=e(5574),V=e.n(Y),c=e(67294),z=e(3616),P=e(36146),b=e(38345),E=e(97269),Oe=e(86615),f=e(62370),G=e(90098),ne=e(27166),se=e(43425),H=e(33160),re=e(82061),ce=e(87784),_=e(74842),T=e(30159),we=e(25035),ue=e(95591),q=e(26522),I=e(33862),l=e(40056),i=e(42075),D=e(96074),n=e(25593),qe=e(86250),$e=e(84567),o=e(83062),Me=e(83622),ve=e(80821),Ve=e(82346),Ue=e(79697),et=e(99861),He=e(1699),ke=e(89035),tt=e(75544),t=e(85893),$=(0,c.forwardRef)(function(h,Re){(0,c.useImperativeHandle)(Re,function(){return{show:function(){return F()(u()().mark(function U(){var le;return u()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return N(!0),(le=L.current)===null||le===void 0||le.clear(),k.next=4,new Promise(function(Ne){return setTimeout(function(){var Le;(Le=L.current)===null||Le===void 0||Le.fit(),Ne(!0)},1e3)});case 4:case"end":return k.stop()}},U)}))()},close:function(){var U;N(!1),(U=L.current)===null||U===void 0||U.clear()},cancel:function(){return F()(u()().mark(function U(){var le;return u()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return(le=L.current)===null||le===void 0||le.clear(),v.progress.close("compose:"+h.id),k.abrupt("return",!0);case 3:case"end":return k.stop()}},U)}))()}}});var v=(0,Ve.useModel)("subscriber"),L=(0,c.useRef)(),x=(0,c.useState)(!1),oe=V()(x,2),De=oe[0],N=oe[1];return v.addDataHandler("compose:"+h.id,function(Q){var U;(U=L.current)===null||U===void 0||U.write(Q.data)}),(0,t.jsx)(b.Z,{hidden:!De,ghost:!0,title:(0,t.jsx)(ke.Z,{}),subTitle:"Console",extra:(0,t.jsx)(i.Z,{children:(0,t.jsx)(ve.Z,{action:F()(u()().mark(function Q(){var U;return u()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return(U=L.current)===null||U===void 0||U.clear(),v.progress.close("compose:"+h.id),he.abrupt("return");case 3:case"end":return he.stop()}},Q)})),buttonProps:{icon:(0,t.jsx)(re.Z,{}),danger:!0},children:P.FD.format("listManageKill")},"kill")}),children:(0,t.jsx)(tt.Z,{id:"create-log-".concat(h.id),height:"200px",style:{fontSize:12},ref:L})})}),Pe=$,Z=e(83002),Ae=e(60940),be=e(55241),ae=e(78451),Ce=e(37413),me=e(94359),fe=e(91806),O=e(60433),M=e(99611),nt=e(99922),Xe=e(3905),rt=e(87662),Ge=e(5251),Be=e(29463);function at(h){var Re=(0,c.useState)(""),v=V()(Re,2),L=v[0],x=v[1],oe=(0,c.useRef)(),De=(0,c.useRef)(),N=(0,c.useState)(),Q=V()(N,2),U=Q[0],le=Q[1],he=new P.Uo("components.appCompose"),k=(0,c.useRef)(),Ne=(0,c.useState)(),Le=V()(Ne,2),it=Le[0],Qe=Le[1],ot=(0,c.useState)(),ze=V()(ot,2),a=ze[0],We=ze[1];return(0,c.useEffect)(function(){return(0,rt.K3)().then(function(ee){var A;x((A=ee.data.serverUrl)!==null&&A!==void 0?A:"")}),le(!1),h.containerList&&Qe(h.containerList.filter(function(ee){return ee.status!=""}).map(function(ee){return ee.service})),We(h.containerList),function(){We([])}},[h.containerList]),(0,t.jsxs)(b.Z,{ghost:!0,title:(0,t.jsx)(fe.Z,{}),subTitle:he.format("detailContainerTitle"),extra:h.enableSelectService&&(0,t.jsx)($e.Z,{checked:U,onChange:function(A){le(A.target.checked)},children:he.format("selectService")},"selectService"),children:[(0,t.jsx)(nt.Z,{showFileExplorer:!0,ref:oe}),(0,t.jsx)(Be.Z,{ref:k}),(0,t.jsx)(Xe.Z,{ref:De}),(0,t.jsx)(Ae.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:P.FD.format("listName"),dataIndex:"name",width:200,render:function(A,g,ge){return(0,t.jsx)(o.Z,{title:g.service,children:(0,t.jsx)(ae.Z,{content:g.name?(0,Ge.fi)(g.name,"/"):g.service})})}},{title:P.FD.format("listPort"),render:function(A,g,ge){var B=[],X=[];return g.publishers&&g.publishers.map(function(de){de.publishedPort?B.push({PrivatePort:de.targetPort,Type:de.protocol,IP:de.url,PublicPort:de.publishedPort}):de.publishedPort&&X.push({PrivatePort:de.targetPort,Type:de.protocol,IP:de.url,PublicPort:de.publishedPort})}),(0,t.jsx)(Ce.Z,{publicPort:B,privatePort:X,domain:[],serverIp:L})}},{title:P.FD.format("listStatus"),render:function(A,g,ge){return(0,t.jsx)(me.Z,{status:"container.".concat(g.state),tip:"".concat(g.state," ").concat(g.status)},g.name)}},{title:P.FD.format("listManage"),fixed:"right",render:function(A,g,ge){return(0,t.jsxs)(i.Z,{split:(0,t.jsx)(D.Z,{type:"vertical"}),children:[g.name==""&&(0,t.jsx)(be.Z,{placement:"left",content:(0,t.jsx)(b.Z,{ghost:!0,title:P.FD.format("listManageShowContainerEnv"),children:(0,t.jsx)(i.Z,{direction:"vertical",children:g.environment&&Object.keys(g.environment).map(function(B){if(g.environment&&g.environment[B])return(0,t.jsx)(n.Z.Text,{code:!0,children:"".concat(B,"=").concat(g.environment[B])},B)})})}),children:(0,t.jsx)(O.Z,{})}),g.name!=""&&(0,t.jsx)(n.Z.Link,{onClick:function(){var X;(X=De.current)===null||X===void 0||X.show(g.name)},children:(0,t.jsx)(M.Z,{})},"container"),g.state=="running"&&(0,t.jsx)(n.Z.Link,{onClick:function(){var X;(X=oe.current)===null||X===void 0||X.show({url:"/console/container/".concat((0,Ge.fi)(g.name,"/")),title:g.name})},children:(0,t.jsx)(ke.Z,{})},"console"),g.state=="running"&&(0,t.jsx)(n.Z.Link,{onClick:function(){var X;(X=k.current)===null||X===void 0||X.showContainer((0,Ge.fi)(g.name,"/"))},children:(0,t.jsx)(ue.Z,{})},"file")]})}}],dataSource:a,rowSelection:U&&a?{selectedRowKeys:it,onChange:function(A,g,ge){Qe(A),h.selectServiceFinish&&h.selectServiceFinish(A)}}:void 0})]})}var w=e(91058),S=e(82848),R=e(2831),xe=e(36588),ie=(0,c.forwardRef)(function(h,Re){var v,L=(0,Ve.useAccess)(),x=new P.Uo("components.appCompose"),oe=(0,c.useState)(0),De=V()(oe,2),N=De[0],Q=De[1],U=(0,c.useState)(!1),le=V()(U,2),he=le[0],k=le[1],Ne=(0,c.useState)(!1),Le=V()(Ne,2),it=Le[0],Qe=Le[1],ot=(0,c.useState)(),ze=V()(ot,2),a=ze[0],We=ze[1],ee=(0,c.useRef)(),A=(0,c.useRef)(),g=(0,c.useRef)(),ge=(0,c.useRef)(),B=(0,c.useRef)(),X=(0,c.useRef)(),de=(0,c.useRef)(),ct=(0,c.useRef)(),ft=(0,c.useState)(),mt=V()(ft,2),Je=mt[0],lt=mt[1];(0,c.useImperativeHandle)(Re,function(){return{show:function(r){return F()(u()().mark(function s(){return u()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:lt(r),k(!0);case 2:case"end":return j.stop()}},s)}))()}}}),(0,c.useEffect)(function(){Je&&(Qe(!0),(0,G.Pn)({id:Je}).finally(F()(u()().mark(function m(){return u()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:Qe(!1);case 1:case"end":return s.stop()}},m)}))).then(function(m){var r=m.data.detail;r.setting.status&&r.setting.status.includes("running")&&(r.isRunning=!0),r.setting.status&&r.setting.status.includes("paused")&&(r.isPaused=!0),r.setting.status&&r.setting.status.includes("exited")&&(r.isExited=!0),r.setting.status&&r.setting.status.includes("waiting")?r.isDeploy=!1:r.isDeploy=!0,r.setting.status&&r.setting.status.includes("created")&&(r.isCreated=!0,r.isDeploy=!1);var s=m.data.project;if(s&&s.services&&(r.imageList=C()(new Set(Object.keys(s.services).map(function(J){var y;return(y=s.services[J].image)!==null&&y!==void 0?y:""}).filter(function(J){return J!=""})))),r.containerList=m.data.containerList,r.containerList||(r.containerList=[]),s!=null&&s.services&&Object.entries(s==null?void 0:s.services).forEach(function(J){var y,Se=V()(J,2),Ze=Se[0],ye=Se[1],Ke=r.containerList.find(function(W){return W.service==Ze});Ke||r.containerList.push({project:(y=s.name)!==null&&y!==void 0?y:"",name:"",service:Ze,publishers:ye.ports?ye.ports.map(function(W){var Ie;return{url:"",targetPort:W.target,publishedPort:parseInt(W.published),protocol:(Ie=W.protocol)!==null&&Ie!==void 0?Ie:""}}):[],state:"waiting",status:"",environment:ye.environment})}),r.containerList){var p;(p=g.current)===null||p===void 0||p.setFieldValue("deployServiceName",m.data.detail.setting.deployServiceName)}if(We(d()(d()({},m.data),{detail:r})),m.data.detail.setting.environment){var j;(j=g.current)===null||j===void 0||j.setFieldValue("environment",m.data.detail.setting.environment)}}))},[N,Je]);function vt(m){return st.apply(this,arguments)}function st(){return st=F()(u()().mark(function m(r){var s,p,j;return u()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if((s=B.current)===null||s===void 0||s.show(),!r.pullImageUseDPanel){y.next=5;break}return y.next=4,(p=ee.current)===null||p===void 0?void 0:p.start();case 4:(j=ee.current)===null||j===void 0||j.finish();case 5:return y.prev=5,y.next=8,(0,G.Oh)(r);case 8:h.onDeployFinish&&h.onDeployFinish(),y.next=14;break;case 11:y.prev=11,y.t0=y.catch(5),h.onDeployFailed&&h.onDeployFailed();case 14:Q(N+1);case 15:case"end":return y.stop()}},m,null,[[5,11]])})),st.apply(this,arguments)}return(0,t.jsxs)(ne.Z,{drawerProps:{width:z.R_,destroyOnHidden:!0},requestLoading:it,title:a?x.format("drawerTitle",{name:(v=a==null?void 0:a.detail.name)!==null&&v!==void 0?v:""}):x.format("createTitle"),open:he,onOpenChange:function(r){r||(lt(void 0),We(void 0),h.onClose&&h.onClose()),k(r)},submitter:!1,formRef:g,children:[a&&!(0,Ue.Z)(a.detail.imageList)&&(0,t.jsx)(et.Z,{ref:ee,image:a.detail.imageList}),(0,t.jsx)(Be.Z,{ref:de}),(0,t.jsxs)(b.Z,{direction:"column",ghost:!0,gutter:[0,10],children:[a&&a.detail.setting.type=="dangling"&&(0,t.jsx)(l.Z,{type:"warning",showIcon:!0,description:(0,t.jsxs)("div",{children:[x.format("managerStatusDanglingAlert",{name:a.detail.name})," ",(0,t.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-outpath",target:"_blank",children:P.FD.format("help")})]})}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(b.Z,{title:(0,t.jsx)(se.Z,{}),subTitle:x.format("managerContainerTitle"),ghost:!0,children:(0,t.jsxs)(i.Z,{wrap:!0,split:(0,t.jsx)(D.Z,{type:"vertical"}),children:[(0,t.jsxs)(He.u,{access:"canSeeComposeListManage",space:{},children:[(0,t.jsx)(ve.Z,{buttonProps:{icon:(0,t.jsx)(H.Z,{}),type:"primary"},confirmProps:{onOpenChange:function(r,s){var p;r&&(!((p=A.current)===null||p===void 0)&&p.resetFields)&&A.current.resetFields()},description:(0,t.jsxs)(i.Z,{style:{minWidth:300},direction:"vertical",wrap:!0,children:[(0,t.jsx)(n.Z.Text,{children:x.format("managerCreateTip")}),(0,t.jsx)(E.A,{name:"createForm",formRef:A,layout:"inline",submitter:!1,children:(0,t.jsxs)(qe.Z,{vertical:!0,children:[(0,t.jsx)(Oe.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},options:x.option("managerCreatePullImageUseOption",["useCommand","useDPanel"])}),(0,t.jsx)(f.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:x.format("managerCreateCreatePath")})}),(0,t.jsx)(f.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,t.jsx)($e.Z,{defaultChecked:!0,children:x.format("managerCreateRemoveOrphans")})})]})})]})},action:F()(u()().mark(function m(){var r,s,p,j,J,y,Se,Ze,ye,Ke,W,Ie,_e;return u()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.prev=0,te.next=3,(ye=g.current)===null||ye===void 0?void 0:ye.validateFields();case 3:te.next=8;break;case 5:return te.prev=5,te.t0=te.catch(0),te.abrupt("return");case 8:return Ke=a?a.detail.id||a.detail.name:(r=g.current)===null||r===void 0?void 0:r.getFieldValue("name"),W={id:Ke,createPath:(s=(p=A.current)===null||p===void 0?void 0:p.getFieldValue("createPath"))!==null&&s!==void 0?s:!1,removeOrphans:(j=(J=A.current)===null||J===void 0?void 0:J.getFieldValue("removeOrphans"))!==null&&j!==void 0?j:!0},((y=A.current)===null||y===void 0?void 0:y.getFieldValue("pullImageUse"))=="useDPanel"&&(W.pullImage=!1,W.pullImageUseDPanel=!0),((Se=A.current)===null||Se===void 0?void 0:Se.getFieldValue("pullImageUse"))=="useCommand"&&(W.pullImage=!0),Ie=((Ze=g.current)===null||Ze===void 0?void 0:Ze.getFieldsFormatValue)&&g.current.getFieldsFormatValue(!0),W.environment=Ie.environment,W.deployServiceName=Ie.deployServiceName,te.next=17,(0,G.im)({id:(a.detail.id||a.detail.name).toString(),name:a.detail.name,environment:Ie.environment,type:a.detail.setting.type});case 17:if(!(a!=null&&a.detail.isDeploy&&W.deployServiceName)){te.next=23;break}if(_e=[],a.detail.containerList.forEach(function(ut){var dt;ut.status!=""&&!((dt=W.deployServiceName)!==null&&dt!==void 0&&dt.includes(ut.service))&&_e.push(ut.service)}),(0,Ue.Z)(_e)){te.next=23;break}return te.next=23,(0,G.j6)({id:Ke,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1,destroyServiceName:_e});case 23:return te.abrupt("return",vt(W));case 24:case"end":return te.stop()}},m,null,[[0,5]])})),children:x.format(a!=null&&a.detail.isDeploy?"managerUpgradeButton":"managerCreateButton")},"deploy"),(a.detail.isDeploy||a.detail.isCreated)&&(0,t.jsx)(ve.Z,{action:function(){var r;return(r=B.current)===null||r===void 0||r.show(),(0,G.j6)({id:a.detail.id||a.detail.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){Q(N+1)},buttonProps:{type:"primary",danger:!0,icon:(0,t.jsx)(re.Z,{})},confirmProps:{showCommonConfirm:!0},children:x.format("managerDeleteContainerButton")},"destroyContainer")]}),a.detail.isDeploy&&(0,t.jsxs)(He.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,t.jsx)(ve.Z,{buttonProps:{icon:(0,t.jsx)(H.Z,{})},action:F()(u()().mark(function m(){var r;return u()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return(r=B.current)===null||r===void 0||r.show(),p.abrupt("return",(0,G.GG)({id:a.detail.id||a.detail.name,op:"restart"}));case 2:case"end":return p.stop()}},m)})),onSuccess:function(){Q(N+1)},children:x.format("managerRestartButton")},"restart"),(0,t.jsx)(ve.Z,{action:function(){var r;return(r=B.current)===null||r===void 0||r.show(),(0,G.GG)({id:a.detail.id||a.detail.name,op:"stop"})},buttonProps:{icon:(0,t.jsx)(ce.Z,{}),disabled:a.detail.isExited},onSuccess:function(){Q(N+1)},children:x.format("managerStopButton")},"stop"),a.detail.isPaused&&(0,t.jsx)(ve.Z,{action:function(){var r;return(r=B.current)===null||r===void 0||r.show(),(0,G.GG)({id:a.detail.id||a.detail.name,op:"unpause"})},onSuccess:function(){Q(N+1)},buttonProps:{icon:(0,t.jsx)(_.Z,{})},children:x.format("managerUnpauseButton")},"unpause"),!a.detail.isPaused&&(0,t.jsx)(ve.Z,{action:function(){var r;return(r=B.current)===null||r===void 0||r.show(),(0,G.GG)({id:a.detail.id||a.detail.name,op:"pause"})},onSuccess:function(){Q(N+1)},buttonProps:{icon:(0,t.jsx)(T.Z,{}),disabled:!a.detail.isRunning},children:x.format("managerPauseButton")},"pause"),a.detail.isDeploy&&(0,t.jsx)(Z.Z,{composeItem:a.detail,showTriggerButton:!0},"composeLog")]}),a.detail.id>0&&L.canSeeComposeListManageDelete&&(0,t.jsx)(ve.Z,{buttonProps:{type:"dashed",danger:!0,icon:(0,t.jsx)(re.Z,{})},confirmProps:{onOpenChange:function(r,s){var p;!((p=ge.current)===null||p===void 0)&&p.resetFields&&ge.current.resetFields()},description:(0,t.jsxs)(i.Z,{style:{width:280},direction:"vertical",children:[(0,t.jsx)(n.Z.Text,{children:x.format("managerDeleteTaskTip")}),(0,t.jsxs)(E.A,{formRef:ge,layout:"inline",submitter:!1,children:[(0,t.jsx)(f.Z,{initialValue:!0,name:"deleteImage",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:x.format("managerDeleteTaskDeleteImage")})}),(0,t.jsx)(f.Z,{addonAfter:(0,t.jsx)(o.Z,{title:x.format("managerDeleteTaskDeleteVolumeTip"),children:(0,t.jsx)(we.Z,{})}),initialValue:!0,name:"deleteVolume",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:x.format("managerDeleteTaskDeleteVolume")})}),(0,t.jsx)(f.Z,{initialValue:!0,name:"deletePath",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:x.format("managerDeleteTaskDeletePath")})})]})]})},action:F()(u()().mark(function m(){var r,s,p,j,J,y,Se,Ze,ye;return u()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return(r=B.current)===null||r===void 0||r.show(),W.next=3,(0,G.j6)({id:(s=(p=a.detail)===null||p===void 0?void 0:p.id)!==null&&s!==void 0?s:a.detail.name,deleteImage:(j=(J=ge.current)===null||J===void 0?void 0:J.getFieldValue("deleteImage"))!==null&&j!==void 0?j:!1,deleteVolume:(y=(Se=ge.current)===null||Se===void 0?void 0:Se.getFieldValue("deleteVolume"))!==null&&y!==void 0?y:!1,deletePath:(Ze=(ye=ge.current)===null||ye===void 0?void 0:ye.getFieldValue("deletePath"))!==null&&Ze!==void 0?Ze:!1,deleteData:!0});case 3:k(!1),We(void 0),h.onClose&&h.onClose();case 6:case"end":return W.stop()}},m)})),children:P.FD.format("listManageDelete")},"deleteTask"),h.showBackListButton&&(0,t.jsx)(Ve.Link,{to:"/compose/list",children:(0,t.jsx)(Me.ZP,{children:P.Ob.format("compose.list")})})]})},"operator"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(b.Z,{title:(0,t.jsx)(se.Z,{}),subTitle:x.format("managerTitle"),ghost:!0,children:(0,t.jsxs)(i.Z,{children:[L.canSeeComposeListManage&&(0,t.jsx)(S.Z,{id:Je,onFinish:function(){var m=F()(u()().mark(function r(s){return u()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:lt(s),Q(N+1);case 2:case"end":return j.stop()}},r)}));return function(r){return m.apply(this,arguments)}}()}),L.canSeeComposeListManageCreate&&(a==null?void 0:a.detail.setting.type)!="outPath"&&(0,t.jsx)(Me.ZP,{icon:(0,t.jsx)(ue.Z,{}),onClick:F()(u()().mark(function m(){var r,s,p,j;return u()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,R.aF)();case 2:s=y.sent,s.data&&(r=s.data.dpanel.containerInfo)!==null&&r!==void 0&&r.Name&&((p=de.current)===null||p===void 0||p.showContainer((j=s.data.dpanel.containerInfo)===null||j===void 0?void 0:j.Name,"/dpanel/compose/".concat(a==null?void 0:a.detail.name)));case 4:case"end":return y.stop()}},m)})),children:P.FD.format("listManageFilePath")}),(0,t.jsx)(D.Z,{type:"vertical"}),function(m){var r="";if((m=a.project)!==null&&m!==void 0&&m.networks){var s=Object.entries(a.project.networks).find(function(p){var j=V()(p,2),J=j[0],y=j[1];return y.external});s&&(r=s[1].name)}return r!=""&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(xe.Z,{ref:ct},"network-create"),(0,t.jsx)(Me.ZP,{onClick:function(){var j;(j=ct.current)===null||j===void 0||j.show(r)},icon:(0,t.jsx)(q.Z,{}),children:x.format("joinContainerInNetwork")},"network")]})}(),(0,t.jsx)(Me.ZP,{icon:(0,t.jsx)(H.Z,{}),onClick:function(){var r;(r=B.current)===null||r===void 0||r.close(),Q(N+1)},children:P.FD.format("listManageRefresh")})]})},"manager"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(Pe,{ref:B,id:(a==null?void 0:a.detail.id)||(a==null?void 0:a.detail.name)}),a&&a.containerList&&(0,t.jsx)(at,{containerList:a==null?void 0:a.containerList,enableSelectService:(a==null?void 0:a.detail.setting.type)!="dangling",selectServiceFinish:function(r){var s;(s=g.current)===null||s===void 0||s.setFieldValue("deployServiceName",r)}}),(0,t.jsx)(f.Z,{name:"deployServiceName",hidden:!0}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(w.Z,{drawerProps:{ghost:!0,title:(0,t.jsx)(I.Z,{}),subTitle:"".concat(x.format("createEnvTitle"))},showDisableName:!0,showDeleteButton:!1,name:"environment",ref:X})]})]})}),pe=ie},75544:function(Ye,Ee,e){var Te=e(5574),d=e.n(Te),Fe=e(12323),C=e(78267),K=e.n(C),u=e(75458),je=e.n(u),F=e(67294),Y=e(4244),V=e.n(Y),c=e(24078),z=e(85893),P,b,E,Oe=(0,F.forwardRef)(function(f,G){var ne,se=(0,F.useState)(!0),H=d()(se,2),re=H[0],ce=H[1];return(0,F.useEffect)(function(){return P=new Y.Terminal(Fe.X),b=new u.SearchAddon,E=new C.FitAddon,window.addEventListener("resize",function(){f.showInModal||E.fit()}),f.style&&f.style.fontSize&&(P.options.fontSize=f.style.fontSize),P.loadAddon(E),P.loadAddon(b),P.open(document.getElementById(f.id?f.id:"terminal-container")),f.showInModal||E.fit(),function(){P.reset(),ce(!0)}},[]),(0,F.useImperativeHandle)(G,function(){return{write:function(T){re&&(E.fit(),ce(!1)),P.write(T)},clear:function(){P.clear()},getTerminal:function(){return P},findNext:function(T){b.findNext(T)},findPrev:function(T){b.findPrevious(T)},fit:function(){E.fit()},onData:function(T){return P.onData(T)}}}),(0,z.jsx)("div",{id:f.id?f.id:"terminal-container",style:{width:f.width?f.width:"100%",height:f.height?f.height:"500px",marginTop:(ne=f.style)===null||ne===void 0?void 0:ne.marginTop}})});Ee.Z=Oe},90098:function(Ye,Ee,e){e.d(Ee,{GG:function(){return Oe},MG:function(){return re},Oh:function(){return z},Pn:function(){return V},Yz:function(){return G},iE:function(){return we},im:function(){return u},j6:function(){return b},pm:function(){return F},tw:function(){return q},vf:function(){return se},zN:function(){return _}});var Te=e(15009),d=e.n(Te),Fe=e(99289),C=e.n(Fe),K=e(82346);function u(l){return je.apply(this,arguments)}function je(){return je=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/create",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),je.apply(this,arguments)}function F(l){return Y.apply(this,arguments)}function Y(){return Y=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-list",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),Y.apply(this,arguments)}function V(l){return c.apply(this,arguments)}function c(){return c=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-task",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),c.apply(this,arguments)}function z(l){return P.apply(this,arguments)}function P(){return P=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-deploy",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),P.apply(this,arguments)}function b(l){return E.apply(this,arguments)}function E(){return E=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-destroy",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),E.apply(this,arguments)}function Oe(l){return f.apply(this,arguments)}function f(){return f=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-ctrl",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),f.apply(this,arguments)}function G(l){return ne.apply(this,arguments)}function ne(){return ne=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/container-log",{method:"POST",data:i}));case 2:case"end":return n.stop()}},l)})),ne.apply(this,arguments)}function se(l){return H.apply(this,arguments)}function H(){return H=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.download=!0,i.id=String(i.id),n.next=4,(0,K.request)("/dpanel/api/app/compose/container-log",{method:"POST",data:i,responseType:"blob"});case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},l)})),H.apply(this,arguments)}function re(l){return ce.apply(this,arguments)}function ce(){return ce=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-from-uri",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),ce.apply(this,arguments)}function _(l){return T.apply(this,arguments)}function T(){return T=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/get-from-git",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),T.apply(this,arguments)}function we(l){return ue.apply(this,arguments)}function ue(){return ue=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,K.request)("/dpanel/api/common/store/deploy",{method:"POST",data:i}));case 1:case"end":return n.stop()}},l)})),ue.apply(this,arguments)}function q(l){return I.apply(this,arguments)}function I(){return I=C()(d()().mark(function l(i){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i.id=String(i.id),n.abrupt("return",(0,K.request)("/dpanel/api/app/compose/download",{method:"POST",data:i,responseType:"blob"}));case 2:case"end":return n.stop()}},l)})),I.apply(this,arguments)}}}]);
