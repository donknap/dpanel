"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{91806:function(X,y,e){e.d(y,{Z:function(){return g}});var K=e(87462),o=e(67294),$={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},C=$,G=e(84089),Z=function(S,W){return o.createElement(G.Z,(0,K.Z)({},S,{ref:W,icon:C}))},T=o.forwardRef(Z),g=T},33862:function(X,y,e){e.d(y,{Z:function(){return g}});var K=e(87462),o=e(67294),$={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 289.1a362.49 362.49 0 00-79.9-115.7 370.83 370.83 0 00-118.2-77.8C610.7 76.6 562.1 67 512 67c-50.1 0-98.7 9.6-144.5 28.5-44.3 18.3-84 44.5-118.2 77.8A363.6 363.6 0 00169.4 289c-19.5 45-29.4 92.8-29.4 142 0 70.6 16.9 140.9 50.1 208.7 26.7 54.5 64 107.6 111 158.1 80.3 86.2 164.5 138.9 188.4 153a43.9 43.9 0 0022.4 6.1c7.8 0 15.5-2 22.4-6.1 23.9-14.1 108.1-66.8 188.4-153 47-50.4 84.3-103.6 111-158.1C867.1 572 884 501.8 884 431.1c0-49.2-9.9-97-29.4-142zM512 880.2c-65.9-41.9-300-207.8-300-449.1 0-77.9 31.1-151.1 87.6-206.3C356.3 169.5 431.7 139 512 139s155.7 30.5 212.4 85.9C780.9 280 812 353.2 812 431.1c0 241.3-234.1 407.2-300 449.1zm0-617.2c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 551c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 439c0-29.9 11.7-58 32.8-79.2C454 338.6 482.1 327 512 327c29.9 0 58 11.6 79.2 32.8C612.4 381 624 409.1 624 439c0 29.9-11.6 58-32.8 79.2z"}}]},name:"environment",theme:"outlined"},C=$,G=e(84089),Z=function(S,W){return o.createElement(G.Z,(0,K.Z)({},S,{ref:W,icon:C}))},T=o.forwardRef(Z),g=T},36435:function(X,y,e){var K=e(15009),o=e.n(K),$=e(64599),C=e.n($),G=e(99289),Z=e.n(G),T=e(9783),g=e.n(T),N=e(5574),S=e.n(N),W=e(67294),de=e(184),q=e(38345),ce=e(97269),ee=e(97321),ne=e(97462),te=e(64317),me=e(5966),ae=e(86615),F=e(68602),re=e(83622),U=e(83403),Q=e(24963),fe=e(1699),B=e(29177),pe=e(1883),w=e(43425),Ee=e(44349),ve=e(3616),V=e(36146),D=e(85893),Pe=(0,W.forwardRef)(function(_,z){var se=(0,W.useState)(!1),De=S()(se,2),H=De[0],k=De[1],b=(0,W.useRef)(),oe=(0,W.useContext)(Q.Z),he=oe.message,Me=(0,W.useState)([]),I=S()(Me,2),Y=I[0],ie=I[1],R=new V.Uo("components.permissionButton"),le=g()(g()(g()(g()(g()({},U.W6.CONTAINER,"Id"),U.W6.APPSTORE,"name"),U.W6.COMPOSE,"name"),U.W6.REGISTRY,"serverAddress"),U.W6.DOCKER_ENV,"name"),r=g()(g()(g()(g()(g()({},U.W6.CONTAINER,"name"),U.W6.APPSTORE,"name"),U.W6.COMPOSE,"name"),U.W6.REGISTRY,"title"),U.W6.DOCKER_ENV,"title"),_e=le[_.type],ue=r[_.type],x=_.selected.map(function(c){return c[le[_.type]]});return W.useEffect(function(){if(H){if(!_.selected||_.selected.length==0){he.error(V.FD.format("title.noDataSelect")),k(!1);return}(0,F.dP)({permission:{uri:_.type,key:_e,value:x}}).then(function(c){var u;(u=b.current)===null||u===void 0||u.setFieldValue("list",Object.keys(c.data.list).map(function(f){return{name:f,type:c.data.list[f].type,users:c.data.list[f].users}}))}),(0,F.lE)().then(function(c){var u,f=(u=c.data)===null||u===void 0||(u=u.list)===null||u===void 0?void 0:u.map(function(p){return{label:p.username,value:p.username}});ie(f)})}},[H]),(0,D.jsx)(fe.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,D.jsxs)(de.a,{name:"create",title:R.format("drawerTitle"),open:H,onOpenChange:function(u){if(!u){var f;(f=b.current)===null||f===void 0||f.resetFields()}k(u)},drawerProps:{forceRender:!0,width:ve.R_},formRef:b,trigger:(0,D.jsx)(re.ZP,{icon:(0,D.jsx)(B.Z,{}),children:R.format("drawerTriggerButton")}),onFinish:function(){var c=Z()(o()().mark(function u(f){var p,h,P;return o()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:p=C()(f.list),M.prev=1,p.s();case 3:if((h=p.n()).done){M.next=9;break}return P=h.value,M.next=7,(0,F.Db)({usernames:P.users,permissionType:P.type,permission:{uri:_.type,key:_e,showKey:ue,value:[P.name]}});case 7:M.next=3;break;case 9:M.next=14;break;case 11:M.prev=11,M.t0=M.catch(1),p.e(M.t0);case 14:return M.prev=14,p.f(),M.finish(14);case 17:he.success(V.FD.format("finish")),k(!1),_.onSuccess();case 20:case"end":return M.stop()}},u,null,[[1,11,14,17]])}));return function(u){return c.apply(this,arguments)}}(),children:[(0,D.jsxs)(q.Z,{ghost:!0,title:(0,D.jsx)(pe.Z,{}),subTitle:R.format("batchTitle"),children:[(0,D.jsx)(ce.A.Item,{name:"type",style:{marginBottom:0},children:(0,D.jsx)(ee.Z.Group,{defaultValue:"admin",onChange:function(u){var f,p,h=(f=b.current)===null||f===void 0?void 0:f.getFieldValue("list");h.forEach(function(P){P.type=u,P.users=[]}),(p=b.current)===null||p===void 0||p.setFieldValue("list",h)},children:["admin","restricted","public"].map(function(c){return(0,D.jsx)(ee.Z,{style:{width:240},title:R.format("dataTypeOption.".concat(c)),description:R.format("dataTypeDescOption.".concat(c)),value:c},c)})})}),(0,D.jsx)(ne.Z,{name:["type"],children:function(u){var f=u.type;if(f==="restricted")return(0,D.jsx)(te.Z,{mode:"multiple",name:"usernames",label:R.format("formUsernames"),onChange:function(h){var P,A,M=(P=b.current)===null||P===void 0?void 0:P.getFieldValue("list");M.forEach(function(L){L.users=h}),(A=b.current)===null||A===void 0||A.setFieldValue("list",M)},rules:[{required:!0}],request:Z()(o()().mark(function p(){var h,P,A;return o()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(!(Y.length>0)){L.next=2;break}return L.abrupt("return",Y);case 2:return L.next=4,(0,F.lE)();case 4:return P=L.sent,A=(h=P.data)===null||h===void 0||(h=h.list)===null||h===void 0?void 0:h.map(function(J){return{label:J.username,value:J.username}}),ie(A),L.abrupt("return",A);case 8:case"end":return L.stop()}},p)}))})}})]}),(0,D.jsx)(q.Z,{ghost:!0,title:(0,D.jsx)(w.Z,{}),subTitle:R.format("dataTitle"),children:(0,D.jsx)(Ee.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:R.format("dataName"),render:function(u,f,p){var h=p.getCurrentRowData();return(0,D.jsx)(me.Z,{disabled:!0,label:R.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:R.format("dataType"),render:function(u,f,p){var h=p.getCurrentRowData();return(0,D.jsx)(ae.Z.Group,{label:R.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(P){return{label:R.format("dataTypeOption.".concat(P)),value:P}})})}},{name:"users",label:R.format("dataUsers"),render:function(u,f,p){return(0,D.jsx)(ne.Z,{name:["type"],children:function(P){var A=P.type;if(A=="restricted")return(0,D.jsx)(te.Z,{width:"sm",mode:"tags",name:"users",label:R.format("dataUsers"),options:Y})}})}}]})})]})})});y.Z=Pe},96781:function(X,y,e){var K=e(67294),o=(0,K.createContext)({});y.Z=o},92922:function(X,y,e){e.r(y),e.d(y,{default:function(){return _e}});var K=e(15009),o=e.n(K),$=e(99289),C=e.n($),G=e(5574),Z=e.n(G),T=e(90098),g=e(33160),N=e(87784),S=e(30159),W=e(74842),de=e(99611),q=e(1883),ce=e(95591),ee=e(23430),ne=e(82061),te=e(43425),me=e(74453),ae=e(82346),F=e(83062),re=e(25593),U=e(66309),Q=e(42075),fe=e(96074),B=e(67294),pe=e(94359),w=e(67255),Ee=e(96781),ve=e(91218),V=e(1699),D=e(83403),Pe=e(36435),_=e(36146),z=e(55375),se=e(96486),De=e.n(se),H=e(37413),k=e(87662),b=e(5251),oe=e(93162),he=e.n(oe),Me=e(82848),I=e(98510),Y=e(80821),ie=e(83002),R=e(29463),le=e(2831),r=e(85893);function _e(){var ue=(0,B.useContext)(Ee.Z),x=ue.listTableRef,c=ue.reload,u=(0,B.useRef)(),f=(0,ae.useAccess)(),p=(0,ae.useLocation)(),h=new _.Uo("compose"),P=(0,B.useState)(""),A=Z()(P,2),M=A[0],L=A[1],J=(0,B.useRef)(),Oe=(0,B.useRef)();return(0,B.useEffect)(function(){(0,k.K3)().then(function(E){var l;L((l=E.data.serverUrl)!==null&&l!==void 0?l:"")})},[]),(0,B.useEffect)(function(){var E;p.state&&!((E=x.current)===null||E===void 0)&&E.setPageInfo&&x.current.setPageInfo({current:(0,w.G$)(z.q9,x.current.pageInfo)})},[p.state,x.current]),(0,r.jsxs)(me._z,{header:{extra:[(0,r.jsx)(V.u,{access:"canSeeComposeListManageCreate",children:(0,r.jsx)(Me.Z,{onFinish:function(l){var n,d;!((n=u.current)===null||n===void 0)&&n.show&&((d=u.current)===null||d===void 0||d.show(l)),c()}})},"create")]},children:[(0,r.jsx)(ie.Z,{ref:J},"composeLog"),(0,r.jsx)(ve.Z,{ref:u,onClose:function(){c()}}),(0,r.jsx)(R.Z,{ref:Oe}),(0,r.jsx)(I.C,{tableKey:z.q9,contextMenu:function(l){var n=l.selectedRows,d=l.finish,O=l.loading;return{items:[{type:"group",label:_.FD.format("listManageManage"),key:"manage",children:[{access:"canSeeComposeList",label:(0,r.jsx)(I.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(g.Z,{})},action:C()(o()().mark(function i(){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return O(),t.abrupt("return",Promise.all(n.map(function(s){return(0,T.GG)({id:s.id||s.name,op:"restart"})})).finally(function(){d(!0)}));case 2:case"end":return t.stop()}},i)})),children:_.FD.format("listManageRestart")}),key:"restart"},{label:(0,r.jsx)(I.C.ContextMenuItem,{action:C()(o()().mark(function i(){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return O(),t.abrupt("return",Promise.all(n.map(function(s){return(0,T.GG)({id:s.id||s.name,op:"stop"})})).finally(function(){d(!0)}));case 2:case"end":return t.stop()}},i)})),buttonProps:{icon:(0,r.jsx)(N.Z,{})},children:_.FD.format("listManageStop")}),key:"stop"},{label:(0,r.jsx)(I.C.ContextMenuItem,{action:C()(o()().mark(function i(){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return O(),t.abrupt("return",Promise.all(n.map(function(s){return(0,T.GG)({id:s.id||s.name,op:"pause"})})).finally(function(){d(!0)}));case 2:case"end":return t.stop()}},i)})),buttonProps:{icon:(0,r.jsx)(S.Z,{})},children:_.FD.format("listManagePause")}),key:"pause"},{label:(0,r.jsx)(I.C.ContextMenuItem,{action:C()(o()().mark(function i(){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return O(),t.abrupt("return",Promise.all(n.map(function(s){return(0,T.GG)({id:s.id||s.name,op:"unpause"})})).finally(function(){d(!0)}));case 2:case"end":return t.stop()}},i)})),buttonProps:{icon:(0,r.jsx)(W.Z,{})},children:_.FD.format("listManageUnpause")}),key:"unpause"}]},{type:"group",label:_.FD.format("listManage"),key:"operator",children:[{label:(0,r.jsx)(I.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(de.Z,{}),disabled:n.length>1},action:C()(o()().mark(function i(){var a,t;return o()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d(!0),n!=null&&n[0]&&((a=u.current)===null||a===void 0||a.show((t=n[0].id)!==null&&t!==void 0?t:n[0].name));case 2:case"end":return v.stop()}},i)})),children:_.FD.format("listManageView")}),key:"view"},{label:(0,r.jsx)(I.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(q.Z,{}),disabled:n.length>1},action:C()(o()().mark(function i(){var a,t;return o()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(t=n==null?void 0:n[0],t){v.next=3;break}return v.abrupt("return");case 3:(a=J.current)===null||a===void 0||a.show(t),d(!0);case 5:case"end":return v.stop()}},i)})),children:_.FD.format("listManageLog")}),key:"log"},{label:(0,r.jsx)(I.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(ce.Z,{}),disabled:n.length>1},action:C()(o()().mark(function i(){var a,t,s,v,m;return o()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(t=n==null?void 0:n[0],t){j.next=3;break}return j.abrupt("return");case 3:return j.next=5,(0,le.aF)();case 5:s=j.sent,s.data&&(a=s.data.dpanel.containerInfo)!==null&&a!==void 0&&a.Name&&((v=Oe.current)===null||v===void 0||v.showContainer((m=s.data.dpanel.containerInfo)===null||m===void 0?void 0:m.Name,"/dpanel/compose/".concat(t.name))),d(!0);case 8:case"end":return j.stop()}},i)})),children:_.FD.format("listManageFilePath")}),key:"file"},{key:"download",label:(0,r.jsx)(I.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(ee.Z,{}),disabled:n.length>1},action:C()(o()().mark(function i(){var a,t,s;return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(O(),a=n==null?void 0:n[0],a){m.next=4;break}return m.abrupt("return");case 4:return m.next=6,(0,T.tw)({id:a.id||a.name}).finally(function(){d(!0)});case 6:t=m.sent,s=new Blob([t],{type:"application/zip"}),(0,oe.saveAs)(s,"compose-"+a.name+".zip");case 9:case"end":return m.stop()}},i)})),children:_.FD.format("listManageDownload")})}]},{key:"delete",label:(0,r.jsx)(I.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(ne.Z,{})},type:"danger",confirmProps:{showCommonConfirm:!0},action:C()(o()().mark(function i(){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return O(),t.abrupt("return",Promise.all(n.map(function(){var s=C()(o()().mark(function v(m){return o()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,T.j6)({id:m.id||m.name,deleteData:!0,deletePath:!0});case 2:return j.abrupt("return",j.sent);case 3:case"end":return j.stop()}},v)}));return function(v){return s.apply(this,arguments)}}())).finally(function(){d(!0)}));case 2:case"end":return t.stop()}},i)})),children:_.FD.format("listManageDelete")},"deleteBatch")}]}},request:function(){var E=C()(o()().mark(function l(n){var d;return o()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,T.pm)({title:n.title,name:n.name});case 2:return d=i.sent,i.abrupt("return",{data:d.data.list.map(function(a){var t=d.data.containerList.filter(function(s){return s.project==a.name});return t&&(a.containerList=t),a}),success:!0,total:d.data.list.length});case 4:case"end":return i.stop()}},l)}));return function(l){return E.apply(this,arguments)}}(),rowKey:function(l){return l.id>0?l.id:l.name},columns:[{key:"name",title:_.FD.format("listName"),dataIndex:"name",width:300,render:function(l,n,d,O,i){return(0,r.jsx)(F.Z,{title:"".concat(n.title),placement:"right",children:(0,r.jsx)(re.Z.Link,{onClick:function(){var t;(t=u.current)===null||t===void 0||t.show(n.id||n.name)},children:n.name})})},sorter:function(l,n){return l.name.localeCompare(n.name)},defaultSortOrder:(0,w.rj)(z.q9,"name"),sortDirections:w.h5},{key:"title",title:_.FD.format("listTitle"),dataIndex:"title",width:200},{key:"ports",title:_.FD.format("listAccess"),tooltip:_.FD.format("listAccessTip"),width:150,dataIndex:"ports",search:!1,render:function(l,n,d,O){if((0,se.isEmpty)(n.containerList))return null;var i=[],a=[];return n.containerList&&n.containerList.forEach(function(t){t.publishers.forEach(function(s){s.publishedPort?i.push({PrivatePort:s.targetPort,Type:s.protocol,IP:s.url,PublicPort:s.publishedPort}):s.publishedPort&&a.push({PrivatePort:s.targetPort,Type:s.protocol,IP:s.url,PublicPort:s.publishedPort})})}),(0,r.jsx)(H.Z,{publicPort:i,privatePort:a,domain:[],serverIp:M})}},{title:_.FD.format("listType"),width:150,search:!1,render:function(l,n,d,O,i){var a,t=n.setting&&n.setting.type?n.setting.type:"default";return(0,r.jsx)(F.Z,{placement:"right",title:((a=n.setting.uri)!==null&&a!==void 0?a:[]).join(", "),children:(0,r.jsx)(U.Z,{color:h.format("listTypeColorOption.".concat(t)),children:h.format("listTypeOption.".concat(t))})})}},{title:_.FD.format("listStatus"),dataIndex:"status",search:!1,key:"status",render:function(l,n,d,O,i){return(0,r.jsx)(Q.Z,{children:n.setting.status.split(", ").map(function(a,t){var s,v="running",m=a.indexOf("(");return m>-1?v=a.slice(0,m):v=a,(0,r.jsx)(pe.Z,{status:"compose.".concat(v),statusValue:{count:a.slice(m+1,a.length-1)},tip:"".concat(a," ").concat((s=n.setting.message)!==null&&s!==void 0?s:"")},t)})})},sorter:function(l,n){return l.setting.status.localeCompare(n.setting.status)},defaultSortOrder:(0,w.rj)(z.q9,"status")},{title:_.FD.format("listUpdatedAt"),dataIndex:"",search:!1,width:180,render:function(l,n,d,O,i){return(0,b.NF)(n.setting.updatedAt)},sorter:function(l,n){var d,O;return new Date((d=l.setting.updatedAt)!==null&&d!==void 0?d:"").toLocaleString().localeCompare(new Date((O=n.setting.updatedAt)!==null&&O!==void 0?O:"").toLocaleString())},key:"updated",defaultSortOrder:(0,w.rj)(z.q9,"updated")},{title:_.FD.format("listManage"),width:60,valueType:"option",fixed:"right",key:"option",hidden:!f.canSeeComposeListManage,render:function(l,n,d,O,i){return n.setting.type!="dangling"&&(0,r.jsx)(Q.Z,{split:(0,r.jsx)(fe.Z,{type:"vertical"}),children:(0,r.jsx)(re.Z.Link,{onClick:function(){var t;(t=u.current)===null||t===void 0||t.show(n.id||n.name)},children:(0,r.jsx)(F.Z,{title:_.FD.format("listManageDetail"),children:(0,r.jsx)(te.Z,{})})},"3")})}}],rowSelection:f.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(l){return{disabled:l.setting.type=="dangling"||l.setting.type=="outPath"}}}:void 0,actionRef:x,quickToolbarRender:function(l){var n=l.selectedRows,d=l.finish,O=l.loading;return(0,r.jsxs)(Q.Z,{size:16,children:[(0,r.jsx)(Pe.Z,{type:D.W6.COMPOSE,selected:n,onSuccess:function(){return c(),!0}}),(0,r.jsx)(V.u,{access:"canSeeComposeListManageDelete",children:(0,r.jsx)(Y.Z,{buttonProps:{danger:!0,type:"primary"},confirmProps:{showCommonConfirm:!0},action:function(){return O(),Promise.all(n.map(function(){var a=C()(o()().mark(function t(s){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,T.j6)({id:s.id||s.name,deleteData:!0,deletePath:!0});case 2:return m.abrupt("return",m.sent);case 3:case"end":return m.stop()}},t)}));return function(t){return a.apply(this,arguments)}}())).finally(function(){d(!0)})},onSuccess:function(){var a;return!((a=x.current)===null||a===void 0)&&a.reloadAndRest&&x.current.reloadAndRest(),!0},onError:function(){return c(),!0},children:_.FD.format("listManageDeleteBatch")})})]})}},"table")]})}}}]);
