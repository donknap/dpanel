"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2628],{18429:function(B,C,e){e.d(C,{Z:function(){return Z}});var j=e(87462),c=e(67294),S={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},g=S,y=e(84089),w=function(R,i){return c.createElement(y.Z,(0,j.Z)({},R,{ref:i,icon:g}))},P=c.forwardRef(w),Z=P},16894:function(B,C,e){var j=e(9773);C.ZP=j.Z},89720:function(B,C,e){e.r(C),e.d(C,{default:function(){return q}});var j=e(15009),c=e.n(j),S=e(99289),g=e.n(S),y=e(1699),w=e(22191),P=e(5574),Z=e.n(P),N=e(3616),R=e(83727),i=e(36146),W=e(184),x=e(42075),z=e(83622),K=e(60940),$=e(25593),b=e(55241),h=e(67294),n=e(85893),G=(0,h.forwardRef)(function(v,T){var L=(0,h.useState)(!1),D=Z()(L,2),O=D[0],p=D[1],m=(0,h.useState)([]),o=Z()(m,2),r=o[0],d=o[1],u=new i.Uo("components.appCron");return(0,h.useImperativeHandle)(T,function(){return{}}),(0,h.useEffect)(function(){},[]),(0,n.jsx)(W.a,{drawerProps:{width:N.R_},name:"templte",title:(0,n.jsxs)(x.Z,{children:[(0,n.jsx)("span",{children:u.format("templateTitle")}),(0,n.jsx)("a",{href:"https://dpanel.cc/manual/system-cron-template",target:"_blank",children:i.FD.format("help")})]}),open:O,onOpenChange:function(a){p(a),a&&(0,R.VB)().then(function(t){d(t.data.list)})},submitter:!1,trigger:(0,n.jsx)(z.ZP,{children:u.format("templateTriggerButton")}),children:(0,n.jsx)(K.Z,{rowKey:function(a){return"".concat(a.project,"-").concat(a.name)},columns:[{title:i.FD.format("listTitle"),dataIndex:"name"},{title:i.FD.format("listCategory"),dataIndex:"project"},{title:i.FD.format("listDescription"),width:350,dataIndex:"description",render:function(a,t,f){return"".concat(t.description," ").concat(t.tag.includes("run-in-dpanel")?"(".concat(u.format("templateRunInDPanel"),")"):"")}},{title:i.FD.format("listManage"),width:100,render:function(a,t,f){return(0,n.jsxs)(x.Z,{children:[(0,n.jsx)($.Z.Link,{onClick:function(){p(!1),v.onFinish&&v.onFinish(t)},children:i.FD.format("listManageUse")},"use"),(0,n.jsx)(b.Z,{placement:"left",content:(0,n.jsx)("pre",{children:t.script}),children:(0,n.jsx)($.Z.Link,{children:i.FD.format("listManagePreview")},"preview")})]})}}],dataSource:r})})}),J=G,k=e(80821),M=e(98510),U=e(43425),H=e(86548),V=e(82061),Y=e(74453),I=e(82346),A=e(66309),Q=e(96074),X=e(83062);function q(){var v=(0,h.useRef)(),T=(0,h.useRef)(),L=(0,h.useRef)(),D=(0,I.useNavigate)(),O=(0,I.useAccess)(),p=new i.Uo("components.appCron");return(0,n.jsx)(Y._z,{header:{extra:[(0,n.jsx)(y.u,{access:"canSeeContainerCronManage",children:(0,n.jsx)(w.Z,{ref:T,onFinish:function(){var o,r;!((o=v.current)===null||o===void 0)&&o.reloadAndRest&&((r=v.current)===null||r===void 0||r.reloadAndRest())},showTriggerButton:!0},"create")},"create"),(0,n.jsx)(y.u,{access:"canSeeContainerCronManage",children:(0,n.jsx)(J,{ref:L,onFinish:function(o){var r;(r=T.current)===null||r===void 0||r.edit({title:"",setting:{script:o.script,environment:o.environment,enableRunBlock:!1,disable:!1,keepLogTotal:10}})}},"template")},"template")]},children:(0,n.jsx)(M.C,{rowKey:"id",columns:[{title:i.FD.format("listTitle"),dataIndex:"title",render:function(o,r,d,u,l){return(0,n.jsx)(I.Link,{to:"/app/cron/log/"+r.id,children:r.title})}},{title:i.FD.format("listContainerRunIn"),dataIndex:["setting","containerName"],search:!1},{title:i.FD.format("listRunCronTask"),search:!1,width:300,render:function(o,r,d,u,l){return(0,n.jsxs)(x.Z,{direction:"vertical",children:[r.setting.expression&&r.setting.expression.map(function(a,t){var f={dayOfMonth:a.dayOfMonth,dayOfWeek:a.dayOfWeek,hours:a.hours,minutes:a.minutes,month:a.month,seconds:a.seconds,unit:a.unit};return a.unit=="preWeek"?"".concat(p.format("cronDayOfWeekOption.".concat(a.dayOfWeek))).concat(p.format("cronUnitTipOption.".concat(a.unit),f)):p.format("cronUnitTipOption.".concat(a.unit),f)}),r.setting.triggerType=="manual"&&p.format("cronFormTriggerTypeOption.".concat(r.setting.triggerType)),r.setting.triggerType=="event"&&(0,n.jsxs)(x.Z,{children:[p.format("cronFormEventTypeOption.".concat(r.setting.eventType))," - ",(0,n.jsx)(A.Z,{color:"blue",children:r.setting.eventContainer})]})]})}},{title:i.FD.format("listNextAt"),search:!1,width:400,render:function(o,r,d,u,l){return(0,n.jsx)(x.Z,{direction:"vertical",children:!r.setting.triggerType||r.setting.triggerType=="cron"||r.setting.triggerType==""?r.setting.nextRunTime?r.setting.nextRunTime.map(function(a,t){return(0,n.jsx)(A.Z,{children:new Date(a).toLocaleString()},"runNextTime-".concat(t))}):(0,n.jsx)(A.Z,{color:"error",children:i.FD.format("listNotRun")},"runNextTime-".concat(d)):"-"})}},{title:i.FD.format("listManage"),width:80,search:!1,fixed:"right",hidden:!O.canSeeContainerCronManage,render:function(o,r,d,u,l){return(0,n.jsx)(x.Z,{split:(0,n.jsx)(Q.Z,{type:"vertical"}),children:(0,n.jsx)($.Z.Link,{onClick:function(){D("/app/cron/log/"+r.id)},children:(0,n.jsx)(X.Z,{title:i.FD.format("listManageDetail"),children:(0,n.jsx)(U.Z,{})})},"log")})}}],request:function(){var m=g()(c()().mark(function o(r,d,u){var l;return c()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,R.SY)({title:r.title});case 2:return l=t.sent,t.abrupt("return",{data:l.data.list,success:!0,total:l.data.list.length});case 4:case"end":return t.stop()}},o)}));return function(o,r,d){return m.apply(this,arguments)}}(),rowSelection:O.canSeeContainerCronManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0}:void 0,actionRef:v,quickToolbarRender:function(o){var r=o.selectedRows,d=o.finish,u=o.loading;return(0,n.jsx)(x.Z,{size:16,children:(0,n.jsx)(k.Z,{buttonProps:{danger:!0,type:"primary"},confirmProps:{showCommonConfirm:!0},action:g()(c()().mark(function l(){return c()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u(),t.abrupt("return",(0,R.Ji)({id:r.map(function(f){var s;return(s=f.id)!==null&&s!==void 0?s:0})}).finally(function(){d(!0)}));case 2:case"end":return t.stop()}},l)})),onSuccess:function(){var a,t;return!((a=v.current)===null||a===void 0)&&a.reloadAndRest&&((t=v.current)===null||t===void 0||t.reloadAndRest()),!0},onError:function(){var a,t;return!((a=v.current)===null||a===void 0)&&a.reset&&((t=v.current)===null||t===void 0||t.reset()),!0},children:i.FD.format("listManageDeleteBatch")},"delete")})},contextMenu:function(o){var r=o.loading,d=o.finish,u=o.isMultiple,l=o.selectedRow,a=o.selectedRows;return{items:[{type:"group",label:i.FD.format("listManage"),key:"operator",children:[{label:(0,n.jsx)(M.C.ContextMenuItem,{buttonProps:{icon:(0,n.jsx)(H.Z,{}),disabled:u()},action:g()(c()().mark(function t(){var f;return c()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:d(!0),(f=T.current)===null||f===void 0||f.edit(l);case 2:case"end":return F.stop()}},t)})),children:i.FD.format("listManageEdit")}),key:"edit"},{label:(0,n.jsx)(M.C.ContextMenuItem,{buttonProps:{icon:(0,n.jsx)(U.Z,{}),disabled:u()},action:g()(c()().mark(function t(){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:D("/app/cron/log/"+l.id);case 1:case"end":return s.stop()}},t)})),children:i.Ob.format("container.cron.log")}),key:"detail"}]},{key:"delete",label:(0,n.jsx)(M.C.ContextMenuItem,{buttonProps:{icon:(0,n.jsx)(V.Z,{})},type:"danger",confirmProps:{showCommonConfirm:!0},action:g()(c()().mark(function t(){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r(),s.abrupt("return",(0,R.Ji)({id:a.map(function(F){var E;return(E=F.id)!==null&&E!==void 0?E:0})}).finally(function(){d(!0)}));case 2:case"end":return s.stop()}},t)})),children:i.FD.format("listManageDelete")},"deleteBatch")}]}}})})}}}]);
