"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9013],{44349:function(ne,Z,e){var H=e(97857),m=e.n(H),G=e(15009),U=e.n(G),$=e(99289),z=e.n($),N=e(74763),D=e(17186),B=e(5966),Y=e(86250),R=e(67294),V=e(85893),K=(0,R.forwardRef)(function(o,b){var E=(0,R.useRef)();(0,R.useImperativeHandle)(b,function(){return{addItem:function(h){function _(f,M,a){return h.apply(this,arguments)}return _.toString=function(){return h.toString()},_}(function(h,_,f){var M,a=(M=E.current)===null||M===void 0?void 0:M.getList(),C;if(a==null||a.forEach(function(k,q){k[h]==_[h]&&(C=q)}),!(0,N.k)(C)&&f){var L;(L=E.current)===null||L===void 0||L.remove(C),C=void 0}if(!C){var I;(I=E.current)===null||I===void 0||I.add(_)}}),removeItemByKey:function(_,f){return z()(U()().mark(function M(){var a,C;return U()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return C=(a=E.current)===null||a===void 0?void 0:a.getList(),C==null||C.forEach(function(k,q){if(k[_]==f){var ee;(ee=E.current)===null||ee===void 0||ee.remove(q);return}}),I.abrupt("return");case 3:case"end":return I.stop()}},M)}))()},clear:function(_){if(!_){var f;_=(f=E.current)===null||f===void 0||(f=f.getList())===null||f===void 0?void 0:f.map(function(a,C){return C})}if(_){var M;(M=E.current)===null||M===void 0||M.remove(_)}},getList:function(){var _;return(_=E.current)===null||_===void 0?void 0:_.getList()}}});var t={};return o.hideCopyButton===!0&&(t.copyIconProps=!1),o.hideDeleteButton===!0&&(t.deleteIconProps=!1),(0,V.jsx)(D.u,m()(m()({initialValue:o.initialValue,label:o.label,name:o.name,actionRef:E,creatorButtonProps:o.showAddButton?{creatorButtonText:o.label?o.label:o.showAddButtonLabel?o.showAddButtonLabel:o.name}:!1,min:o.min?o.min:0},t),{},{children:function(_,f,M){return(0,V.jsx)(Y.Z,{justify:o.justify,gap:o.gap,children:o.items.map(function(a){return a.render?(0,V.jsx)("div",{children:a.render&&a.render(_,f,M)},"".concat(o.name,"-").concat(a.name,"-").concat(_.key)):(0,V.jsx)(B.Z,{width:a.width,name:a.name,label:a.label,required:a.required,rules:[{required:a.required}],disabled:a.disabled,placeholder:a.placeholder},"".concat(o.name,"-").concat(a.name,"-").concat(_.key))})})}}))});Z.Z=K},36435:function(ne,Z,e){var H=e(15009),m=e.n(H),G=e(64599),U=e.n(G),$=e(99289),z=e.n($),N=e(9783),D=e.n(N),B=e(5574),Y=e.n(B),R=e(67294),V=e(184),K=e(38345),o=e(97269),b=e(97321),E=e(97462),t=e(64317),h=e(5966),_=e(86615),f=e(68602),M=e(83622),a=e(83403),C=e(24963),L=e(1699),I=e(29177),k=e(1883),q=e(43425),ee=e(44349),ae=e(3616),re=e(36146),r=e(85893),se=(0,R.forwardRef)(function(F,ie){var oe=(0,R.useState)(!1),A=Y()(oe,2),J=A[0],Q=A[1],W=(0,R.useRef)(),x=(0,R.useContext)(C.Z),g=x.message,T=(0,R.useState)([]),v=Y()(T,2),c=v[0],X=v[1],i=new re.Uo("components.permissionButton"),te=D()(D()(D()(D()(D()({},a.W6.CONTAINER,"Id"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"serverAddress"),a.W6.DOCKER_ENV,"name"),le=D()(D()(D()(D()(D()({},a.W6.CONTAINER,"name"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"title"),a.W6.DOCKER_ENV,"title"),y=te[F.type],S=le[F.type],j=F.selected.map(function(n){return n[te[F.type]]});return R.useEffect(function(){if(J){if(!F.selected||F.selected.length==0){g.error(re.FD.format("title.noDataSelect")),Q(!1);return}(0,f.dP)({permission:{uri:F.type,key:y,value:j}}).then(function(n){var s;(s=W.current)===null||s===void 0||s.setFieldValue("list",Object.keys(n.data.list).map(function(u){return{name:u,type:n.data.list[u].type,users:n.data.list[u].users}}))}),(0,f.lE)().then(function(n){var s,u=(s=n.data)===null||s===void 0||(s=s.list)===null||s===void 0?void 0:s.map(function(l){return{label:l.username,value:l.username}});X(u)})}},[J]),(0,r.jsx)(L.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,r.jsxs)(V.a,{name:"create",title:i.format("drawerTitle"),open:J,onOpenChange:function(s){if(!s){var u;(u=W.current)===null||u===void 0||u.resetFields()}Q(s)},drawerProps:{forceRender:!0,width:ae.R_},formRef:W,trigger:(0,r.jsx)(M.ZP,{icon:(0,r.jsx)(I.Z,{}),children:i.format("drawerTriggerButton")}),onFinish:function(){var n=z()(m()().mark(function s(u){var l,d,p;return m()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:l=U()(u.list),O.prev=1,l.s();case 3:if((d=l.n()).done){O.next=9;break}return p=d.value,O.next=7,(0,f.Db)({usernames:p.users,permissionType:p.type,permission:{uri:F.type,key:y,showKey:S,value:[p.name]}});case 7:O.next=3;break;case 9:O.next=14;break;case 11:O.prev=11,O.t0=O.catch(1),l.e(O.t0);case 14:return O.prev=14,l.f(),O.finish(14);case 17:g.success(re.FD.format("finish")),Q(!1),F.onSuccess();case 20:case"end":return O.stop()}},s,null,[[1,11,14,17]])}));return function(s){return n.apply(this,arguments)}}(),children:[(0,r.jsxs)(K.Z,{ghost:!0,title:(0,r.jsx)(k.Z,{}),subTitle:i.format("batchTitle"),children:[(0,r.jsx)(o.A.Item,{name:"type",style:{marginBottom:0},children:(0,r.jsx)(b.Z.Group,{defaultValue:"admin",onChange:function(s){var u,l,d=(u=W.current)===null||u===void 0?void 0:u.getFieldValue("list");d.forEach(function(p){p.type=s,p.users=[]}),(l=W.current)===null||l===void 0||l.setFieldValue("list",d)},children:["admin","restricted","public"].map(function(n){return(0,r.jsx)(b.Z,{style:{width:240},title:i.format("dataTypeOption.".concat(n)),description:i.format("dataTypeDescOption.".concat(n)),value:n},n)})})}),(0,r.jsx)(E.Z,{name:["type"],children:function(s){var u=s.type;if(u==="restricted")return(0,r.jsx)(t.Z,{mode:"multiple",name:"usernames",label:i.format("formUsernames"),onChange:function(d){var p,P,O=(p=W.current)===null||p===void 0?void 0:p.getFieldValue("list");O.forEach(function(w){w.users=d}),(P=W.current)===null||P===void 0||P.setFieldValue("list",O)},rules:[{required:!0}],request:z()(m()().mark(function l(){var d,p,P;return m()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!(c.length>0)){w.next=2;break}return w.abrupt("return",c);case 2:return w.next=4,(0,f.lE)();case 4:return p=w.sent,P=(d=p.data)===null||d===void 0||(d=d.list)===null||d===void 0?void 0:d.map(function(ue){return{label:ue.username,value:ue.username}}),X(P),w.abrupt("return",P);case 8:case"end":return w.stop()}},l)}))})}})]}),(0,r.jsx)(K.Z,{ghost:!0,title:(0,r.jsx)(q.Z,{}),subTitle:i.format("dataTitle"),children:(0,r.jsx)(ee.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:i.format("dataName"),render:function(s,u,l){var d=l.getCurrentRowData();return(0,r.jsx)(h.Z,{disabled:!0,label:i.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:i.format("dataType"),render:function(s,u,l){var d=l.getCurrentRowData();return(0,r.jsx)(_.Z.Group,{label:i.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(p){return{label:i.format("dataTypeOption.".concat(p)),value:p}})})}},{name:"users",label:i.format("dataUsers"),render:function(s,u,l){return(0,r.jsx)(E.Z,{name:["type"],children:function(p){var P=p.type;if(P=="restricted")return(0,r.jsx)(t.Z,{width:"sm",mode:"tags",name:"users",label:i.format("dataUsers"),options:c})}})}}]})})]})})});Z.Z=se},3616:function(ne,Z,e){e.d(Z,{Ed:function(){return U},FK:function(){return m},R_:function(){return H},ob:function(){return G}});var H=window.innerWidth<=1024?"90vw":"65vw",m="90vw",G="60vw",U="50vh"},39900:function(ne,Z,e){e.r(Z),e.d(Z,{default:function(){return oe}});var H=e(15009),m=e.n(H),G=e(99289),U=e.n(G),$=e(1699),z=e(80821),N=e(36435),D=e(83403),B=e(75870),Y=e(86548),R=e(74453),V=e(82346),K=e(42075),o=e(96074),b=e(83622),E=e(83062),t=e(67294),h=e(36146),_=e(5574),f=e.n(_),M=e(3616),a=e(24963),C=e(184),L=e(5966),I=e(52688),k=e(97462),q=e(90672),ee=e(62370),ae=e(25593),re=e(66309),r=e(85893),se=(0,t.forwardRef)(function(A,J){var Q=(0,t.useState)(!1),W=f()(Q,2),x=W[0],g=W[1],T=(0,t.useRef)(),v=(0,t.useState)(0),c=f()(v,2),X=c[0],i=c[1],te=(0,t.useContext)(a.Z),le=te.message,y=new h.Uo("components.image");return(0,t.useImperativeHandle)(J,function(){return{setEditId:function(j){(0,B.t1)({id:j}).then(function(n){var s;g(!0),i(j),(s=T.current)===null||s===void 0||s.setFieldsValue({title:n.data.info.title,serverAddress:n.data.info.serverAddress,username:n.data.info.setting.username,password:n.data.info.setting.password,proxy:n.data.info.setting.proxy.join(`
`),enableHttp:n.data.info.setting.enableHttp,enableAuth:!!n.data.info.setting.username})})}}}),(0,r.jsxs)(C.a,{drawerProps:{forceRender:!0,width:M.R_},name:"createRegisry",title:y.format("registryCreateTitle"),open:x,onOpenChange:function(j){g(j)},layout:"horizontal",labelCol:{span:5,offset:0},formRef:T,trigger:(0,r.jsx)(b.ZP,{type:"primary",onClick:function(){var j;(j=T.current)===null||j===void 0||j.resetFields(),i(0)},children:y.format("registryCreateTirggerButton")}),onFinish:function(){var S=U()(m()().mark(function j(n){var s,u,l,d;return m()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,B.ZH)({id:X,title:n.title,serverAddress:n.serverAddress,username:(s=n.username)!==null&&s!==void 0?s:"",password:(u=n.password)!==null&&u!==void 0?u:"",proxy:n.proxy?n.proxy.split(`
`):[],enableHttp:n.enableHttp});case 2:if(l=P.sent,!(l&&l.data&&l.data.id>0)){P.next=8;break}return le.success(h.FD.format("finish")),A.onFinish&&A.onFinish(),(d=T.current)===null||d===void 0||d.resetFields(),P.abrupt("return",!0);case 8:case"end":return P.stop()}},j)}));return function(j){return S.apply(this,arguments)}}(),children:[(0,r.jsx)(L.Z,{label:y.format("registryCreateFormTitle"),name:"title",placeholder:y.format("registryCreateFormTitleEmpty"),disabled:X==-1,required:!0}),(0,r.jsx)(L.Z,{label:y.format("registryCreateFormServerAddress"),name:"serverAddress",placeholder:"ccr.ccs.tencentyun.com, docker.io, 127.0.0.1:5000",disabled:X==-1,required:!0,rules:[{required:!0}]}),(0,r.jsx)(I.Z,{tooltip:y.format("registryCreateFormEnableHttpTip"),label:y.format("registryCreateFormEnableHttp"),name:"enableHttp"}),(0,r.jsx)(I.Z,{label:y.format("registryCreateFormEnableAuth"),name:"enableAuth"}),(0,r.jsx)(k.Z,{name:["enableAuth"],children:function(j){var n=j.enableAuth;return n&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.Z,{label:y.format("registryCreateFormUsername"),name:"username",placeholder:y.format("registryCreateFormUsernameEmpty"),tooltip:""},"username"),(0,r.jsx)(L.Z.Password,{label:y.format("registryCreateFormPassword"),name:"password",allowClear:!0,placeholder:y.format("registryCreateFormPasswordEmpty")},"password")]})}}),(0,r.jsx)(q.Z,{label:y.format("registryCreateFormProxy"),name:"proxy",fieldProps:{autoSize:{minRows:10}},placeholder:y.format("registryCreateFormProxyTip")}),(0,r.jsx)(ee.Z,{label:y.format("registryCreateFormProxyRecommand"),children:(0,r.jsx)(K.Z,{wrap:!0,children:["docker.1panel.live","docker.m.daocloud.io","docker.1ms.run"].map(function(S,j){return(0,r.jsx)(ae.Z.Link,{onClick:function(){var s,u,l=[];if((s=T.current)!==null&&s!==void 0&&s.getFieldValue("proxy")){var d;l=(d=T.current)===null||d===void 0?void 0:d.getFieldValue("proxy").split(`
`)}else l=[];l.includes(S)||l.push(S),(u=T.current)===null||u===void 0||u.setFieldValue("proxy",l.join(`
`))},children:(0,r.jsx)(re.Z,{color:"cyan",children:S})},j)})})},"recommend")]})}),F=se,ie=e(98510);function oe(){var A=(0,t.useRef)(),J=(0,t.useRef)(),Q=(0,V.useAccess)();return(0,r.jsx)(R._z,{header:{extra:[(0,r.jsx)($.u,{access:"canSeeImageRegistryManage",children:(0,r.jsx)(F,{onFinish:function(){var x,g;!((x=A.current)===null||x===void 0)&&x.reloadAndRest&&((g=A.current)===null||g===void 0||g.reloadAndRest())},ref:J},"create")},"create")]},children:(0,r.jsx)(ie.C,{rowKey:"id",columns:[{title:h.FD.format("listTitle"),ellipsis:!0,dataIndex:"title"},{title:"Url",dataIndex:"serverAddress"},{title:h.FD.format("listUsername"),dataIndex:["setting","username"],search:!1},{title:h.FD.format("listManage"),width:100,search:!1,fixed:"right",hidden:!Q.canSeeImageRegistryManage,render:function(x,g,T,v,c){return(0,r.jsx)(K.Z,{split:(0,r.jsx)(o.Z,{type:"vertical"}),children:(0,r.jsx)(b.ZP,{type:"link",onClick:function(){var i;(i=J.current)===null||i===void 0||i.setEditId(g.id)},children:(0,r.jsx)(E.Z,{title:h.FD.format("listManageEdit"),children:(0,r.jsx)(Y.Z,{})})})})}}],request:function(){var W=U()(m()().mark(function x(g,T,v){var c;return m()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,B.Ot)({title:g.title,serverAddress:g.serverAddress});case 2:return c=i.sent,i.abrupt("return",{data:c.data.list,success:!0,total:c.data.list.length});case 4:case"end":return i.stop()}},x)}));return function(x,g,T){return W.apply(this,arguments)}}(),rowSelection:Q.canSeeImageRegistryManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0}:void 0,actionRef:A,quickToolbarRender:function(x){var g=x.selectedRows;return(0,r.jsxs)(K.Z,{size:16,children:[(0,r.jsx)(N.Z,{type:D.W6.REGISTRY,selected:g,onSuccess:function(){var v,c;return!((v=A.current)===null||v===void 0)&&v.reloadAndRest&&((c=A.current)===null||c===void 0||c.reloadAndRest()),!0}}),(0,r.jsx)(z.Z,{buttonProps:{danger:!0,type:"primary"},confirmProps:{showCommonConfirm:!0},action:function(){return(0,B.ix)({id:g.map(function(v){return v.id})})},onSuccess:function(){var v,c;return!((v=A.current)===null||v===void 0)&&v.reloadAndRest&&((c=A.current)===null||c===void 0||c.reloadAndRest()),!0},onError:function(){var v,c;return!((v=A.current)===null||v===void 0)&&v.reset&&((c=A.current)===null||c===void 0||c.reset()),!0},children:h.FD.format("listManageDeleteBatch")})]})}})})}},75870:function(ne,Z,e){e.d(Z,{Ot:function(){return z},ZH:function(){return D},ix:function(){return Y},t1:function(){return V}});var H=e(15009),m=e.n(H),G=e(99289),U=e.n(G),$=e(82346);function z(o){return N.apply(this,arguments)}function N(){return N=U()(m()().mark(function o(b){return m()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,$.request)("/dpanel/api/common/registry/get-list",{method:"POST",data:b}));case 1:case"end":return t.stop()}},o)})),N.apply(this,arguments)}function D(o){return B.apply(this,arguments)}function B(){return B=U()(m()().mark(function o(b){return m()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,$.request)("/dpanel/api/common/registry/create",{method:"POST",data:b}));case 1:case"end":return t.stop()}},o)})),B.apply(this,arguments)}function Y(o){return R.apply(this,arguments)}function R(){return R=U()(m()().mark(function o(b){return m()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,$.request)("/dpanel/api/common/registry/delete",{method:"POST",data:b}));case 1:case"end":return t.stop()}},o)})),R.apply(this,arguments)}function V(o){return K.apply(this,arguments)}function K(){return K=U()(m()().mark(function o(b){return m()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,$.request)("/dpanel/api/common/registry/get-detail",{method:"POST",data:b}));case 1:case"end":return t.stop()}},o)})),K.apply(this,arguments)}}}]);
